<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>6 Examples | fishLengthAssess R package</title>
  <meta name="description" content="This document includes the description of fishLengthAssess R package." />
  <meta name="generator" content="bookdown 0.41 and GitBook 2.6.7" />

  <meta property="og:title" content="6 Examples | fishLengthAssess R package" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="This document includes the description of fishLengthAssess R package." />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="6 Examples | fishLengthAssess R package" />
  
  <meta name="twitter:description" content="This document includes the description of fishLengthAssess R package." />
  

<meta name="author" content="Nature Analytics" />


<meta name="date" content="2025-06-13" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="utility-functions.html"/>
<link rel="next" href="references.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">fishLengthAssess R package</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> What is fishLengthAssess?</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#installation"><i class="fa fa-check"></i><b>1.1</b> Installation</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#how-to-use-fishlengthassess"><i class="fa fa-check"></i><b>1.2</b> How to use fishLengthAssess?</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="r-objects-and-example-data-sets.html"><a href="r-objects-and-example-data-sets.html"><i class="fa fa-check"></i><b>2</b> R objects and example data sets</a></li>
<li class="chapter" data-level="3" data-path="indicator-based-functions.html"><a href="indicator-based-functions.html"><i class="fa fa-check"></i><b>3</b> Indicator-based functions</a>
<ul>
<li class="chapter" data-level="3.1" data-path="indicator-based-functions.html"><a href="indicator-based-functions.html#pmatfunc-function"><i class="fa fa-check"></i><b>3.1</b> <code>PmatFunc</code> function</a></li>
<li class="chapter" data-level="3.2" data-path="indicator-based-functions.html"><a href="indicator-based-functions.html#poptfunc-function"><i class="fa fa-check"></i><b>3.2</b> <code>PoptFunc</code> function</a></li>
<li class="chapter" data-level="3.3" data-path="indicator-based-functions.html"><a href="indicator-based-functions.html#pmegafunc-function"><i class="fa fa-check"></i><b>3.3</b> <code>PmegaFunc</code> function</a></li>
<li class="chapter" data-level="3.4" data-path="indicator-based-functions.html"><a href="indicator-based-functions.html#plcfunc-function"><i class="fa fa-check"></i><b>3.4</b> <code>PLcFunc</code> function</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="model-based-functions.html"><a href="model-based-functions.html"><i class="fa fa-check"></i><b>4</b> Model-based functions</a>
<ul>
<li class="chapter" data-level="4.1" data-path="model-based-functions.html"><a href="model-based-functions.html#lbspr"><i class="fa fa-check"></i><b>4.1</b> LBSPR</a></li>
<li class="chapter" data-level="4.2" data-path="model-based-functions.html"><a href="model-based-functions.html#lbspr-with-dome-shaped-selectivity"><i class="fa fa-check"></i><b>4.2</b> LBSPR with dome-shaped selectivity</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="model-based-functions.html"><a href="model-based-functions.html#core-simulation-function-gtgdomelbsprsim2"><i class="fa fa-check"></i><b>4.2.1</b> Core simulation function: <code>GTGDomeLBSPRSim2</code></a></li>
<li class="chapter" data-level="4.2.2" data-path="model-based-functions.html"><a href="model-based-functions.html#data-processing-function-processlengthcompdata"><i class="fa fa-check"></i><b>4.2.2</b> Data Processing Function: <code>processLengthCompData</code></a></li>
<li class="chapter" data-level="4.2.3" data-path="model-based-functions.html"><a href="model-based-functions.html#optimization-function-optfundome"><i class="fa fa-check"></i><b>4.2.3</b> Optimization function: <code>OptFunDome</code></a></li>
<li class="chapter" data-level="4.2.4" data-path="model-based-functions.html"><a href="model-based-functions.html#optimization-wrapper-dooptdome"><i class="fa fa-check"></i><b>4.2.4</b> Optimization wrapper: <code>DoOptDome</code></a></li>
<li class="chapter" data-level="4.2.5" data-path="model-based-functions.html"><a href="model-based-functions.html#user-interface-functions"><i class="fa fa-check"></i><b>4.2.5</b> User interface functions:</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="utility-functions.html"><a href="utility-functions.html"><i class="fa fa-check"></i><b>5</b> Utility functions</a>
<ul>
<li class="chapter" data-level="5.1" data-path="utility-functions.html"><a href="utility-functions.html#poollengthcomp-function"><i class="fa fa-check"></i><b>5.1</b> <code>poolLengthComp</code> function</a></li>
<li class="chapter" data-level="5.2" data-path="utility-functions.html"><a href="utility-functions.html#loptfunc-function"><i class="fa fa-check"></i><b>5.2</b> <code>LoptFunc</code> function</a></li>
<li class="chapter" data-level="5.3" data-path="utility-functions.html"><a href="utility-functions.html#lcfunc-and-modekernelfunc-functions"><i class="fa fa-check"></i><b>5.3</b> <code>LcFunc</code> and <code>modeKernelFunc</code> functions</a></li>
<li class="chapter" data-level="5.4" data-path="utility-functions.html"><a href="utility-functions.html#gillnet-fitting"><i class="fa fa-check"></i><b>5.4</b> <code>fit_gillnet_dome</code> function and gillnet selectivity analysis</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="utility-functions.html"><a href="utility-functions.html#function-overview"><i class="fa fa-check"></i><b>5.4.1</b> Function Overview</a></li>
<li class="chapter" data-level="5.4.2" data-path="utility-functions.html"><a href="utility-functions.html#function-arguments"><i class="fa fa-check"></i><b>5.4.2</b> Function Arguments</a></li>
<li class="chapter" data-level="5.4.3" data-path="utility-functions.html"><a href="utility-functions.html#data-exploration-and-calculation-of-starting-values"><i class="fa fa-check"></i><b>5.4.3</b> Data exploration and calculation of starting values</a></li>
<li class="chapter" data-level="5.4.4" data-path="utility-functions.html"><a href="utility-functions.html#model-fitting"><i class="fa fa-check"></i><b>5.4.4</b> Model Fitting</a></li>
<li class="chapter" data-level="5.4.5" data-path="utility-functions.html"><a href="utility-functions.html#model-parameter-summary"><i class="fa fa-check"></i><b>5.4.5</b> Model parameter summary</a></li>
<li class="chapter" data-level="5.4.6" data-path="utility-functions.html"><a href="utility-functions.html#result-visualization-and-interpretation"><i class="fa fa-check"></i><b>5.4.6</b> Result visualization and interpretation</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="examples.html"><a href="examples.html"><i class="fa fa-check"></i><b>6</b> Examples</a>
<ul>
<li class="chapter" data-level="6.1" data-path="examples.html"><a href="examples.html#gillnet-selectivity"><i class="fa fa-check"></i><b>6.1</b> <code>fit_gillnet_dome</code> function</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="examples.html"><a href="examples.html#example-1"><i class="fa fa-check"></i><b>6.1.1</b> Example 1</a></li>
<li class="chapter" data-level="6.1.2" data-path="examples.html"><a href="examples.html#example-2"><i class="fa fa-check"></i><b>6.1.2</b> Example 2</a></li>
<li class="chapter" data-level="6.1.3" data-path="examples.html"><a href="examples.html#example-3"><i class="fa fa-check"></i><b>6.1.3</b> Example 3</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="examples.html"><a href="examples.html#dome-shaped-lbspr"><i class="fa fa-check"></i><b>6.2</b> <code>GTGDomeLBSPRSim2</code> function</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="examples.html"><a href="examples.html#practical-application-of-gtg-length-based-spr-model-including-dome-shaped-selectivity-step-by-step-example"><i class="fa fa-check"></i><b>6.2.1</b> Practical Application of GTG Length-Based SPR model including dome-shaped selectivity: Step-by-Step Example</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">fishLengthAssess R package</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="examples" class="section level1 hasAnchor" number="6">
<h1><span class="header-section-number">6</span> Examples<a href="examples.html#examples" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="gillnet-selectivity" class="section level2 hasAnchor" number="6.1">
<h2><span class="header-section-number">6.1</span> <code>fit_gillnet_dome</code> function<a href="examples.html#gillnet-selectivity" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This section demonstrates how to use the <code>fit_gillnet_dome()</code> function to estimate selectivity parameters for gillnet fisheries. The function fits multiple selectivity models to experimental gillnet data and provides comprehensive model comparison capabilities.</p>
<p>The <code>fit_gillnet_dome()</code> function is designed to:</p>
<ul>
<li>Fit multiple selectivity curves to gillnet experimental data</li>
<li>Handle both unimodal and bimodal selectivity patterns</li>
<li>Provide automatic model comparison and selection</li>
<li>Generate plots and statistical summaries</li>
<li>Support both automatic and manual starting value specification</li>
</ul>
<p>The function expects input data with the following structure:</p>
<ul>
<li>Length measurements or frequency data from experimental gillnet fishing</li>
<li>Multiple mesh sizes tested simultaneously</li>
<li>Data organized in a format compatible with the package’s data processing functions</li>
</ul>
<p>Loading the package and data:</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="examples.html#cb47-1" tabindex="-1"></a><span class="co"># Load the package</span></span>
<span id="cb47-2"><a href="examples.html#cb47-2" tabindex="-1"></a><span class="fu">library</span>(fishLengthAssess)</span>
<span id="cb47-3"><a href="examples.html#cb47-3" tabindex="-1"></a></span>
<span id="cb47-4"><a href="examples.html#cb47-4" tabindex="-1"></a><span class="co"># Load the example gillnet data</span></span>
<span id="cb47-5"><a href="examples.html#cb47-5" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;raw_data_gillnet&quot;</span>)</span>
<span id="cb47-6"><a href="examples.html#cb47-6" tabindex="-1"></a>input_data <span class="ot">&lt;-</span> raw_data_gillnet</span>
<span id="cb47-7"><a href="examples.html#cb47-7" tabindex="-1"></a>input_data</span></code></pre></div>
<pre><code>##      V1  V2  V3  V4  V5  V6  V7 V8 V9
## 1  52.5  52  11   1   1   0   0  0  0
## 2  54.5 102  91  16   4   4   2  0  3
## 3  56.5 295 232 131  61  17  13  3  1
## 4  58.5 309 318 362 243  95  26  4  3
## 5  60.5 118 173 326 342 199 100 10 11
## 6  62.5  79  87 191 239 202 201 39 15
## 7  64.5  27  48 111 143 133 185 72 25
## 8  66.5  14  17  44  51  52 122 74 41
## 9  68.5   8   6  14  23  25  59 65 76
## 10 70.5   7   3   8  14  15  16 34 33
## 11 72.5   0   3   1   2   5   4  6 15</code></pre>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="examples.html#cb49-1" tabindex="-1"></a><span class="co"># Define the mesh sizes (cm) used in the experiment</span></span>
<span id="cb49-2"><a href="examples.html#cb49-2" tabindex="-1"></a>mesh_sizes <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">13.5</span>, <span class="fl">14.0</span>, <span class="fl">14.8</span>, <span class="fl">15.4</span>, <span class="fl">15.9</span>, <span class="fl">16.6</span>, <span class="fl">17.8</span>, <span class="dv">19</span>)</span></code></pre></div>
<div id="example-1" class="section level3 hasAnchor" number="6.1.1">
<h3><span class="header-section-number">6.1.1</span> Example 1<a href="examples.html#example-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="fitting-unimodal-models-only" class="section level4 hasAnchor" number="6.1.1.1">
<h4><span class="header-section-number">6.1.1.1</span> Fitting unimodal models only<a href="examples.html#fitting-unimodal-models-only" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>In many cases, the user may want to start with simpler unimodal selectivity models before considering more complex bimodal patterns. Setting <code>run_bimodal = FALSE</code> fits only the three basic dome-shaped models (i.e., <code>norm.loc</code>: Normal common spread, <code>norm.sca</code>: Normal scaled spread, and <code>lognorm</code>: Lognormal).</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="examples.html#cb50-1" tabindex="-1"></a><span class="co"># Fit unimodal selectivity models only</span></span>
<span id="cb50-2"><a href="examples.html#cb50-2" tabindex="-1"></a>result_unimodal <span class="ot">&lt;-</span> <span class="fu">fit_gillnet_dome</span>(</span>
<span id="cb50-3"><a href="examples.html#cb50-3" tabindex="-1"></a>  <span class="at">input_data =</span> input_data,</span>
<span id="cb50-4"><a href="examples.html#cb50-4" tabindex="-1"></a>  <span class="at">mesh_sizes =</span> mesh_sizes,</span>
<span id="cb50-5"><a href="examples.html#cb50-5" tabindex="-1"></a>  <span class="at">run_bimodal =</span> <span class="cn">FALSE</span>,</span>
<span id="cb50-6"><a href="examples.html#cb50-6" tabindex="-1"></a>  <span class="at">output_dir =</span> <span class="st">&quot;model_plots_unimodal&quot;</span>,</span>
<span id="cb50-7"><a href="examples.html#cb50-7" tabindex="-1"></a>  <span class="at">length_seq =</span> <span class="fu">seq</span>(<span class="dv">40</span>, <span class="dv">100</span>, <span class="dv">1</span>)</span>
<span id="cb50-8"><a href="examples.html#cb50-8" tabindex="-1"></a>)</span></code></pre></div>
<p>The function automatically generates plots for each fitted selectivity model and saves them in the specified output directory (e.g., <code>model_plots_unimodal</code>).</p>
<div class="figure"><span style="display:block;" id="fig:normal-loc-example"></span>
<img src="model_plots_unimodal/Combined_norm.loc.jpeg" alt="Normal location model (norm.loc) selectivity curves and residuals. The top panel shows the selectivity curves for each mesh size, while the bottom panel displays the deviance residuals." width="60%" />
<p class="caption">
Figure 6.1: Normal location model (norm.loc) selectivity curves and residuals. The top panel shows the selectivity curves for each mesh size, while the bottom panel displays the deviance residuals.
</p>
</div>
<div class="figure"><span style="display:block;" id="fig:normal-sca-example"></span>
<img src="model_plots_unimodal/Combined_norm.sca.jpeg" alt="Normal scaled spread model (norm.sca) selectivity curves and residuals. The top panel shows the selectivity curves for each mesh size, while the bottom panel displays the deviance residuals." width="60%" />
<p class="caption">
Figure 6.2: Normal scaled spread model (norm.sca) selectivity curves and residuals. The top panel shows the selectivity curves for each mesh size, while the bottom panel displays the deviance residuals.
</p>
</div>
<div class="figure"><span style="display:block;" id="fig:normal-lognorm-example"></span>
<img src="model_plots_unimodal/Combined_lognorm.jpeg" alt="Lognormal model (lognorm) selectivity curves and residuals. The top panel shows the selectivity curves for each mesh size, while the bottom panel displays the deviance residuals." width="60%" />
<p class="caption">
Figure 6.3: Lognormal model (lognorm) selectivity curves and residuals. The top panel shows the selectivity curves for each mesh size, while the bottom panel displays the deviance residuals.
</p>
</div>
<p>The function returns a comprehensive list object with results for each fitted model. The user can access the objects using the <code>$</code> symbol, as follows:</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="examples.html#cb51-1" tabindex="-1"></a><span class="co"># Available model results</span></span>
<span id="cb51-2"><a href="examples.html#cb51-2" tabindex="-1"></a><span class="fu">names</span>(result_unimodal<span class="sc">$</span>results)</span></code></pre></div>
<pre><code>## [1] &quot;norm.loc&quot; &quot;norm.sca&quot; &quot;lognorm&quot;</code></pre>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="examples.html#cb53-1" tabindex="-1"></a><span class="co"># Parameter estimates for Normal Location model</span></span>
<span id="cb53-2"><a href="examples.html#cb53-2" tabindex="-1"></a><span class="fu">print</span>(result_unimodal<span class="sc">$</span>results<span class="sc">$</span>norm.loc<span class="sc">$</span>estimates)</span></code></pre></div>
<pre><code>##                       par       s.e.
## Mode(mesh1)     54.600084 0.07305819
## Std dev.(mesh1)  5.147949 0.06709739</code></pre>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="examples.html#cb55-1" tabindex="-1"></a><span class="co"># Parameter estimates for Normal Scale model</span></span>
<span id="cb55-2"><a href="examples.html#cb55-2" tabindex="-1"></a><span class="fu">print</span>(result_unimodal<span class="sc">$</span>results<span class="sc">$</span>norm.sca<span class="sc">$</span>estimates)</span></code></pre></div>
<pre><code>##                       par       s.e.
## Mode(mesh1)     55.282277 0.06986564
## Std dev.(mesh1)  4.343513 0.05268696</code></pre>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="examples.html#cb57-1" tabindex="-1"></a><span class="co"># Parameter estimates for Lognormal model</span></span>
<span id="cb57-2"><a href="examples.html#cb57-2" tabindex="-1"></a><span class="fu">print</span>(result_unimodal<span class="sc">$</span>results<span class="sc">$</span>lognorm<span class="sc">$</span>estimates)</span></code></pre></div>
<pre><code>##                       par       s.e.
## Mode(mesh1)     54.910902 0.07055028
## Std dev.(mesh1)  4.457549 0.05828204</code></pre>
<p>Here is an example of how to access the selection ogive (for all mesh sizes) for the <code>norm.loc</code> model.</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="examples.html#cb59-1" tabindex="-1"></a><span class="co"># Selection ogive matrix (selectivity by length and mesh size)</span></span>
<span id="cb59-2"><a href="examples.html#cb59-2" tabindex="-1"></a><span class="fu">print</span>(<span class="st">&quot;Selection Ogive Matrix (first 10 rows):&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;Selection Ogive Matrix (first 10 rows):&quot;</code></pre>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="examples.html#cb61-1" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">head</span>(result_unimodal<span class="sc">$</span>results<span class="sc">$</span>norm.loc<span class="sc">$</span>selection_ogive_mat, <span class="dv">10</span>))</span></code></pre></div>
<pre><code>##       Length        13.5         14      14.8      15.4       15.9
##  [1,]   52.5 0.920157978 0.72570316 0.3600821 0.1642659 0.07207511
##  [2,]   54.5 0.999811030 0.91853023 0.5818113 0.3187592 0.16292195
##  [3,]   56.5 0.934163686 0.99971780 0.8083741 0.5318972 0.31668203
##  [4,]   58.5 0.750546437 0.93564461 0.9658110 0.7632066 0.52931815
##  [5,]   60.5 0.518539308 0.75299822 0.9922508 0.9416860 0.76078103
##  [6,]   62.5 0.308060013 0.52110652 0.8765976 0.9991245 0.94026896
##  [7,]   64.5 0.157376001 0.31010488 0.6659300 0.9115545 0.99929577
##  [8,]   66.5 0.069133924 0.15868658 0.4350173 0.7151468 0.91324127
##  [9,]   68.5 0.026115205 0.06982667 0.2443621 0.4824556 0.71767289
## [10,]   70.5 0.008482917 0.02642117 0.1180350 0.2798781 0.48497246
##             16.6         17.8           19
##  [1,] 0.01755223 0.0007710961 1.392758e-05
##  [2,] 0.04912666 0.0031128820 8.109595e-05
##  [3,] 0.11823648 0.0108060347 4.060432e-04
##  [4,] 0.24470078 0.0322566740 1.748215e-03
##  [5,] 0.43548050 0.0827984754 6.472424e-03
##  [6,] 0.66642551 0.1827572547 2.060576e-02
##  [7,] 0.87696859 0.3468777475 5.641049e-02
##  [8,] 0.99235256 0.5661451417 1.327947e-01
##  [9,] 0.96560050 0.7945635876 2.688134e-01
## [10,] 0.80793886 0.9589126819 4.679190e-01</code></pre>
</div>
<div id="extracting-mesh-specific-selectivity" class="section level4 hasAnchor" number="6.1.1.2">
<h4><span class="header-section-number">6.1.1.2</span> Extracting mesh-specific selectivity<a href="examples.html#extracting-mesh-specific-selectivity" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The user can extract selectivity curves for specific mesh sizes:</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="examples.html#cb63-1" tabindex="-1"></a><span class="co"># Extract selectivity for mesh size 17.8 cm (Normal Location model)</span></span>
<span id="cb63-2"><a href="examples.html#cb63-2" tabindex="-1"></a>mesh_17_8 <span class="ot">&lt;-</span> result_unimodal<span class="sc">$</span>selectivity_curves<span class="sc">$</span>norm.loc[, <span class="fu">c</span>(<span class="st">&quot;Length&quot;</span>, <span class="st">&quot;17.8&quot;</span>)]</span>
<span id="cb63-3"><a href="examples.html#cb63-3" tabindex="-1"></a></span>
<span id="cb63-4"><a href="examples.html#cb63-4" tabindex="-1"></a><span class="co"># Display first 10 rows</span></span>
<span id="cb63-5"><a href="examples.html#cb63-5" tabindex="-1"></a><span class="fu">print</span>(<span class="st">&quot;Selectivity for 17.8 cm mesh (Normal Location model):&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;Selectivity for 17.8 cm mesh (Normal Location model):&quot;</code></pre>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="examples.html#cb65-1" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">head</span>(mesh_17_8, <span class="dv">20</span>))</span></code></pre></div>
<pre><code>##    Length         17.8
## 1      40 4.112843e-09
## 2      41 1.349610e-08
## 3      42 4.264683e-08
## 4      43 1.297710e-07
## 5      44 3.802602e-07
## 6      45 1.072992e-06
## 7      46 2.915577e-06
## 8      47 7.628953e-06
## 9      48 1.922285e-05
## 10     49 4.664261e-05
## 11     50 1.089834e-04
## 12     51 2.452169e-04
## 13     52 5.313158e-04
## 14     53 1.108581e-03
## 15     54 2.227381e-03
## 16     55 4.309570e-03
## 17     56 8.029450e-03
## 18     57 1.440622e-02
## 19     58 2.489010e-02
## 20     59 4.141099e-02</code></pre>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="examples.html#cb67-1" tabindex="-1"></a><span class="co"># Extract selectivity for mesh size 15.9 cm (Normal common spread model)</span></span>
<span id="cb67-2"><a href="examples.html#cb67-2" tabindex="-1"></a>mesh_15_9 <span class="ot">&lt;-</span> result_unimodal<span class="sc">$</span>selectivity_curves<span class="sc">$</span>norm.sca[, <span class="fu">c</span>(<span class="st">&quot;Length&quot;</span>, <span class="st">&quot;15.9&quot;</span>)]</span>
<span id="cb67-3"><a href="examples.html#cb67-3" tabindex="-1"></a></span>
<span id="cb67-4"><a href="examples.html#cb67-4" tabindex="-1"></a><span class="co"># Display first 10 rows</span></span>
<span id="cb67-5"><a href="examples.html#cb67-5" tabindex="-1"></a><span class="fu">print</span>(<span class="st">&quot;Selectivity for 15.9 cm mesh (Normal common spread model):&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;Selectivity for 15.9 cm mesh (Normal common spread model):&quot;</code></pre>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="examples.html#cb69-1" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">head</span>(mesh_15_9, <span class="dv">20</span>))</span></code></pre></div>
<pre><code>##    Length         15.9
## 1      40 5.864747e-06
## 2      41 1.501946e-05
## 3      42 3.702241e-05
## 4      43 8.783750e-05
## 5      44 2.005859e-04
## 6      45 4.408854e-04
## 7      46 9.327306e-04
## 8      47 1.899292e-03
## 9      48 3.722481e-03
## 10     49 7.022280e-03
## 11     50 1.275055e-02
## 12     51 2.228357e-02
## 13     52 3.748398e-02
## 14     53 6.068924e-02
## 15     54 9.457640e-02
## 16     55 1.418597e-01
## 17     56 2.048048e-01
## 18     57 2.845944e-01
## 19     58 3.806429e-01
## 20     59 4.900204e-01</code></pre>
</div>
<div id="calculating-aggregated-selectivity" class="section level4 hasAnchor" number="6.1.1.3">
<h4><span class="header-section-number">6.1.1.3</span> Calculating aggregated selectivity<a href="examples.html#calculating-aggregated-selectivity" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Use <code>get_composite_curve()</code> to calculate the combined selectivity across all mesh sizes. The following example shows how to get the aggregated selectivity for the Normal Location model (<code>norm.loc</code>).</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="examples.html#cb71-1" tabindex="-1"></a><span class="co"># Calculate aggregated selectivity curve</span></span>
<span id="cb71-2"><a href="examples.html#cb71-2" tabindex="-1"></a>aggregated_selectivity <span class="ot">&lt;-</span> <span class="fu">get_composite_curve</span>(</span>
<span id="cb71-3"><a href="examples.html#cb71-3" tabindex="-1"></a>  result_unimodal<span class="sc">$</span>results<span class="sc">$</span>norm.loc, </span>
<span id="cb71-4"><a href="examples.html#cb71-4" tabindex="-1"></a>  <span class="at">length_seq =</span> <span class="fu">seq</span>(<span class="dv">40</span>, <span class="dv">100</span>, <span class="dv">1</span>)</span>
<span id="cb71-5"><a href="examples.html#cb71-5" tabindex="-1"></a>)</span>
<span id="cb71-6"><a href="examples.html#cb71-6" tabindex="-1"></a></span>
<span id="cb71-7"><a href="examples.html#cb71-7" tabindex="-1"></a><span class="co"># Display first 10 values</span></span>
<span id="cb71-8"><a href="examples.html#cb71-8" tabindex="-1"></a><span class="fu">print</span>(<span class="st">&quot;Aggregated selectivity curve (first 10 values):&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;Aggregated selectivity curve (first 10 values):&quot;</code></pre>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="examples.html#cb73-1" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">head</span>(aggregated_selectivity, <span class="dv">10</span>))</span></code></pre></div>
<pre><code>##    Length Selectivity
## 1      40 0.005309309
## 2      41 0.009262737
## 3      42 0.015598858
## 4      43 0.025365112
## 5      44 0.039841359
## 6      45 0.060475153
## 7      46 0.088754824
## 8      47 0.126021978
## 9      48 0.173242333
## 10     49 0.230771713</code></pre>
</div>
<div id="plotting-mesh-specific-and-aggregated-selectivity-curves" class="section level4 hasAnchor" number="6.1.1.4">
<h4><span class="header-section-number">6.1.1.4</span> Plotting mesh-specific and aggregated selectivity curves<a href="examples.html#plotting-mesh-specific-and-aggregated-selectivity-curves" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Use <code>plot_mesh_curves()</code> to create plots. The following example shows how to plot selectivity for the Normal Location model (<code>norm.loc</code>).</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="examples.html#cb75-1" tabindex="-1"></a><span class="co"># Plot selectivity curves for each mesh size</span></span>
<span id="cb75-2"><a href="examples.html#cb75-2" tabindex="-1"></a><span class="fu">plot_mesh_curves</span>(</span>
<span id="cb75-3"><a href="examples.html#cb75-3" tabindex="-1"></a>  result_unimodal, </span>
<span id="cb75-4"><a href="examples.html#cb75-4" tabindex="-1"></a>  <span class="st">&quot;norm.loc&quot;</span>,</span>
<span id="cb75-5"><a href="examples.html#cb75-5" tabindex="-1"></a>  <span class="at">length_seq =</span> <span class="fu">seq</span>(<span class="dv">40</span>, <span class="dv">100</span>, <span class="dv">1</span>),</span>
<span id="cb75-6"><a href="examples.html#cb75-6" tabindex="-1"></a>  <span class="at">save_plot =</span> <span class="cn">TRUE</span>,</span>
<span id="cb75-7"><a href="examples.html#cb75-7" tabindex="-1"></a>  <span class="at">output_dir =</span> <span class="st">&quot;model_plots_unimodal&quot;</span></span>
<span id="cb75-8"><a href="examples.html#cb75-8" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## Plot saved to: model_plots_unimodal/Curves_norm.loc.jpeg</code></pre>
<div class="figure"><span style="display:block;" id="fig:plot-mesh-curves1"></span>
<img src="figures/plot-mesh-curves1-1.png" alt="Mesh-specific and composite selectivity curves" width="3000" />
<p class="caption">
Figure 6.4: Mesh-specific and composite selectivity curves
</p>
</div>
</div>
<div id="comparing-unimodal-models" class="section level4 hasAnchor" number="6.1.1.5">
<h4><span class="header-section-number">6.1.1.5</span> Comparing unimodal models<a href="examples.html#comparing-unimodal-models" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Use the <code>compare_stats</code> function to generate a comprehensive comparison table. This function allows the user to save a CSV file with the outputs.</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="examples.html#cb77-1" tabindex="-1"></a><span class="co"># Generate comparison table for unimodal models</span></span>
<span id="cb77-2"><a href="examples.html#cb77-2" tabindex="-1"></a>comparison_unimodal <span class="ot">&lt;-</span> <span class="fu">compare_stats</span>(</span>
<span id="cb77-3"><a href="examples.html#cb77-3" tabindex="-1"></a>  result_unimodal,</span>
<span id="cb77-4"><a href="examples.html#cb77-4" tabindex="-1"></a>  <span class="at">include_bimodal =</span> <span class="cn">FALSE</span>,</span>
<span id="cb77-5"><a href="examples.html#cb77-5" tabindex="-1"></a>  <span class="at">save_csv =</span> <span class="cn">TRUE</span>, </span>
<span id="cb77-6"><a href="examples.html#cb77-6" tabindex="-1"></a>  <span class="at">filename =</span> <span class="st">&quot;model_plots_unimodal/unimodal_models_comparison.csv&quot;</span></span>
<span id="cb77-7"><a href="examples.html#cb77-7" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## Table saved to: model_plots_unimodal/unimodal_models_comparison.csv</code></pre>
<table>
<caption><span id="tab:comparison-table-example">Table 6.1: </span>Comparison of unimodal selectivity models</caption>
<thead>
<tr class="header">
<th align="left">Model</th>
<th align="right">LogLikelihood</th>
<th align="right">Deviance</th>
<th align="right">Mode1</th>
<th align="right">StdDev1</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">lognorm</td>
<td align="right">25014.23</td>
<td align="right">704.28</td>
<td align="right">54.91</td>
<td align="right">4.46</td>
</tr>
<tr class="even">
<td align="left">norm.sca</td>
<td align="right">24979.99</td>
<td align="right">772.76</td>
<td align="right">55.28</td>
<td align="right">4.34</td>
</tr>
<tr class="odd">
<td align="left">norm.loc</td>
<td align="right">24934.91</td>
<td align="right">862.92</td>
<td align="right">54.60</td>
<td align="right">5.15</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="example-2" class="section level3 hasAnchor" number="6.1.2">
<h3><span class="header-section-number">6.1.2</span> Example 2<a href="examples.html#example-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="fitting-all-models-including-bimodals-models" class="section level4 hasAnchor" number="6.1.2.1">
<h4><span class="header-section-number">6.1.2.1</span> Fitting all models, including bimodals models<a href="examples.html#fitting-all-models-including-bimodals-models" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>For more complex selectivity patterns, include bimodal models (<code>binorm.sca</code>: Bi-normal model and <code>bilognorm</code>: Bi-lognormal) by setting <code>run_bimodal = TRUE</code>. This fits all five available selectivity models using automatic starting values.</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="examples.html#cb79-1" tabindex="-1"></a><span class="co"># Fit all selectivity models</span></span>
<span id="cb79-2"><a href="examples.html#cb79-2" tabindex="-1"></a>result_all_auto <span class="ot">&lt;-</span> <span class="fu">fit_gillnet_dome</span>(</span>
<span id="cb79-3"><a href="examples.html#cb79-3" tabindex="-1"></a>  <span class="at">input_data =</span> input_data,</span>
<span id="cb79-4"><a href="examples.html#cb79-4" tabindex="-1"></a>  <span class="at">mesh_sizes =</span> mesh_sizes,</span>
<span id="cb79-5"><a href="examples.html#cb79-5" tabindex="-1"></a>  <span class="at">run_bimodal =</span> <span class="cn">TRUE</span>,</span>
<span id="cb79-6"><a href="examples.html#cb79-6" tabindex="-1"></a>  <span class="at">output_dir =</span> <span class="st">&quot;model_plots_all_auto&quot;</span>,</span>
<span id="cb79-7"><a href="examples.html#cb79-7" tabindex="-1"></a>  <span class="at">length_seq =</span> <span class="fu">seq</span>(<span class="dv">40</span>, <span class="dv">100</span>, <span class="dv">1</span>)</span>
<span id="cb79-8"><a href="examples.html#cb79-8" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## Warning in sqrt(diag(varpars)): NaNs produced</code></pre>
<p>The function automatically generates plots for each fitted selectivity model and saves them in the specified output directory (e.g., <code>model_plots_all_auto</code>).</p>
<div class="figure"><span style="display:block;" id="fig:binormsca-example1"></span>
<img src="model_plots_all_auto/Combined_binorm.sca.jpeg" alt="Binormal sca (binorm.sca) selectivity curves and residuals. The top panel shows the selectivity curves for each mesh size, while the bottom panel displays the deviance residuals." width="60%" />
<p class="caption">
Figure 6.5: Binormal sca (binorm.sca) selectivity curves and residuals. The top panel shows the selectivity curves for each mesh size, while the bottom panel displays the deviance residuals.
</p>
</div>
<div class="figure"><span style="display:block;" id="fig:bilognorm-example1"></span>
<img src="model_plots_all_auto/Combined_bilognorm.jpeg" alt="Bilognormal model (bilognorm) selectivity curves and residuals. The top panel shows the selectivity curves for each mesh size, while the bottom panel displays the deviance residuals." width="60%" />
<p class="caption">
Figure 6.6: Bilognormal model (bilognorm) selectivity curves and residuals. The top panel shows the selectivity curves for each mesh size, while the bottom panel displays the deviance residuals.
</p>
</div>
<p>The function returns a comprehensive list object with results for each fitted model. The user can access the objects using the $ symbol, as follows:</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="examples.html#cb81-1" tabindex="-1"></a><span class="co"># Available model results</span></span>
<span id="cb81-2"><a href="examples.html#cb81-2" tabindex="-1"></a><span class="fu">names</span>(result_all_auto<span class="sc">$</span>results)</span></code></pre></div>
<pre><code>## [1] &quot;norm.loc&quot;   &quot;norm.sca&quot;   &quot;lognorm&quot;    &quot;binorm.sca&quot; &quot;bilognorm&quot;</code></pre>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="examples.html#cb83-1" tabindex="-1"></a><span class="co"># Parameter estimates for binorm.sca model</span></span>
<span id="cb83-2"><a href="examples.html#cb83-2" tabindex="-1"></a><span class="fu">print</span>(result_all_auto<span class="sc">$</span>results<span class="sc">$</span>binorm.sca<span class="sc">$</span>estimates)</span></code></pre></div>
<pre><code>##                         par      s.e.
## Mode1(mesh1)     54.3225310 0.1316355
## Std dev.1(mesh1)  3.2269064 0.1337843
## Mode2(mesh1)     59.6532976 1.1968464
## Std dev.2(mesh1)  7.2744073 0.7121720
## P(mode1)          0.7901953 0.0407968</code></pre>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="examples.html#cb85-1" tabindex="-1"></a><span class="co"># Parameter estimates for bilognorm model</span></span>
<span id="cb85-2"><a href="examples.html#cb85-2" tabindex="-1"></a><span class="fu">print</span>(result_all_auto<span class="sc">$</span>results<span class="sc">$</span>bilognorm<span class="sc">$</span>estimates)</span></code></pre></div>
<pre><code>##                         par       s.e.
## Mode1(mesh1)     54.4858569 0.06528697
## Std dev.1(mesh1)  3.6471542 0.04494561
## Mode2(mesh1)     78.3148120        NaN
## Std dev.2(mesh1) 26.0932316        NaN
## P(mode1)          0.8635046        NaN</code></pre>
<p>Here is an example of how to access the selection ogive (for all mesh sizes) for the <code>binorm</code> and <code>bilognorm</code> models.</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="examples.html#cb87-1" tabindex="-1"></a><span class="co"># Selection ogive matrix (selectivity by length and mesh size)</span></span>
<span id="cb87-2"><a href="examples.html#cb87-2" tabindex="-1"></a><span class="fu">print</span>(<span class="st">&quot;Selection Ogive Matrix (first 10 rows):&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;Selection Ogive Matrix (first 10 rows):&quot;</code></pre>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="examples.html#cb89-1" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">head</span>(result_all_auto<span class="sc">$</span>results<span class="sc">$</span>binorm.sca<span class="sc">$</span>selection_ogive_mat, <span class="dv">10</span>))</span></code></pre></div>
<pre><code>##       Length      13.5        14      14.8       15.4       15.9
##  [1,]   52.5 0.8030715 0.5069798 0.1649934 0.06517818 0.03273717
##  [2,]   54.5 0.9522461 0.8102611 0.3673230 0.15625122 0.07387006
##  [3,]   56.5 0.8202936 0.9521900 0.6570273 0.34183870 0.17172061
##  [4,]   58.5 0.5490164 0.8308804 0.9002506 0.61520946 0.36125853
##  [5,]   60.5 0.3348435 0.5705555 0.9361642 0.86850960 0.62930073
##  [6,]   62.5 0.2261985 0.3538089 0.7550065 0.94975497 0.87174299
##  [7,]   64.5 0.1735095 0.2376248 0.5057878 0.81518812 0.95021819
##  [8,]   66.5 0.1353649 0.1815174 0.3227579 0.57650228 0.82480418
##  [9,]   68.5 0.1002017 0.1435352 0.2267997 0.37316321 0.59499761
## [10,]   70.5 0.0690314 0.1090331 0.1775600 0.25469460 0.39112094
##             16.6        17.8          19
##  [1,] 0.01506024 0.005128329 0.001870887
##  [2,] 0.02925808 0.009044604 0.003350637
##  [3,] 0.06283026 0.015989792 0.005806168
##  [4,] 0.14166006 0.029851447 0.009853976
##  [5,] 0.29908700 0.060872776 0.016856752
##  [6,] 0.54017873 0.130029363 0.030381864
##  [7,] 0.79690933 0.265043607 0.059216942
##  [8,] 0.94445433 0.476509305 0.120588379
##  [9,] 0.90174221 0.723154066 0.237610562
## [10,] 0.71058796 0.909214143 0.423048376</code></pre>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="examples.html#cb91-1" tabindex="-1"></a><span class="co"># Selection ogive matrix (selectivity by length and mesh size)</span></span>
<span id="cb91-2"><a href="examples.html#cb91-2" tabindex="-1"></a><span class="fu">print</span>(<span class="st">&quot;Selection Ogive Matrix (first 10 rows):&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;Selection Ogive Matrix (first 10 rows):&quot;</code></pre>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="examples.html#cb93-1" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">head</span>(result_all_auto<span class="sc">$</span>results<span class="sc">$</span>bilognorm<span class="sc">$</span>selection_ogive_mat, <span class="dv">10</span>))</span></code></pre></div>
<pre><code>##       Length      13.5        14      14.8       15.4       15.9
##  [1,]   52.5 0.7906976 0.5115406 0.1625205 0.05905702 0.02911427
##  [2,]   54.5 0.9253369 0.7972326 0.3724503 0.15330716 0.06769553
##  [3,]   56.5 0.8155435 0.9252546 0.6555444 0.34652595 0.16961054
##  [4,]   58.5 0.5687858 0.8246240 0.8782271 0.61595497 0.36629636
##  [5,]   60.5 0.3406743 0.5896322 0.9129551 0.84980985 0.62934127
##  [6,]   62.5 0.2026631 0.3629373 0.7587812 0.92377141 0.85271088
##  [7,]   64.5 0.1430765 0.2177200 0.5260476 0.81115238 0.92411829
##  [8,]   66.5 0.1257811 0.1499820 0.3262018 0.59533941 0.81941640
##  [9,]   68.5 0.1247992 0.1275632 0.2034513 0.38513118 0.61296306
## [10,]   70.5 0.1281705 0.1243437 0.1464275 0.24024488 0.40528715
##             16.6        17.8          19
##  [1,] 0.01589357 0.008682831 0.004965900
##  [2,] 0.02627352 0.011811785 0.006879007
##  [3,] 0.05675317 0.016517877 0.009286981
##  [4,] 0.13794049 0.026750453 0.012384539
##  [5,] 0.30266416 0.054843590 0.017104670
##  [6,] 0.54387485 0.125714700 0.027179493
##  [7,] 0.78508810 0.267416299 0.053236762
##  [8,] 0.91785623 0.481620170 0.115817146
##  [9,] 0.88453746 0.717323772 0.238822026
## [10,] 0.71934749 0.886234373 0.428552163</code></pre>
</div>
<div id="extracting-mesh-specific-selectivity-1" class="section level4 hasAnchor" number="6.1.2.2">
<h4><span class="header-section-number">6.1.2.2</span> Extracting mesh-specific selectivity<a href="examples.html#extracting-mesh-specific-selectivity-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The user can extract selectivity curves for specific mesh sizes:</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="examples.html#cb95-1" tabindex="-1"></a><span class="co"># Extract selectivity for mesh size 14.8 cm (binorm.sca model)</span></span>
<span id="cb95-2"><a href="examples.html#cb95-2" tabindex="-1"></a>mesh_14_8 <span class="ot">&lt;-</span> result_all_auto<span class="sc">$</span>selectivity_curves<span class="sc">$</span>binorm.sca[, <span class="fu">c</span>(<span class="st">&quot;Length&quot;</span>, <span class="st">&quot;14.8&quot;</span>)]</span>
<span id="cb95-3"><a href="examples.html#cb95-3" tabindex="-1"></a></span>
<span id="cb95-4"><a href="examples.html#cb95-4" tabindex="-1"></a><span class="co"># Display first 10 rows</span></span>
<span id="cb95-5"><a href="examples.html#cb95-5" tabindex="-1"></a><span class="fu">print</span>(<span class="st">&quot;Selectivity for 14.8 cm mesh (binorm.sca model):&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;Selectivity for 14.8 cm mesh (binorm.sca model):&quot;</code></pre>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="examples.html#cb97-1" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">head</span>(mesh_14_8, <span class="dv">20</span>))</span></code></pre></div>
<pre><code>##    Length        14.8
## 1      40 0.001316737
## 2      41 0.001948243
## 3      42 0.002839152
## 4      43 0.004078372
## 5      44 0.005785166
## 6      45 0.008132920
## 7      46 0.011405358
## 8      47 0.016117339
## 9      48 0.023241646
## 10     49 0.034567393
## 11     50 0.053143061
## 12     51 0.083607577
## 13     52 0.132023919
## 14     53 0.204739313
## 15     54 0.306011971
## 16     55 0.434788177
## 17     56 0.581896770
## 18     57 0.729476686
## 19     58 0.854002175
## 20     59 0.932657127</code></pre>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="examples.html#cb99-1" tabindex="-1"></a><span class="co"># Extract selectivity for mesh size 16.6 cm (bilognorm model)</span></span>
<span id="cb99-2"><a href="examples.html#cb99-2" tabindex="-1"></a>mesh_16_6 <span class="ot">&lt;-</span> result_all_auto<span class="sc">$</span>selectivity_curves<span class="sc">$</span>bilognorm[, <span class="fu">c</span>(<span class="st">&quot;Length&quot;</span>, <span class="st">&quot;16.6&quot;</span>)]</span>
<span id="cb99-3"><a href="examples.html#cb99-3" tabindex="-1"></a></span>
<span id="cb99-4"><a href="examples.html#cb99-4" tabindex="-1"></a><span class="co"># Display first 10 rows</span></span>
<span id="cb99-5"><a href="examples.html#cb99-5" tabindex="-1"></a><span class="fu">print</span>(<span class="st">&quot;Selectivity for 16.6 cm mesh (bilognorm model):&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;Selectivity for 16.6 cm mesh (bilognorm model):&quot;</code></pre>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="examples.html#cb101-1" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">head</span>(mesh_16_6, <span class="dv">20</span>))</span></code></pre></div>
<pre><code>##    Length        16.6
## 1      40 0.001305255
## 2      41 0.001688938
## 3      42 0.002156548
## 4      43 0.002719410
## 5      44 0.003389041
## 6      45 0.004176944
## 7      46 0.005094418
## 8      47 0.006152537
## 9      48 0.007362833
## 10     49 0.008740446
## 11     50 0.010314660
## 12     51 0.012158045
## 13     52 0.014454991
## 14     53 0.017638553
## 15     54 0.022619119
## 16     55 0.031092032
## 17     56 0.045834557
## 18     57 0.070805346
## 19     58 0.110802443
## 20     59 0.170498991</code></pre>
</div>
<div id="calculating-aggregated-selectivity-1" class="section level4 hasAnchor" number="6.1.2.3">
<h4><span class="header-section-number">6.1.2.3</span> Calculating aggregated selectivity<a href="examples.html#calculating-aggregated-selectivity-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Use <code>get_composite_curve()</code> to calculate the combined selectivity across all mesh sizes. The following example shows how to get the aggregated selectivity for the Bi-normal model (<code>binorm.sca</code>).</p>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="examples.html#cb103-1" tabindex="-1"></a><span class="co"># Calculate aggregated selectivity curve</span></span>
<span id="cb103-2"><a href="examples.html#cb103-2" tabindex="-1"></a>aggregated_selectivity <span class="ot">&lt;-</span> <span class="fu">get_composite_curve</span>(</span>
<span id="cb103-3"><a href="examples.html#cb103-3" tabindex="-1"></a>  result_all_auto<span class="sc">$</span>results<span class="sc">$</span>binorm.sca, </span>
<span id="cb103-4"><a href="examples.html#cb103-4" tabindex="-1"></a>  <span class="at">length_seq =</span> <span class="fu">seq</span>(<span class="dv">40</span>, <span class="dv">100</span>, <span class="dv">1</span>)</span>
<span id="cb103-5"><a href="examples.html#cb103-5" tabindex="-1"></a>)</span>
<span id="cb103-6"><a href="examples.html#cb103-6" tabindex="-1"></a></span>
<span id="cb103-7"><a href="examples.html#cb103-7" tabindex="-1"></a><span class="co"># Display first 10 values</span></span>
<span id="cb103-8"><a href="examples.html#cb103-8" tabindex="-1"></a><span class="fu">print</span>(<span class="st">&quot;Aggregated selectivity curve (first 10 values):&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;Aggregated selectivity curve (first 10 values):&quot;</code></pre>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb105-1"><a href="examples.html#cb105-1" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">head</span>(aggregated_selectivity, <span class="dv">10</span>))</span></code></pre></div>
<pre><code>##    Length Selectivity
## 1      40 0.002939409
## 2      41 0.004303078
## 3      42 0.006245301
## 4      43 0.009058137
## 5      44 0.013276489
## 6      45 0.019892823
## 7      46 0.030652673
## 8      47 0.048325650
## 9      48 0.076714490
## 10     49 0.120094088</code></pre>
</div>
<div id="plotting-mesh-specific-and-aggregated-selectivity-curves-1" class="section level4 hasAnchor" number="6.1.2.4">
<h4><span class="header-section-number">6.1.2.4</span> Plotting mesh-specific and aggregated selectivity curves<a href="examples.html#plotting-mesh-specific-and-aggregated-selectivity-curves-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Use <code>plot_mesh_curves()</code> to create plots. The following example shows how to plot selectivity for the Bi-normal model (<code>binorm.sca</code>).</p>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb107-1"><a href="examples.html#cb107-1" tabindex="-1"></a><span class="co"># Plot selectivity curves for each mesh size</span></span>
<span id="cb107-2"><a href="examples.html#cb107-2" tabindex="-1"></a><span class="fu">plot_mesh_curves</span>(</span>
<span id="cb107-3"><a href="examples.html#cb107-3" tabindex="-1"></a>  result_all_auto, </span>
<span id="cb107-4"><a href="examples.html#cb107-4" tabindex="-1"></a>  <span class="st">&quot;binorm.sca&quot;</span>,</span>
<span id="cb107-5"><a href="examples.html#cb107-5" tabindex="-1"></a>  <span class="at">length_seq =</span> <span class="fu">seq</span>(<span class="dv">40</span>, <span class="dv">100</span>, <span class="dv">1</span>),</span>
<span id="cb107-6"><a href="examples.html#cb107-6" tabindex="-1"></a>  <span class="at">save_plot =</span> <span class="cn">TRUE</span>,</span>
<span id="cb107-7"><a href="examples.html#cb107-7" tabindex="-1"></a>  <span class="at">output_dir =</span> <span class="st">&quot;model_plots_all_auto&quot;</span></span>
<span id="cb107-8"><a href="examples.html#cb107-8" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## Plot saved to: model_plots_all_auto/Curves_binorm.sca.jpeg</code></pre>
<div class="figure"><span style="display:block;" id="fig:plot-mesh-curves2"></span>
<img src="figures/plot-mesh-curves2-1.png" alt="Mesh-specific and composite selectivity curves" width="3000" />
<p class="caption">
Figure 6.7: Mesh-specific and composite selectivity curves
</p>
</div>
</div>
<div id="comparing-all-models" class="section level4 hasAnchor" number="6.1.2.5">
<h4><span class="header-section-number">6.1.2.5</span> Comparing all models<a href="examples.html#comparing-all-models" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Use the <code>compare_stats</code> function to generate a comprehensive comparison table. This function allows the user to save a CSV file with the outputs.</p>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb109-1"><a href="examples.html#cb109-1" tabindex="-1"></a><span class="co"># Generate comparison table for unimodal models</span></span>
<span id="cb109-2"><a href="examples.html#cb109-2" tabindex="-1"></a>comparison_all_auto <span class="ot">&lt;-</span> <span class="fu">compare_stats</span>(</span>
<span id="cb109-3"><a href="examples.html#cb109-3" tabindex="-1"></a>  result_all_auto,</span>
<span id="cb109-4"><a href="examples.html#cb109-4" tabindex="-1"></a>  <span class="at">include_bimodal =</span> <span class="cn">TRUE</span>,</span>
<span id="cb109-5"><a href="examples.html#cb109-5" tabindex="-1"></a>  <span class="at">save_csv =</span> <span class="cn">TRUE</span>, </span>
<span id="cb109-6"><a href="examples.html#cb109-6" tabindex="-1"></a>  <span class="at">filename =</span> <span class="st">&quot;model_plots_all_auto/all_models_comparison.csv&quot;</span></span>
<span id="cb109-7"><a href="examples.html#cb109-7" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## Table saved to: model_plots_all_auto/all_models_comparison.csv</code></pre>
<table style="width:100%;">
<caption><span id="tab:all-model-comparison2">Table 6.2: </span>Comparison of all selectivity models</caption>
<colgroup>
<col width="12%" />
<col width="17%" />
<col width="10%" />
<col width="11%" />
<col width="13%" />
<col width="11%" />
<col width="13%" />
<col width="9%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Model</th>
<th align="right">Log Likelihood</th>
<th align="right">Deviance</th>
<th align="right">Mode1 cm</th>
<th align="right">StdDev1 cm</th>
<th align="right">Mode2 cm</th>
<th align="right">StdDev2 cm</th>
<th align="right">P_Mode1</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">bilognorm</td>
<td align="right">25093.30</td>
<td align="right">546.13</td>
<td align="right">54.49</td>
<td align="right">3.65</td>
<td align="right">78.31</td>
<td align="right">26.09</td>
<td align="right">0.86</td>
</tr>
<tr class="even">
<td align="left">binorm.sca</td>
<td align="right">25091.39</td>
<td align="right">549.96</td>
<td align="right">54.32</td>
<td align="right">3.23</td>
<td align="right">59.65</td>
<td align="right">7.27</td>
<td align="right">0.79</td>
</tr>
<tr class="odd">
<td align="left">lognorm</td>
<td align="right">25014.23</td>
<td align="right">704.28</td>
<td align="right">54.91</td>
<td align="right">4.46</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="left">norm.sca</td>
<td align="right">24979.99</td>
<td align="right">772.76</td>
<td align="right">55.28</td>
<td align="right">4.34</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
<tr class="odd">
<td align="left">norm.loc</td>
<td align="right">24934.91</td>
<td align="right">862.92</td>
<td align="right">54.60</td>
<td align="right">5.15</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="example-3" class="section level3 hasAnchor" number="6.1.3">
<h3><span class="header-section-number">6.1.3</span> Example 3<a href="examples.html#example-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="fitting-all-models-including-bimodals-with-manual-starting-values" class="section level4 hasAnchor" number="6.1.3.1">
<h4><span class="header-section-number">6.1.3.1</span> Fitting all models, including bimodals with manual starting values<a href="examples.html#fitting-all-models-including-bimodals-with-manual-starting-values" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>For better control over the optimization process, especially with bimodal models (<code>binorm.sca``: Bi-normal model and</code>bilognorm`: Bi-lognormal), the user can specify manual starting values:</p>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb111-1"><a href="examples.html#cb111-1" tabindex="-1"></a><span class="co"># Define manual starting values for bimodal models</span></span>
<span id="cb111-2"><a href="examples.html#cb111-2" tabindex="-1"></a>manual_starts <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb111-3"><a href="examples.html#cb111-3" tabindex="-1"></a>  <span class="at">binorm.sca =</span> <span class="fu">c</span>(<span class="dv">55</span>, <span class="dv">4</span>, <span class="dv">65</span>, <span class="dv">4</span>, <span class="dv">3</span>),     <span class="co"># Mode1, SD1, Mode2, SD2, logit(P1)</span></span>
<span id="cb111-4"><a href="examples.html#cb111-4" tabindex="-1"></a>  <span class="at">bilognorm =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="fl">0.2</span>, <span class="fl">4.2</span>, <span class="fl">0.1</span>, <span class="dv">2</span>)  <span class="co"># log(mu1), log(sigma1), log(mu2), log(sigma2), logit(P1)</span></span>
<span id="cb111-5"><a href="examples.html#cb111-5" tabindex="-1"></a>)</span>
<span id="cb111-6"><a href="examples.html#cb111-6" tabindex="-1"></a><span class="co"># Fit models with manual starting values</span></span>
<span id="cb111-7"><a href="examples.html#cb111-7" tabindex="-1"></a>result_all_manual <span class="ot">&lt;-</span> <span class="fu">fit_gillnet_dome</span>(</span>
<span id="cb111-8"><a href="examples.html#cb111-8" tabindex="-1"></a>  <span class="at">input_data =</span> input_data,</span>
<span id="cb111-9"><a href="examples.html#cb111-9" tabindex="-1"></a>  <span class="at">mesh_sizes =</span> mesh_sizes,</span>
<span id="cb111-10"><a href="examples.html#cb111-10" tabindex="-1"></a>  <span class="at">manual_x0_list =</span> manual_starts,</span>
<span id="cb111-11"><a href="examples.html#cb111-11" tabindex="-1"></a>  <span class="at">run_bimodal =</span> <span class="cn">TRUE</span>,</span>
<span id="cb111-12"><a href="examples.html#cb111-12" tabindex="-1"></a>  <span class="at">output_dir =</span> <span class="st">&quot;model_plots_all_manual&quot;</span>,</span>
<span id="cb111-13"><a href="examples.html#cb111-13" tabindex="-1"></a>  <span class="at">length_seq =</span> <span class="fu">seq</span>(<span class="dv">40</span>, <span class="dv">100</span>, <span class="dv">1</span>)</span>
<span id="cb111-14"><a href="examples.html#cb111-14" tabindex="-1"></a>)</span></code></pre></div>
<p>The function automatically generates plots for each fitted selectivity model and saves them in the specified output directory (e.g., <code>model_plots_all_manual</code>).</p>
<div class="figure"><span style="display:block;" id="fig:binormsca-example3"></span>
<img src="model_plots_all_manual/Combined_binorm.sca.jpeg" alt="Binormal sca (binorm.sca) selectivity curves and residuals. The top panel shows the selectivity curves for each mesh size, while the bottom panel displays the deviance residuals." width="60%" />
<p class="caption">
Figure 6.8: Binormal sca (binorm.sca) selectivity curves and residuals. The top panel shows the selectivity curves for each mesh size, while the bottom panel displays the deviance residuals.
</p>
</div>
<div class="figure"><span style="display:block;" id="fig:bilognorm-example3"></span>
<img src="model_plots_all_manual/Combined_bilognorm.jpeg" alt="Bilognormal model (bilognorm) selectivity curves and residuals. The top panel shows the selectivity curves for each mesh size, while the bottom panel displays the deviance residuals." width="60%" />
<p class="caption">
Figure 6.9: Bilognormal model (bilognorm) selectivity curves and residuals. The top panel shows the selectivity curves for each mesh size, while the bottom panel displays the deviance residuals.
</p>
</div>
<p>The function returns a comprehensive list object with results for each fitted model. The user can access the objects using the $ symbol, as follows:</p>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb112-1"><a href="examples.html#cb112-1" tabindex="-1"></a><span class="co"># Available model results</span></span>
<span id="cb112-2"><a href="examples.html#cb112-2" tabindex="-1"></a><span class="fu">names</span>(result_all_manual<span class="sc">$</span>results)</span></code></pre></div>
<pre><code>## [1] &quot;norm.loc&quot;   &quot;norm.sca&quot;   &quot;lognorm&quot;    &quot;binorm.sca&quot; &quot;bilognorm&quot;</code></pre>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb114-1"><a href="examples.html#cb114-1" tabindex="-1"></a><span class="co"># Parameter estimates for binorm.sca model</span></span>
<span id="cb114-2"><a href="examples.html#cb114-2" tabindex="-1"></a><span class="fu">print</span>(result_all_manual<span class="sc">$</span>results<span class="sc">$</span>binorm.sca<span class="sc">$</span>estimates)</span></code></pre></div>
<pre><code>##                         par       s.e.
## Mode1(mesh1)     54.3235714 0.13798557
## Std dev.1(mesh1)  3.2780203 0.13355660
## Mode2(mesh1)     59.8074724 1.32748734
## Std dev.2(mesh1)  7.3256977 0.79623248
## P(mode1)          0.7923451 0.04245935</code></pre>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb116-1"><a href="examples.html#cb116-1" tabindex="-1"></a><span class="co"># Parameter estimates for bilognorm model</span></span>
<span id="cb116-2"><a href="examples.html#cb116-2" tabindex="-1"></a><span class="fu">print</span>(result_all_manual<span class="sc">$</span>results<span class="sc">$</span>bilognorm<span class="sc">$</span>estimates)</span></code></pre></div>
<pre><code>##                         par       s.e.
## Mode1(mesh1)     54.4756989 0.08838970
## Std dev.1(mesh1)  3.6144047 0.10520153
## Mode2(mesh1)     65.4477215 4.85438585
## Std dev.2(mesh1) 15.2583192 4.46442782
## P(mode1)          0.8885962 0.01697675</code></pre>
<p>Here is an example of how to access the selection ogive (for all mesh sizes) for the <code>binorm</code> and <code>bilognorm</code> models (models fitted using manual starting values).</p>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb118-1"><a href="examples.html#cb118-1" tabindex="-1"></a><span class="co"># Selection ogive matrix (selectivity by length and mesh size)</span></span>
<span id="cb118-2"><a href="examples.html#cb118-2" tabindex="-1"></a><span class="fu">print</span>(<span class="st">&quot;Selection Ogive Matrix (first 10 rows):&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;Selection Ogive Matrix (first 10 rows):&quot;</code></pre>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb120-1"><a href="examples.html#cb120-1" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">head</span>(result_all_manual<span class="sc">$</span>results<span class="sc">$</span>binorm.sca<span class="sc">$</span>selection_ogive_mat, <span class="dv">10</span>))</span></code></pre></div>
<pre><code>##       Length       13.5        14      14.8       15.4       15.9
##  [1,]   52.5 0.80501771 0.5139128 0.1706424 0.06745457 0.03342761
##  [2,]   54.5 0.95091906 0.8120463 0.3750070 0.16168890 0.07653556
##  [3,]   56.5 0.82314310 0.9508570 0.6618921 0.34950372 0.17752318
##  [4,]   58.5 0.55628162 0.8334593 0.8999424 0.62075937 0.36894296
##  [5,]   60.5 0.34100575 0.5776670 0.9355857 0.86894954 0.63462837
##  [6,]   62.5 0.22940270 0.3603052 0.7593693 0.94862310 0.87210677
##  [7,]   64.5 0.17553847 0.2411976 0.5132374 0.81816555 0.94906242
##  [8,]   66.5 0.13760668 0.1836167 0.3286779 0.58356448 0.82753924
##  [9,]   68.5 0.10277695 0.1456849 0.2300231 0.37994454 0.60188804
## [10,]   70.5 0.07157392 0.1115508 0.1796182 0.25881336 0.39811903
##             16.6        17.8          19
##  [1,] 0.01503676 0.005061236 0.001854765
##  [2,] 0.02978049 0.008948484 0.003310710
##  [3,] 0.06499816 0.015989289 0.005730395
##  [4,] 0.14671383 0.030402075 0.009759185
##  [5,] 0.30658976 0.062949174 0.016880027
##  [6,] 0.54675243 0.134747375 0.030957894
##  [7,] 0.79899252 0.272286992 0.061215201
##  [8,] 0.94317675 0.483716104 0.125013155
##  [9,] 0.90231195 0.726789403 0.244550345
## [10,] 0.71582689 0.908696457 0.430594111</code></pre>
<div class="sourceCode" id="cb122"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb122-1"><a href="examples.html#cb122-1" tabindex="-1"></a><span class="co"># Selection ogive matrix (selectivity by length and mesh size)</span></span>
<span id="cb122-2"><a href="examples.html#cb122-2" tabindex="-1"></a><span class="fu">print</span>(<span class="st">&quot;Selection Ogive Matrix (first 10 rows):&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;Selection Ogive Matrix (first 10 rows):&quot;</code></pre>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb124-1"><a href="examples.html#cb124-1" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">head</span>(result_all_manual<span class="sc">$</span>results<span class="sc">$</span>bilognorm<span class="sc">$</span>selection_ogive_mat, <span class="dv">10</span>))</span></code></pre></div>
<pre><code>##       Length      13.5        14      14.8       15.4       15.9
##  [1,]   52.5 0.8250696 0.5327307 0.1696513 0.06261988 0.03118562
##  [2,]   54.5 0.9661127 0.8319239 0.3876150 0.16011951 0.07158238
##  [3,]   56.5 0.8503227 0.9660310 0.6833954 0.36062239 0.17698821
##  [4,]   58.5 0.5918750 0.8598659 0.9168711 0.64193936 0.38120570
##  [5,]   60.5 0.3540786 0.6136509 0.9529089 0.88707225 0.65595410
##  [6,]   62.5 0.2095821 0.3772698 0.7907281 0.96438700 0.89011485
##  [7,]   64.5 0.1442487 0.2255093 0.5472609 0.84570893 0.96475853
##  [8,]   66.5 0.1201446 0.1522825 0.3389986 0.61961430 0.85439259
##  [9,]   68.5 0.1110202 0.1235701 0.2104182 0.40038574 0.63803374
## [10,]   70.5 0.1053521 0.1127812 0.1481840 0.24920348 0.42137967
##             16.6        17.8          19
##  [1,] 0.01642821 0.007717878 0.003650354
##  [2,] 0.02811931 0.011482361 0.005666578
##  [3,] 0.06022595 0.017166514 0.008429273
##  [4,] 0.14422724 0.028636484 0.012183348
##  [5,] 0.31499839 0.058240207 0.017855118
##  [6,] 0.56652779 0.131587321 0.029100847
##  [7,] 0.81918618 0.278378292 0.056568090
##  [8,] 0.95835970 0.501475932 0.121356278
##  [9,] 0.92291611 0.748131310 0.248701381
## [10,] 0.74938107 0.925264231 0.446090728</code></pre>
</div>
<div id="extracting-mesh-specific-selectivity-2" class="section level4 hasAnchor" number="6.1.3.2">
<h4><span class="header-section-number">6.1.3.2</span> Extracting Mesh-Specific Selectivity<a href="examples.html#extracting-mesh-specific-selectivity-2" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The user can extract selectivity curves for specific mesh sizes:</p>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb126-1"><a href="examples.html#cb126-1" tabindex="-1"></a><span class="co"># Extract selectivity for mesh size 14.8 cm (binorm.sca model)</span></span>
<span id="cb126-2"><a href="examples.html#cb126-2" tabindex="-1"></a>mesh_14_8 <span class="ot">&lt;-</span> result_all_manual<span class="sc">$</span>selectivity_curves<span class="sc">$</span>binorm.sca[, <span class="fu">c</span>(<span class="st">&quot;Length&quot;</span>, <span class="st">&quot;14.8&quot;</span>)]</span>
<span id="cb126-3"><a href="examples.html#cb126-3" tabindex="-1"></a></span>
<span id="cb126-4"><a href="examples.html#cb126-4" tabindex="-1"></a><span class="co"># Display first 10 rows</span></span>
<span id="cb126-5"><a href="examples.html#cb126-5" tabindex="-1"></a><span class="fu">print</span>(<span class="st">&quot;Selectivity for 14.8cm mesh (binorm.sca model):&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;Selectivity for 14.8cm mesh (binorm.sca model):&quot;</code></pre>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb128-1"><a href="examples.html#cb128-1" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">head</span>(mesh_14_8, <span class="dv">10</span>))</span></code></pre></div>
<pre><code>##    Length        14.8
## 1      40 0.001308562
## 2      41 0.001930941
## 3      42 0.002807605
## 4      43 0.004026767
## 5      44 0.005709644
## 6      45 0.008038522
## 7      46 0.011320713
## 8      47 0.016120196
## 9      48 0.023494027
## 10     49 0.035348129</code></pre>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb130-1"><a href="examples.html#cb130-1" tabindex="-1"></a><span class="co"># Extract selectivity for mesh size 16.6 cm (bilognorm model)</span></span>
<span id="cb130-2"><a href="examples.html#cb130-2" tabindex="-1"></a>mesh_16_6 <span class="ot">&lt;-</span> result_all_manual<span class="sc">$</span>selectivity_curves<span class="sc">$</span>bilognorm[, <span class="fu">c</span>(<span class="st">&quot;Length&quot;</span>, <span class="st">&quot;16.6&quot;</span>)]</span>
<span id="cb130-3"><a href="examples.html#cb130-3" tabindex="-1"></a></span>
<span id="cb130-4"><a href="examples.html#cb130-4" tabindex="-1"></a><span class="co"># Display first 10 rows</span></span>
<span id="cb130-5"><a href="examples.html#cb130-5" tabindex="-1"></a><span class="fu">print</span>(<span class="st">&quot;Selectivity for 16.6cm mesh (bilognorm model):&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;Selectivity for 16.6cm mesh (bilognorm model):&quot;</code></pre>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb132-1"><a href="examples.html#cb132-1" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">head</span>(mesh_16_6, <span class="dv">10</span>))</span></code></pre></div>
<pre><code>##    Length         16.6
## 1      40 0.0005640103
## 2      41 0.0008139377
## 3      42 0.0011495654
## 4      43 0.0015910494
## 5      44 0.0021605543
## 6      45 0.0028817911
## 7      46 0.0037794337
## 8      47 0.0048785497
## 9      48 0.0062045436
## 10     49 0.0077852677</code></pre>
</div>
<div id="calculating-aggregated-selectivity-2" class="section level4 hasAnchor" number="6.1.3.3">
<h4><span class="header-section-number">6.1.3.3</span> Calculating aggregated selectivity<a href="examples.html#calculating-aggregated-selectivity-2" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The user can use <code>get_composite_curve()</code> to calculate the combined selectivity across all mesh sizes. The following example shows how to get the aggregated selectivity for the Bi-lognormal model (bilognorm).</p>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb134-1"><a href="examples.html#cb134-1" tabindex="-1"></a><span class="co"># Calculate aggregated selectivity curve</span></span>
<span id="cb134-2"><a href="examples.html#cb134-2" tabindex="-1"></a>aggregated_selectivity <span class="ot">&lt;-</span> <span class="fu">get_composite_curve</span>(</span>
<span id="cb134-3"><a href="examples.html#cb134-3" tabindex="-1"></a>  result_all_manual<span class="sc">$</span>results<span class="sc">$</span>bilognorm, </span>
<span id="cb134-4"><a href="examples.html#cb134-4" tabindex="-1"></a>  <span class="at">length_seq =</span> <span class="fu">seq</span>(<span class="dv">40</span>, <span class="dv">100</span>, <span class="dv">1</span>)</span>
<span id="cb134-5"><a href="examples.html#cb134-5" tabindex="-1"></a>)</span>
<span id="cb134-6"><a href="examples.html#cb134-6" tabindex="-1"></a></span>
<span id="cb134-7"><a href="examples.html#cb134-7" tabindex="-1"></a><span class="co"># Display first 10 values</span></span>
<span id="cb134-8"><a href="examples.html#cb134-8" tabindex="-1"></a><span class="fu">print</span>(<span class="st">&quot;Aggregated selectivity curve (first 10 values):&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;Aggregated selectivity curve (first 10 values):&quot;</code></pre>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb136-1"><a href="examples.html#cb136-1" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">head</span>(aggregated_selectivity, <span class="dv">10</span>))</span></code></pre></div>
<pre><code>##    Length Selectivity
## 1      40 0.005010173
## 2      41 0.006677579
## 3      42 0.008788167
## 4      43 0.011541483
## 5      44 0.015408243
## 6      45 0.021423536
## 7      46 0.031563602
## 8      47 0.049008538
## 9      48 0.077958682
## 10     49 0.122730987</code></pre>
</div>
<div id="plotting-mesh-specific-and-aggregated-selectivity-curves-2" class="section level4 hasAnchor" number="6.1.3.4">
<h4><span class="header-section-number">6.1.3.4</span> Plotting mesh-specific and aggregated selectivity curves<a href="examples.html#plotting-mesh-specific-and-aggregated-selectivity-curves-2" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Use <code>plot_mesh_curves()</code> to create plots. The following example shows how to plot selectivity for the Bi-normal model (binorm.sca).</p>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb138-1"><a href="examples.html#cb138-1" tabindex="-1"></a><span class="co"># Plot selectivity curves for each mesh size</span></span>
<span id="cb138-2"><a href="examples.html#cb138-2" tabindex="-1"></a><span class="fu">plot_mesh_curves</span>(</span>
<span id="cb138-3"><a href="examples.html#cb138-3" tabindex="-1"></a>  result_all_manual, </span>
<span id="cb138-4"><a href="examples.html#cb138-4" tabindex="-1"></a>  <span class="st">&quot;binorm.sca&quot;</span>,</span>
<span id="cb138-5"><a href="examples.html#cb138-5" tabindex="-1"></a>  <span class="at">length_seq =</span> <span class="fu">seq</span>(<span class="dv">40</span>, <span class="dv">100</span>, <span class="dv">1</span>),</span>
<span id="cb138-6"><a href="examples.html#cb138-6" tabindex="-1"></a>  <span class="at">save_plot =</span> <span class="cn">TRUE</span>,</span>
<span id="cb138-7"><a href="examples.html#cb138-7" tabindex="-1"></a>  <span class="at">output_dir =</span> <span class="st">&quot;model_plots_all_manual&quot;</span></span>
<span id="cb138-8"><a href="examples.html#cb138-8" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## Plot saved to: model_plots_all_manual/Curves_binorm.sca.jpeg</code></pre>
<div class="figure"><span style="display:block;" id="fig:plot-mesh-curves3"></span>
<img src="figures/plot-mesh-curves3-1.png" alt="Mesh-specific selectivity curves" width="3000" />
<p class="caption">
Figure 6.10: Mesh-specific selectivity curves
</p>
</div>
</div>
<div id="comparing-all-models-1" class="section level4 hasAnchor" number="6.1.3.5">
<h4><span class="header-section-number">6.1.3.5</span> Comparing all models<a href="examples.html#comparing-all-models-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>As before, the user can use <code>compare_stats()</code> function to generate a comprehensive comparison table. This function allows the user to save a CSV file with the outputs.</p>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb140-1"><a href="examples.html#cb140-1" tabindex="-1"></a><span class="co"># Generate comparison table for unimodal models</span></span>
<span id="cb140-2"><a href="examples.html#cb140-2" tabindex="-1"></a>comparison_all_manual <span class="ot">&lt;-</span> <span class="fu">compare_stats</span>(</span>
<span id="cb140-3"><a href="examples.html#cb140-3" tabindex="-1"></a>  result_all_manual,</span>
<span id="cb140-4"><a href="examples.html#cb140-4" tabindex="-1"></a>  <span class="at">include_bimodal =</span> <span class="cn">TRUE</span>,</span>
<span id="cb140-5"><a href="examples.html#cb140-5" tabindex="-1"></a>  <span class="at">save_csv =</span> <span class="cn">TRUE</span>, </span>
<span id="cb140-6"><a href="examples.html#cb140-6" tabindex="-1"></a>  <span class="at">filename =</span> <span class="st">&quot;model_plots_all_manual/all_models_comparison.csv&quot;</span></span>
<span id="cb140-7"><a href="examples.html#cb140-7" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## Table saved to: model_plots_all_manual/all_models_comparison.csv</code></pre>
<table style="width:100%;">
<caption><span id="tab:all-model-comparison-manual3">Table 6.3: </span>Comparison of all selectivity models</caption>
<colgroup>
<col width="12%" />
<col width="17%" />
<col width="10%" />
<col width="11%" />
<col width="13%" />
<col width="11%" />
<col width="13%" />
<col width="9%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Model</th>
<th align="right">Log Likelihood</th>
<th align="right">Deviance</th>
<th align="right">Mode1 cm</th>
<th align="right">StdDev1 cm</th>
<th align="right">Mode2 cm</th>
<th align="right">StdDev2 cm</th>
<th align="right">P_Mode1</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">bilognorm</td>
<td align="right">25093.60</td>
<td align="right">545.54</td>
<td align="right">54.48</td>
<td align="right">3.61</td>
<td align="right">65.45</td>
<td align="right">15.26</td>
<td align="right">0.89</td>
</tr>
<tr class="even">
<td align="left">binorm.sca</td>
<td align="right">25091.12</td>
<td align="right">550.49</td>
<td align="right">54.32</td>
<td align="right">3.28</td>
<td align="right">59.81</td>
<td align="right">7.33</td>
<td align="right">0.79</td>
</tr>
<tr class="odd">
<td align="left">lognorm</td>
<td align="right">25014.23</td>
<td align="right">704.28</td>
<td align="right">54.91</td>
<td align="right">4.46</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="left">norm.sca</td>
<td align="right">24979.99</td>
<td align="right">772.76</td>
<td align="right">55.28</td>
<td align="right">4.34</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
<tr class="odd">
<td align="left">norm.loc</td>
<td align="right">24934.91</td>
<td align="right">862.92</td>
<td align="right">54.60</td>
<td align="right">5.15</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div id="dome-shaped-lbspr" class="section level2 hasAnchor" number="6.2">
<h2><span class="header-section-number">6.2</span> <code>GTGDomeLBSPRSim2</code> function<a href="examples.html#dome-shaped-lbspr" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="practical-application-of-gtg-length-based-spr-model-including-dome-shaped-selectivity-step-by-step-example" class="section level3 hasAnchor" number="6.2.1">
<h3><span class="header-section-number">6.2.1</span> Practical Application of GTG Length-Based SPR model including dome-shaped selectivity: Step-by-Step Example<a href="examples.html#practical-application-of-gtg-length-based-spr-model-including-dome-shaped-selectivity-step-by-step-example" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>This example demonstrates how to perform a dome-shaped length-based spawning potential ratio (LBSPR) simulation using the Growth-Type Group model with support for dome-shaped gillnet selectivity curves.
This example demonstrates how to set up the <code>lengthComp</code> object, create the <code>LifeHistoryObj</code>, define selectivity models, run simulations, estimate parameters from length data, and visualize results.</p>
<p>The example code presented here was adapted from the original implementation (<a href="https://github.com/KHommik/DomeShaped_GTG_LBSPR" class="uri">https://github.com/KHommik/DomeShaped_GTG_LBSPR</a>) by <span class="citation">Hommik et al. (<a href="#ref-hommik2020">2020</a>)</span>, with modifications to accommodate additional selectivity models and updated simulation routines.</p>
<div id="step-1.-setting-up-the-environment" class="section level4 hasAnchor" number="6.2.1.1">
<h4><span class="header-section-number">6.2.1.1</span> Step 1. Setting Up the Environment<a href="examples.html#step-1.-setting-up-the-environment" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Load the required packages and data:</p>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb142-1"><a href="examples.html#cb142-1" tabindex="-1"></a><span class="fu">library</span>(fishLengthAssess)</span>
<span id="cb142-2"><a href="examples.html#cb142-2" tabindex="-1"></a><span class="fu">library</span>(fishSimGTG)</span>
<span id="cb142-3"><a href="examples.html#cb142-3" tabindex="-1"></a></span>
<span id="cb142-4"><a href="examples.html#cb142-4" tabindex="-1"></a><span class="co"># Load the example gillnet data</span></span>
<span id="cb142-5"><a href="examples.html#cb142-5" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;raw_data_gillnet&quot;</span>)</span>
<span id="cb142-6"><a href="examples.html#cb142-6" tabindex="-1"></a>input_data <span class="ot">&lt;-</span> raw_data_gillnet</span>
<span id="cb142-7"><a href="examples.html#cb142-7" tabindex="-1"></a>input_data</span></code></pre></div>
<pre><code>##      V1  V2  V3  V4  V5  V6  V7 V8 V9
## 1  52.5  52  11   1   1   0   0  0  0
## 2  54.5 102  91  16   4   4   2  0  3
## 3  56.5 295 232 131  61  17  13  3  1
## 4  58.5 309 318 362 243  95  26  4  3
## 5  60.5 118 173 326 342 199 100 10 11
## 6  62.5  79  87 191 239 202 201 39 15
## 7  64.5  27  48 111 143 133 185 72 25
## 8  66.5  14  17  44  51  52 122 74 41
## 9  68.5   8   6  14  23  25  59 65 76
## 10 70.5   7   3   8  14  15  16 34 33
## 11 72.5   0   3   1   2   5   4  6 15</code></pre>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb144-1"><a href="examples.html#cb144-1" tabindex="-1"></a><span class="co"># Define the mesh sizes (cm) used in the experiment</span></span>
<span id="cb144-2"><a href="examples.html#cb144-2" tabindex="-1"></a>mesh_sizes <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">13.5</span>, <span class="fl">14.0</span>, <span class="fl">14.8</span>, <span class="fl">15.4</span>, <span class="fl">15.9</span>, <span class="fl">16.6</span>, <span class="fl">17.8</span>, <span class="dv">19</span>)</span>
<span id="cb144-3"><a href="examples.html#cb144-3" tabindex="-1"></a></span>
<span id="cb144-4"><a href="examples.html#cb144-4" tabindex="-1"></a><span class="co"># Load the example of catch at length data</span></span>
<span id="cb144-5"><a href="examples.html#cb144-5" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;gtg_catch_frequency&quot;</span>) <span class="co"># it contains frequency</span></span>
<span id="cb144-6"><a href="examples.html#cb144-6" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;gtg_catch_lengths&quot;</span>)   <span class="co"># it contains lengths</span></span>
<span id="cb144-7"><a href="examples.html#cb144-7" tabindex="-1"></a></span>
<span id="cb144-8"><a href="examples.html#cb144-8" tabindex="-1"></a><span class="co"># In this example we will use frequency data</span></span>
<span id="cb144-9"><a href="examples.html#cb144-9" tabindex="-1"></a>sampleCatch <span class="ot">&lt;-</span> gtg_catch_frequency</span>
<span id="cb144-10"><a href="examples.html#cb144-10" tabindex="-1"></a><span class="co">#sampleCatch &lt;- gtg_catch_lengths  # Uncomment this line if you want to use length data</span></span></code></pre></div>
</div>
<div id="step-2.-create-the-lengthcomp-object" class="section level4 hasAnchor" number="6.2.1.2">
<h4><span class="header-section-number">6.2.1.2</span> Step 2. Create the <code>lengthComp</code> object<a href="examples.html#step-2.-create-the-lengthcomp-object" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Set up the characteristics of the data:</p>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb145-1"><a href="examples.html#cb145-1" tabindex="-1"></a>lengthComp <span class="ot">&lt;-</span> <span class="fu">new</span>(<span class="st">&quot;LengthComp&quot;</span>)</span>
<span id="cb145-2"><a href="examples.html#cb145-2" tabindex="-1"></a>lengthComp<span class="sc">@</span>dataType <span class="ot">&lt;-</span> <span class="st">&quot;Frequency&quot;</span>  <span class="co"># &quot;Length&quot; or &quot;Frequency&quot; - the users need to choose one.</span></span>
<span id="cb145-3"><a href="examples.html#cb145-3" tabindex="-1"></a>lengthComp<span class="sc">@</span>L_source <span class="ot">&lt;-</span> <span class="st">&quot;FD&quot;</span></span>
<span id="cb145-4"><a href="examples.html#cb145-4" tabindex="-1"></a>lengthComp<span class="sc">@</span>dt <span class="ot">&lt;-</span> sampleCatch</span>
<span id="cb145-5"><a href="examples.html#cb145-5" tabindex="-1"></a>lengthComp<span class="sc">@</span>L_units <span class="ot">&lt;-</span> <span class="st">&quot;cm&quot;</span></span>
<span id="cb145-6"><a href="examples.html#cb145-6" tabindex="-1"></a>lengthComp<span class="sc">@</span>L_type <span class="ot">&lt;-</span> <span class="st">&quot;TL&quot;</span></span>
<span id="cb145-7"><a href="examples.html#cb145-7" tabindex="-1"></a>lengthComp<span class="sc">@</span>header <span class="ot">&lt;-</span><span class="cn">TRUE</span></span>
<span id="cb145-8"><a href="examples.html#cb145-8" tabindex="-1"></a>lengthComp<span class="sc">@</span>observationGroup <span class="ot">&lt;-</span> <span class="st">&quot;Catch&quot;</span> <span class="co">#for Frequency or &quot;Year&quot; for Length (choose the right one)</span></span></code></pre></div>
<p><strong>Note:</strong>
If <code>sampleCatch &lt;- gtg_catch_frequency</code> then set <code>lengthComp@dataType &lt;- "Frequency"</code> and <code>lengthComp@observationGroup &lt;- "Catch"</code></p>
<p>If <code>sampleCatch &lt;- gtg_catch_lengths</code> then set <code>lengthComp@dataType &lt;- "Length"</code> and <code>lengthComp@observationGroup &lt;- "Year"</code></p>
</div>
<div id="step-3.-create-the-lifehistoryobj-object" class="section level4 hasAnchor" number="6.2.1.3">
<h4><span class="header-section-number">6.2.1.3</span> Step 3. Create the <code>LifeHistoryObj</code> object<a href="examples.html#step-3.-create-the-lifehistoryobj-object" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Set up the stock’s biological parameters using direct slot assignment:</p>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb146-1"><a href="examples.html#cb146-1" tabindex="-1"></a>LifeHistoryObj <span class="ot">&lt;-</span> <span class="fu">new</span>(<span class="st">&quot;LifeHistory&quot;</span>)</span>
<span id="cb146-2"><a href="examples.html#cb146-2" tabindex="-1"></a>LifeHistoryObj<span class="sc">@</span>title <span class="ot">&lt;-</span> <span class="st">&quot;Fish Stock&quot;</span></span>
<span id="cb146-3"><a href="examples.html#cb146-3" tabindex="-1"></a>LifeHistoryObj<span class="sc">@</span>speciesName <span class="ot">&lt;-</span> <span class="st">&quot;Generic Fish&quot;</span></span>
<span id="cb146-4"><a href="examples.html#cb146-4" tabindex="-1"></a>LifeHistoryObj<span class="sc">@</span>shortDescription <span class="ot">&lt;-</span> <span class="st">&quot;Stock for dome shaped LBSPR Analysis&quot;</span></span>
<span id="cb146-5"><a href="examples.html#cb146-5" tabindex="-1"></a>LifeHistoryObj<span class="sc">@</span>L_type <span class="ot">&lt;-</span> <span class="st">&quot;TL&quot;</span></span>
<span id="cb146-6"><a href="examples.html#cb146-6" tabindex="-1"></a>LifeHistoryObj<span class="sc">@</span>L_units <span class="ot">&lt;-</span> <span class="st">&quot;cm&quot;</span></span>
<span id="cb146-7"><a href="examples.html#cb146-7" tabindex="-1"></a>LifeHistoryObj<span class="sc">@</span>Walpha_units <span class="ot">&lt;-</span> <span class="st">&quot;g&quot;</span></span>
<span id="cb146-8"><a href="examples.html#cb146-8" tabindex="-1"></a></span>
<span id="cb146-9"><a href="examples.html#cb146-9" tabindex="-1"></a>LifeHistoryObj<span class="sc">@</span>Linf <span class="ot">&lt;-</span> <span class="dv">120</span></span>
<span id="cb146-10"><a href="examples.html#cb146-10" tabindex="-1"></a>LifeHistoryObj<span class="sc">@</span>K <span class="ot">&lt;-</span> <span class="fl">0.2</span>  </span>
<span id="cb146-11"><a href="examples.html#cb146-11" tabindex="-1"></a>LifeHistoryObj<span class="sc">@</span>t0 <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb146-12"><a href="examples.html#cb146-12" tabindex="-1"></a>LifeHistoryObj<span class="sc">@</span>L50 <span class="ot">&lt;-</span> <span class="dv">60</span></span>
<span id="cb146-13"><a href="examples.html#cb146-13" tabindex="-1"></a>LifeHistoryObj<span class="sc">@</span>L95delta <span class="ot">&lt;-</span> <span class="dv">2</span>  <span class="co"># L95 - L50 = 62 - 60</span></span>
<span id="cb146-14"><a href="examples.html#cb146-14" tabindex="-1"></a>LifeHistoryObj<span class="sc">@</span>M <span class="ot">&lt;-</span> <span class="fl">0.3</span>  <span class="co"># Calculated from MK * K = 1.5 * 0.2</span></span>
<span id="cb146-15"><a href="examples.html#cb146-15" tabindex="-1"></a>LifeHistoryObj<span class="sc">@</span>MK <span class="ot">&lt;-</span> <span class="fl">1.5</span>  </span>
<span id="cb146-16"><a href="examples.html#cb146-16" tabindex="-1"></a></span>
<span id="cb146-17"><a href="examples.html#cb146-17" tabindex="-1"></a>LifeHistoryObj<span class="sc">@</span>LW_A <span class="ot">&lt;-</span> <span class="fl">0.01</span></span>
<span id="cb146-18"><a href="examples.html#cb146-18" tabindex="-1"></a>LifeHistoryObj<span class="sc">@</span>LW_B <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb146-19"><a href="examples.html#cb146-19" tabindex="-1"></a>LifeHistoryObj<span class="sc">@</span>Steep <span class="ot">&lt;-</span> <span class="fl">0.7</span></span>
<span id="cb146-20"><a href="examples.html#cb146-20" tabindex="-1"></a>LifeHistoryObj<span class="sc">@</span>R0 <span class="ot">&lt;-</span> <span class="fl">1E6</span></span>
<span id="cb146-21"><a href="examples.html#cb146-21" tabindex="-1"></a>LifeHistoryObj<span class="sc">@</span>Tmax <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fu">log</span>(<span class="fl">0.01</span>) <span class="sc">/</span> LifeHistoryObj<span class="sc">@</span>M</span>
<span id="cb146-22"><a href="examples.html#cb146-22" tabindex="-1"></a></span>
<span id="cb146-23"><a href="examples.html#cb146-23" tabindex="-1"></a>LifeHistoryObj<span class="sc">@</span>recSD <span class="ot">&lt;-</span> <span class="fl">0.6</span></span>
<span id="cb146-24"><a href="examples.html#cb146-24" tabindex="-1"></a>LifeHistoryObj<span class="sc">@</span>recRho <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb146-25"><a href="examples.html#cb146-25" tabindex="-1"></a>LifeHistoryObj<span class="sc">@</span>isHermaph <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb146-26"><a href="examples.html#cb146-26" tabindex="-1"></a>LifeHistoryObj<span class="sc">@</span>H50 <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb146-27"><a href="examples.html#cb146-27" tabindex="-1"></a>LifeHistoryObj<span class="sc">@</span>H95delta <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb146-28"><a href="examples.html#cb146-28" tabindex="-1"></a></span>
<span id="cb146-29"><a href="examples.html#cb146-29" tabindex="-1"></a><span class="co"># GTG-specific parameters as attributes</span></span>
<span id="cb146-30"><a href="examples.html#cb146-30" tabindex="-1"></a><span class="fu">attr</span>(LifeHistoryObj, <span class="st">&quot;CVLinf&quot;</span>) <span class="ot">&lt;-</span> <span class="fl">0.1</span></span>
<span id="cb146-31"><a href="examples.html#cb146-31" tabindex="-1"></a><span class="fu">attr</span>(LifeHistoryObj, <span class="st">&quot;MaxSD&quot;</span>) <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb146-32"><a href="examples.html#cb146-32" tabindex="-1"></a><span class="fu">attr</span>(LifeHistoryObj, <span class="st">&quot;NGTG&quot;</span>) <span class="ot">&lt;-</span> <span class="dv">13</span></span>
<span id="cb146-33"><a href="examples.html#cb146-33" tabindex="-1"></a><span class="fu">attr</span>(LifeHistoryObj, <span class="st">&quot;Mpow&quot;</span>) <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb146-34"><a href="examples.html#cb146-34" tabindex="-1"></a><span class="fu">attr</span>(LifeHistoryObj, <span class="st">&quot;FecB&quot;</span>) <span class="ot">&lt;-</span> <span class="dv">3</span></span></code></pre></div>
</div>
<div id="step-4.-setting-up-size-bins" class="section level4 hasAnchor" number="6.2.1.4">
<h4><span class="header-section-number">6.2.1.4</span> Step 4. Setting up size bins<a href="examples.html#step-4.-setting-up-size-bins" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Define length bins for the analysis:</p>
<div class="sourceCode" id="cb147"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb147-1"><a href="examples.html#cb147-1" tabindex="-1"></a>lengthBinWidth <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb147-2"><a href="examples.html#cb147-2" tabindex="-1"></a>SizeBins <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb147-3"><a href="examples.html#cb147-3" tabindex="-1"></a>SizeBins<span class="sc">$</span>Linc <span class="ot">&lt;-</span> lengthBinWidth</span>
<span id="cb147-4"><a href="examples.html#cb147-4" tabindex="-1"></a>SDLinf <span class="ot">&lt;-</span> <span class="fu">attr</span>(LifeHistoryObj, <span class="st">&quot;CVLinf&quot;</span>) <span class="sc">*</span> LifeHistoryObj<span class="sc">@</span>Linf</span>
<span id="cb147-5"><a href="examples.html#cb147-5" tabindex="-1"></a>SizeBins<span class="sc">$</span>ToSize <span class="ot">&lt;-</span> LifeHistoryObj<span class="sc">@</span>Linf <span class="sc">+</span> SDLinf <span class="sc">*</span> <span class="fu">attr</span>(LifeHistoryObj, <span class="st">&quot;MaxSD&quot;</span>)</span>
<span id="cb147-6"><a href="examples.html#cb147-6" tabindex="-1"></a>LenBins <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> SizeBins<span class="sc">$</span>ToSize, <span class="at">by =</span> SizeBins<span class="sc">$</span>Linc)</span>
<span id="cb147-7"><a href="examples.html#cb147-7" tabindex="-1"></a>LenMids <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from=</span><span class="fl">0.5</span><span class="sc">*</span>SizeBins<span class="sc">$</span>Linc, <span class="at">by=</span>SizeBins<span class="sc">$</span>Linc,<span class="at">length.out=</span>(<span class="fu">length</span>(LenBins)<span class="sc">-</span><span class="dv">1</span>))</span>
<span id="cb147-8"><a href="examples.html#cb147-8" tabindex="-1"></a>lengthFish <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from=</span><span class="fl">0.5</span><span class="sc">*</span>SizeBins<span class="sc">$</span>Linc, <span class="at">by=</span>SizeBins<span class="sc">$</span>Linc,<span class="at">length.out=</span><span class="fu">length</span>(LenBins) <span class="sc">-</span> <span class="dv">1</span>)</span></code></pre></div>
</div>
<div id="step-5.-fitting-selectivity-curves-to-gillnet-data" class="section level4 hasAnchor" number="6.2.1.5">
<h4><span class="header-section-number">6.2.1.5</span> Step 5. Fitting selectivity curves to gillnet data<a href="examples.html#step-5.-fitting-selectivity-curves-to-gillnet-data" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>If gillnet selectivity data are available, the <code>fit_gillnet_dome()</code> function can be used to fit a variety of dome-shaped selectivity models to these data. This function is described in detail in <a href="utility-functions.html#gillnet-fitting">5.4</a> and allows users to estimate selectivity curves such as normal, lognormal, and bimodal types.</p>
<p>In this section, we apply <code>fit_gillnet_dome()</code> to example gillnet data from <span class="citation">Millar and Holst (<a href="#ref-millar1997">1997</a>)</span> to obtain fitted selectivity curves that can later be compared with those used in simulation.</p>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb148-1"><a href="examples.html#cb148-1" tabindex="-1"></a>selfit <span class="ot">&lt;-</span> <span class="fu">fit_gillnet_dome</span>(</span>
<span id="cb148-2"><a href="examples.html#cb148-2" tabindex="-1"></a>  <span class="at">input_data =</span> input_data,</span>
<span id="cb148-3"><a href="examples.html#cb148-3" tabindex="-1"></a>  <span class="at">mesh_sizes =</span> mesh_sizes,</span>
<span id="cb148-4"><a href="examples.html#cb148-4" tabindex="-1"></a>  <span class="at">output_dir =</span> <span class="st">&quot;fig_dome_lbspr&quot;</span>,</span>
<span id="cb148-5"><a href="examples.html#cb148-5" tabindex="-1"></a>  <span class="at">length_seq =</span> lengthFish,</span>
<span id="cb148-6"><a href="examples.html#cb148-6" tabindex="-1"></a>  <span class="at">run_bimodal =</span> <span class="cn">FALSE</span>  <span class="co"># Set to TRUE to include bimodal models</span></span>
<span id="cb148-7"><a href="examples.html#cb148-7" tabindex="-1"></a><span class="co"># Note: If in fit_gillnet_dome(), run_bimodal=FALSE: &quot;Normal.loc&quot;, &quot;Normal.sca&quot;, &quot;logNorm&quot;</span></span>
<span id="cb148-8"><a href="examples.html#cb148-8" tabindex="-1"></a><span class="co"># Note: If in fit_gillnet_dome(), run_bimodal=TRUE: All the above plus &quot;binorm.sca&quot;, &quot;bilognorm</span></span>
<span id="cb148-9"><a href="examples.html#cb148-9" tabindex="-1"></a>)</span></code></pre></div>
<p>We are plotting here the <code>norm.sca</code>: Normal scaled spread selectivity model</p>
<div class="figure"><span style="display:block;" id="fig:include-plot-dome-lbspr"></span>
<img src="fig_dome_lbspr/Combined_norm.sca.jpeg" alt="Gillnet selectivity estimation and model residuals." width="70%" />
<p class="caption">
Figure 6.11: Gillnet selectivity estimation and model residuals.
</p>
</div>
</div>
<div id="step-6.-defining-fleet-parameters" class="section level4 hasAnchor" number="6.2.1.6">
<h4><span class="header-section-number">6.2.1.6</span> Step 6. Defining fleet parameters<a href="examples.html#step-6.-defining-fleet-parameters" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The next step is to define a list named <code>FleetPars</code> that contains the fishery parameters.</p>
<div class="sourceCode" id="cb149"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb149-1"><a href="examples.html#cb149-1" tabindex="-1"></a>FleetPars <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb149-2"><a href="examples.html#cb149-2" tabindex="-1"></a>FleetPars<span class="sc">$</span>FM <span class="ot">&lt;-</span> <span class="dv">1</span></span></code></pre></div>
<p>The user can choose from several selectivity options by commenting and uncommneting a block of code.</p>
<p>This example is based on <code>FleetPars$selectivityCurve &lt;- "Normal.sca"</code></p>
<p>Choose one of the selectivity curve options below by uncommenting the desired block and commenting out all others.</p>
<p>If <code>FleetPars$use_aggregated &lt;- FALSE</code>, then <code>FleetPars$fishery_mesh</code> must be assigned a specific mesh size. For example, to retrieve the <code>"Normal.sca"</code> selectivity curve for mesh size 14, use <code>FleetPars$fishery_mesh &lt;- 14</code>.</p>
<div class="sourceCode" id="cb150"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb150-1"><a href="examples.html#cb150-1" tabindex="-1"></a><span class="co"># Option 0. logistic</span></span>
<span id="cb150-2"><a href="examples.html#cb150-2" tabindex="-1"></a><span class="co"># FleetPars$selectivityCurve &lt;- &quot;Logistic&quot;</span></span>
<span id="cb150-3"><a href="examples.html#cb150-3" tabindex="-1"></a><span class="co"># FleetPars$SL1 = 50</span></span>
<span id="cb150-4"><a href="examples.html#cb150-4" tabindex="-1"></a><span class="co"># FleetPars$SL2 = 80</span></span>
<span id="cb150-5"><a href="examples.html#cb150-5" tabindex="-1"></a></span>
<span id="cb150-6"><a href="examples.html#cb150-6" tabindex="-1"></a><span class="co"># Option 1. Normal Location (normal with fixed spread)</span></span>
<span id="cb150-7"><a href="examples.html#cb150-7" tabindex="-1"></a><span class="co"># FleetPars$selectivityCurve &lt;- &quot;Normal.loc&quot;</span></span>
<span id="cb150-8"><a href="examples.html#cb150-8" tabindex="-1"></a><span class="co"># FleetPars$SL1 &lt;- selfit$results$norm.loc$par[1]</span></span>
<span id="cb150-9"><a href="examples.html#cb150-9" tabindex="-1"></a><span class="co"># FleetPars$SL2 &lt;- selfit$results$norm.loc$par[2]</span></span>
<span id="cb150-10"><a href="examples.html#cb150-10" tabindex="-1"></a><span class="co"># FleetPars$SLmesh &lt;- mesh_sizes</span></span>
<span id="cb150-11"><a href="examples.html#cb150-11" tabindex="-1"></a><span class="co"># FleetPars$SLMin &lt;- NA</span></span>
<span id="cb150-12"><a href="examples.html#cb150-12" tabindex="-1"></a><span class="co"># FleetPars$use_aggregated &lt;- TRUE</span></span>
<span id="cb150-13"><a href="examples.html#cb150-13" tabindex="-1"></a><span class="co">#FleetPars$fishery_mesh &lt;- 14</span></span>
<span id="cb150-14"><a href="examples.html#cb150-14" tabindex="-1"></a></span>
<span id="cb150-15"><a href="examples.html#cb150-15" tabindex="-1"></a><span class="co"># Option 2. Normal.sca (normal with proportional spread)</span></span>
<span id="cb150-16"><a href="examples.html#cb150-16" tabindex="-1"></a>FleetPars<span class="sc">$</span>selectivityCurve <span class="ot">&lt;-</span> <span class="st">&quot;Normal.sca&quot;</span></span>
<span id="cb150-17"><a href="examples.html#cb150-17" tabindex="-1"></a>FleetPars<span class="sc">$</span>SL1 <span class="ot">&lt;-</span> selfit<span class="sc">$</span>results<span class="sc">$</span>norm.sca<span class="sc">$</span>par[<span class="dv">1</span>]</span>
<span id="cb150-18"><a href="examples.html#cb150-18" tabindex="-1"></a>FleetPars<span class="sc">$</span>SL2 <span class="ot">&lt;-</span> selfit<span class="sc">$</span>results<span class="sc">$</span>norm.sca<span class="sc">$</span>par[<span class="dv">2</span>]<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb150-19"><a href="examples.html#cb150-19" tabindex="-1"></a>FleetPars<span class="sc">$</span>SLmesh <span class="ot">&lt;-</span> mesh_sizes</span>
<span id="cb150-20"><a href="examples.html#cb150-20" tabindex="-1"></a>FleetPars<span class="sc">$</span>SLMin <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb150-21"><a href="examples.html#cb150-21" tabindex="-1"></a>FleetPars<span class="sc">$</span>use_aggregated <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb150-22"><a href="examples.html#cb150-22" tabindex="-1"></a><span class="co"># FleetPars$fishery_mesh &lt;- 14</span></span>
<span id="cb150-23"><a href="examples.html#cb150-23" tabindex="-1"></a></span>
<span id="cb150-24"><a href="examples.html#cb150-24" tabindex="-1"></a><span class="co"># Option 3. logNorm</span></span>
<span id="cb150-25"><a href="examples.html#cb150-25" tabindex="-1"></a><span class="co"># FleetPars$selectivityCurve &lt;- &quot;logNorm&quot;</span></span>
<span id="cb150-26"><a href="examples.html#cb150-26" tabindex="-1"></a><span class="co"># FleetPars$SL1 &lt;- selfit$results$lognorm$par[1]  </span></span>
<span id="cb150-27"><a href="examples.html#cb150-27" tabindex="-1"></a><span class="co"># FleetPars$SL2 &lt;- selfit$results$lognorm$par[2]</span></span>
<span id="cb150-28"><a href="examples.html#cb150-28" tabindex="-1"></a><span class="co"># FleetPars$SLmesh &lt;- mesh_sizes</span></span>
<span id="cb150-29"><a href="examples.html#cb150-29" tabindex="-1"></a><span class="co"># FleetPars$SLMin &lt;- NA</span></span>
<span id="cb150-30"><a href="examples.html#cb150-30" tabindex="-1"></a><span class="co"># FleetPars$use_aggregated &lt;- FALSE</span></span>
<span id="cb150-31"><a href="examples.html#cb150-31" tabindex="-1"></a><span class="co"># FleetPars$fishery_mesh &lt;- 14   </span></span>
<span id="cb150-32"><a href="examples.html#cb150-32" tabindex="-1"></a></span>
<span id="cb150-33"><a href="examples.html#cb150-33" tabindex="-1"></a><span class="co"># Option 4. binorm.sca</span></span>
<span id="cb150-34"><a href="examples.html#cb150-34" tabindex="-1"></a><span class="co"># FleetPars$selectivityCurve &lt;- &quot;binorm.sca&quot;</span></span>
<span id="cb150-35"><a href="examples.html#cb150-35" tabindex="-1"></a><span class="co"># FleetPars$SL1 &lt;- selfit$results$binorm.sca$par[1]</span></span>
<span id="cb150-36"><a href="examples.html#cb150-36" tabindex="-1"></a><span class="co"># FleetPars$SL2 &lt;- selfit$results$binorm.sca$par[2]</span></span>
<span id="cb150-37"><a href="examples.html#cb150-37" tabindex="-1"></a><span class="co"># FleetPars$SL3 &lt;- selfit$results$binorm.sca$par[3]</span></span>
<span id="cb150-38"><a href="examples.html#cb150-38" tabindex="-1"></a><span class="co"># FleetPars$SL4 &lt;- selfit$results$binorm.sca$par[4]</span></span>
<span id="cb150-39"><a href="examples.html#cb150-39" tabindex="-1"></a><span class="co"># FleetPars$SL5 &lt;- selfit$results$binorm.sca$par[5]</span></span>
<span id="cb150-40"><a href="examples.html#cb150-40" tabindex="-1"></a><span class="co"># FleetPars$SLmesh &lt;- mesh_sizes</span></span>
<span id="cb150-41"><a href="examples.html#cb150-41" tabindex="-1"></a><span class="co"># FleetPars$SLMin &lt;- NA</span></span>
<span id="cb150-42"><a href="examples.html#cb150-42" tabindex="-1"></a><span class="co"># FleetPars$use_aggregated &lt;- FALSE</span></span>
<span id="cb150-43"><a href="examples.html#cb150-43" tabindex="-1"></a><span class="co"># FleetPars$fishery_mesh &lt;- 14</span></span>
<span id="cb150-44"><a href="examples.html#cb150-44" tabindex="-1"></a></span>
<span id="cb150-45"><a href="examples.html#cb150-45" tabindex="-1"></a><span class="co"># Option 5. bilognorm</span></span>
<span id="cb150-46"><a href="examples.html#cb150-46" tabindex="-1"></a><span class="co"># FleetPars$selectivityCurve &lt;- &quot;bilognorm&quot;</span></span>
<span id="cb150-47"><a href="examples.html#cb150-47" tabindex="-1"></a><span class="co"># FleetPars$SL1 &lt;- selfit$results$bilognorm$par[1]</span></span>
<span id="cb150-48"><a href="examples.html#cb150-48" tabindex="-1"></a><span class="co"># FleetPars$SL2 &lt;- selfit$results$bilognorm$par[2]</span></span>
<span id="cb150-49"><a href="examples.html#cb150-49" tabindex="-1"></a><span class="co"># FleetPars$SL3 &lt;- selfit$results$bilognorm$par[3]</span></span>
<span id="cb150-50"><a href="examples.html#cb150-50" tabindex="-1"></a><span class="co"># FleetPars$SL4 &lt;- selfit$results$bilognorm$par[4]</span></span>
<span id="cb150-51"><a href="examples.html#cb150-51" tabindex="-1"></a><span class="co"># FleetPars$SL5 &lt;- selfit$results$bilognorm$par[5]</span></span>
<span id="cb150-52"><a href="examples.html#cb150-52" tabindex="-1"></a><span class="co"># FleetPars$SLmesh &lt;- mesh_sizes</span></span>
<span id="cb150-53"><a href="examples.html#cb150-53" tabindex="-1"></a><span class="co"># FleetPars$SLMin &lt;- NA</span></span>
<span id="cb150-54"><a href="examples.html#cb150-54" tabindex="-1"></a><span class="co"># FleetPars$use_aggregated &lt;- FALSE</span></span>
<span id="cb150-55"><a href="examples.html#cb150-55" tabindex="-1"></a><span class="co"># FleetPars$fishery_mesh &lt;- 14</span></span></code></pre></div>
<p>The following lines of code set the gear selectivity variables for use in other parts of the script, create a shorter-named local variable <code>meshSize</code> that references the same mesh sizes as <code>FleetPars$SLmesh</code> (to make subsequent code more concise), and display the selected curve used to run the GTG dome-shaped LBSPR model.</p>
<div class="sourceCode" id="cb151"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb151-1"><a href="examples.html#cb151-1" tabindex="-1"></a>gearSelectivity <span class="ot">&lt;-</span> FleetPars<span class="sc">$</span>selectivityCurve</span>
<span id="cb151-2"><a href="examples.html#cb151-2" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.null</span>(FleetPars<span class="sc">$</span>SLmesh)) meshSize <span class="ot">&lt;-</span> FleetPars<span class="sc">$</span>SLmesh</span>
<span id="cb151-3"><a href="examples.html#cb151-3" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Selected selectivity curve:&quot;</span>, gearSelectivity, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## Selected selectivity curve: Normal.sca</code></pre>
</div>
<div id="step-7.-running-the-simulation-for-checking-purposes" class="section level4 hasAnchor" number="6.2.1.7">
<h4><span class="header-section-number">6.2.1.7</span> Step 7. Running the simulation for checking purposes<a href="examples.html#step-7.-running-the-simulation-for-checking-purposes" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Once the user has defined their <code>FleetPars</code>, they can call the <code>GTGDomeLBSPRSim2()</code> function to run the simulation. After running the simulation, the user can obtain the selectivity curves and check whether <code>GTGDomeLBSPRSim2()</code> reproduces the same curve estimated by the <code>fit_gillnet_dome()</code> function.</p>
<div class="sourceCode" id="cb153"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb153-1"><a href="examples.html#cb153-1" tabindex="-1"></a>sim_output <span class="ot">&lt;-</span> <span class="fu">GTGDomeLBSPRSim2</span>(LifeHistoryObj, FleetPars, SizeBins)</span>
<span id="cb153-2"><a href="examples.html#cb153-2" tabindex="-1"></a>gearSelLen <span class="ot">&lt;-</span> sim_output<span class="sc">$</span>SelLen</span></code></pre></div>
</div>
<div id="step-8.-visualizing-selectivity-curves" class="section level4 hasAnchor" number="6.2.1.8">
<h4><span class="header-section-number">6.2.1.8</span> Step 8. Visualizing selectivity curves<a href="examples.html#step-8.-visualizing-selectivity-curves" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>After fitting dome-shaped selectivity models using <code>fit_gillnet_dome()</code>, you can compare the resulting fitted curves with those reconstructed internally by the <code>GTGDomeLBSPRSim2()</code> simulation. This step helps verify that the simulation is correctly using the estimated selectivity parameters.</p>
<p>The comparison can be done in two modes:</p>
<ul>
<li><p>Aggregated selectivity (<code>FleetPars$use_aggregated = TRUE</code>): This plots the composite selectivity curve (aggregated across mesh sizes) used in the simulation alongside the one estimated by <code>fit_gillnet_dome()</code>.</p></li>
<li><p>Mesh-specific selectivity (<code>FleetPars$use_aggregated = FALSE</code>). This plots the selectivity curve corresponding to a specific mesh size (as specified in <code>FleetPars$fishery_mesh</code>) and compares it to the fitted mesh-specific curve.</p></li>
</ul>
<p>Aggregated selectivity curve are obtaining by using the function <code>get_composite_curve()</code> included in the R code presented in chapter 5, section <a href="utility-functions.html#gillnet-fitting">5.4</a>.</p>
<p><strong>Note</strong>: These comparisons apply only to dome-shaped selectivity models (e.g., normal, log-normal, bimodal). A separate comparison routine for logistic selectivity is provided at the end of this document</p>
<div class="sourceCode" id="cb154"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb154-1"><a href="examples.html#cb154-1" tabindex="-1"></a><span class="co"># Map model names</span></span>
<span id="cb154-2"><a href="examples.html#cb154-2" tabindex="-1"></a>model_lookup <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb154-3"><a href="examples.html#cb154-3" tabindex="-1"></a>  <span class="st">&quot;Normal.loc&quot;</span>   <span class="ot">=</span> <span class="st">&quot;norm.loc&quot;</span>,</span>
<span id="cb154-4"><a href="examples.html#cb154-4" tabindex="-1"></a>  <span class="st">&quot;Normal.sca&quot;</span>   <span class="ot">=</span> <span class="st">&quot;norm.sca&quot;</span>,</span>
<span id="cb154-5"><a href="examples.html#cb154-5" tabindex="-1"></a>  <span class="st">&quot;logNorm&quot;</span>      <span class="ot">=</span> <span class="st">&quot;lognorm&quot;</span>,</span>
<span id="cb154-6"><a href="examples.html#cb154-6" tabindex="-1"></a>  <span class="st">&quot;binorm.sca&quot;</span>   <span class="ot">=</span> <span class="st">&quot;binorm.sca&quot;</span>,</span>
<span id="cb154-7"><a href="examples.html#cb154-7" tabindex="-1"></a>  <span class="st">&quot;bilognorm&quot;</span>    <span class="ot">=</span> <span class="st">&quot;bilognorm&quot;</span></span>
<span id="cb154-8"><a href="examples.html#cb154-8" tabindex="-1"></a>)</span>
<span id="cb154-9"><a href="examples.html#cb154-9" tabindex="-1"></a></span>
<span id="cb154-10"><a href="examples.html#cb154-10" tabindex="-1"></a><span class="co"># Get the selectivity curve name for plotting</span></span>
<span id="cb154-11"><a href="examples.html#cb154-11" tabindex="-1"></a>sel_model_name <span class="ot">&lt;-</span> model_lookup[FleetPars<span class="sc">$</span>selectivityCurve]</span>
<span id="cb154-12"><a href="examples.html#cb154-12" tabindex="-1"></a></span>
<span id="cb154-13"><a href="examples.html#cb154-13" tabindex="-1"></a><span class="co"># Get selectivity curve from simulation output for plotting</span></span>
<span id="cb154-14"><a href="examples.html#cb154-14" tabindex="-1"></a>gearSelLen <span class="ot">&lt;-</span> sim_output<span class="sc">$</span>SelLen[<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(lengthFish)]</span></code></pre></div>
<div class="sourceCode" id="cb155"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb155-1"><a href="examples.html#cb155-1" tabindex="-1"></a><span class="co"># For aggregated selectivity</span></span>
<span id="cb155-2"><a href="examples.html#cb155-2" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">isTRUE</span>(FleetPars<span class="sc">$</span>use_aggregated)) {</span>
<span id="cb155-3"><a href="examples.html#cb155-3" tabindex="-1"></a>  <span class="co"># Get fitted model from selfit</span></span>
<span id="cb155-4"><a href="examples.html#cb155-4" tabindex="-1"></a>  fitted_model <span class="ot">&lt;-</span> selfit<span class="sc">$</span>results[[sel_model_name]]</span>
<span id="cb155-5"><a href="examples.html#cb155-5" tabindex="-1"></a>  </span>
<span id="cb155-6"><a href="examples.html#cb155-6" tabindex="-1"></a>  <span class="co"># Get the aggregated selectivity curve</span></span>
<span id="cb155-7"><a href="examples.html#cb155-7" tabindex="-1"></a>  fitted_sel_df <span class="ot">&lt;-</span> <span class="fu">get_composite_curve</span>(fitted_model, <span class="at">length_seq =</span> lengthFish)</span>
<span id="cb155-8"><a href="examples.html#cb155-8" tabindex="-1"></a>  <span class="fu">colnames</span>(fitted_sel_df) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Length&quot;</span>, <span class="st">&quot;FittedSelectivity&quot;</span>)</span>
<span id="cb155-9"><a href="examples.html#cb155-9" tabindex="-1"></a>  </span>
<span id="cb155-10"><a href="examples.html#cb155-10" tabindex="-1"></a>  <span class="co"># Prepare data for comparison</span></span>
<span id="cb155-11"><a href="examples.html#cb155-11" tabindex="-1"></a>  internal_sel_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Length =</span> lengthFish, gearSelLen)</span>
<span id="cb155-12"><a href="examples.html#cb155-12" tabindex="-1"></a>  comparison_df <span class="ot">&lt;-</span> <span class="fu">merge</span>(internal_sel_df, fitted_sel_df, <span class="at">by =</span> <span class="st">&quot;Length&quot;</span>)</span>
<span id="cb155-13"><a href="examples.html#cb155-13" tabindex="-1"></a>  </span>
<span id="cb155-14"><a href="examples.html#cb155-14" tabindex="-1"></a>  <span class="co"># Plot comparison</span></span>
<span id="cb155-15"><a href="examples.html#cb155-15" tabindex="-1"></a>p1<span class="ot">=</span><span class="fu">ggplot</span>(comparison_df, <span class="fu">aes</span>(<span class="at">x =</span> Length)) <span class="sc">+</span></span>
<span id="cb155-16"><a href="examples.html#cb155-16" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> gearSelLen, <span class="at">color =</span> <span class="st">&quot;GTG gearSelLen&quot;</span>), <span class="at">size =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb155-17"><a href="examples.html#cb155-17" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> FittedSelectivity, <span class="at">color =</span> <span class="st">&quot;Gillnet fitted&quot;</span>), <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>, <span class="at">size =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb155-18"><a href="examples.html#cb155-18" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="fu">aes</span>(<span class="at">xintercept =</span> LifeHistoryObj<span class="sc">@</span>L50, <span class="at">color =</span> <span class="st">&quot;L50 = mat 50%&quot;</span>), <span class="at">linetype =</span> <span class="st">&quot;dotted&quot;</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb155-19"><a href="examples.html#cb155-19" tabindex="-1"></a>    <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;GTG gearSelLen&quot;</span> <span class="ot">=</span> <span class="st">&quot;blue&quot;</span>, <span class="st">&quot;Gillnet fitted&quot;</span> <span class="ot">=</span> <span class="st">&quot;red&quot;</span>,<span class="st">&quot;L50 = mat 50%&quot;</span> <span class="ot">=</span> <span class="st">&quot;grey&quot;</span>)) <span class="sc">+</span></span>
<span id="cb155-20"><a href="examples.html#cb155-20" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">paste</span>(<span class="st">&quot;Selectivity Comparison -&quot;</span>, FleetPars<span class="sc">$</span>selectivityCurve),</span>
<span id="cb155-21"><a href="examples.html#cb155-21" tabindex="-1"></a>         <span class="at">x =</span> <span class="st">&quot;Length (cm)&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Selectivity&quot;</span>, <span class="at">color =</span> <span class="st">&quot;Source&quot;</span>) <span class="sc">+</span></span>
<span id="cb155-22"><a href="examples.html#cb155-22" tabindex="-1"></a>    <span class="fu">theme_bw</span>()</span>
<span id="cb155-23"><a href="examples.html#cb155-23" tabindex="-1"></a><span class="co"># specific mesh selectivity exploration</span></span>
<span id="cb155-24"><a href="examples.html#cb155-24" tabindex="-1"></a>} <span class="cf">else</span> <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(FleetPars<span class="sc">$</span>fishery_mesh)) {</span>
<span id="cb155-25"><a href="examples.html#cb155-25" tabindex="-1"></a>  </span>
<span id="cb155-26"><a href="examples.html#cb155-26" tabindex="-1"></a>  mesh_use <span class="ot">&lt;-</span> <span class="fu">as.character</span>(FleetPars<span class="sc">$</span>fishery_mesh)</span>
<span id="cb155-27"><a href="examples.html#cb155-27" tabindex="-1"></a>  fitted_sel_vec <span class="ot">&lt;-</span> selfit<span class="sc">$</span>selectivity_curves[[sel_model_name]][[mesh_use]]</span>
<span id="cb155-28"><a href="examples.html#cb155-28" tabindex="-1"></a>  </span>
<span id="cb155-29"><a href="examples.html#cb155-29" tabindex="-1"></a>  comparison_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb155-30"><a href="examples.html#cb155-30" tabindex="-1"></a>    <span class="at">Length =</span> lengthFish,</span>
<span id="cb155-31"><a href="examples.html#cb155-31" tabindex="-1"></a>    <span class="at">internal_sel =</span> gearSelLen,</span>
<span id="cb155-32"><a href="examples.html#cb155-32" tabindex="-1"></a>    <span class="at">fitted_sel =</span> fitted_sel_vec</span>
<span id="cb155-33"><a href="examples.html#cb155-33" tabindex="-1"></a>  )</span>
<span id="cb155-34"><a href="examples.html#cb155-34" tabindex="-1"></a>  </span>
<span id="cb155-35"><a href="examples.html#cb155-35" tabindex="-1"></a> p1<span class="ot">=</span> <span class="fu">ggplot</span>(comparison_df, <span class="fu">aes</span>(<span class="at">x =</span> Length)) <span class="sc">+</span></span>
<span id="cb155-36"><a href="examples.html#cb155-36" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> internal_sel, <span class="at">color =</span> <span class="st">&quot;gearSelLen&quot;</span>), <span class="at">size =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb155-37"><a href="examples.html#cb155-37" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> fitted_sel, <span class="at">color =</span> <span class="st">&quot;gillnet fitted&quot;</span>), <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>, <span class="at">size =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb155-38"><a href="examples.html#cb155-38" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="fu">aes</span>(<span class="at">xintercept =</span> LifeHistoryObj<span class="sc">@</span>L50, <span class="at">color =</span> <span class="st">&quot;L50 = mat 50%&quot;</span>), <span class="at">linetype =</span> <span class="st">&quot;dotted&quot;</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb155-39"><a href="examples.html#cb155-39" tabindex="-1"></a>    <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;gearSelLen&quot;</span> <span class="ot">=</span> <span class="st">&quot;blue&quot;</span>, <span class="st">&quot;gillnet fitted&quot;</span> <span class="ot">=</span> <span class="st">&quot;red&quot;</span>,<span class="st">&quot;L50 = mat 50%&quot;</span> <span class="ot">=</span> <span class="st">&quot;grey&quot;</span>)) <span class="sc">+</span></span>
<span id="cb155-40"><a href="examples.html#cb155-40" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb155-41"><a href="examples.html#cb155-41" tabindex="-1"></a>      <span class="at">title =</span> <span class="fu">paste</span>(<span class="st">&quot;Selectivity Comparison (Mesh&quot;</span>, mesh_use, <span class="st">&quot;mm)&quot;</span>),</span>
<span id="cb155-42"><a href="examples.html#cb155-42" tabindex="-1"></a>      <span class="at">x =</span> <span class="st">&quot;Length (cm)&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Selectivity&quot;</span>, <span class="at">color =</span> <span class="st">&quot;Source&quot;</span></span>
<span id="cb155-43"><a href="examples.html#cb155-43" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb155-44"><a href="examples.html#cb155-44" tabindex="-1"></a>    <span class="fu">theme_bw</span>()</span>
<span id="cb155-45"><a href="examples.html#cb155-45" tabindex="-1"></a>  </span>
<span id="cb155-46"><a href="examples.html#cb155-46" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb155-47"><a href="examples.html#cb155-47" tabindex="-1"></a>  <span class="fu">stop</span>(<span class="st">&quot;Selectivity comparison cannot proceed: either use_aggregated must be TRUE or a mesh size must be provided.&quot;</span>)</span>
<span id="cb155-48"><a href="examples.html#cb155-48" tabindex="-1"></a>}</span>
<span id="cb155-49"><a href="examples.html#cb155-49" tabindex="-1"></a><span class="fu">print</span> (p1)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-9"></span>
<img src="figures/unnamed-chunk-9-1.png" alt="Comparison of the fitted curves with those reconstructed internally by the GTGDomeLBSPRSim2 simulation" width="2100" />
<p class="caption">
Figure 6.12: Comparison of the fitted curves with those reconstructed internally by the GTGDomeLBSPRSim2 simulation
</p>
</div>
</div>
<div id="step-9.-parameter-estimation" class="section level4 hasAnchor" number="6.2.1.9">
<h4><span class="header-section-number">6.2.1.9</span> Step 9. Parameter estimation<a href="examples.html#step-9.-parameter-estimation" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>To estimate parameters from length-frequency data use the function <code>run_grouped_and_pooled</code>.</p>
<div class="sourceCode" id="cb156"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb156-1"><a href="examples.html#cb156-1" tabindex="-1"></a>results_all <span class="ot">&lt;-</span> <span class="fu">run_grouped_and_pooled</span>(LifeHistoryObj, FleetPars, lengthComp, SizeBins, <span class="at">Lc =</span> <span class="dv">0</span>)</span></code></pre></div>
<pre><code>## Running optimization by group...</code></pre>
<pre><code>## Processing group: Catch_1 
## Processing group: Catch_2 
## Processing group: Catch_3 
## Processing group: Catch_4 
## Processing group: Catch_5</code></pre>
<pre><code>## Running pooled optimization...</code></pre>
<div class="sourceCode" id="cb160"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb160-1"><a href="examples.html#cb160-1" tabindex="-1"></a><span class="co"># The user can explore the outputs using $ symbol</span></span>
<span id="cb160-2"><a href="examples.html#cb160-2" tabindex="-1"></a><span class="fu">print</span>(results_all<span class="sc">$</span>pooled<span class="sc">$</span>lbPars)</span></code></pre></div>
<pre><code>##       F/M       SPR 
## 0.9145970 0.5915958</code></pre>
<div class="sourceCode" id="cb162"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb162-1"><a href="examples.html#cb162-1" tabindex="-1"></a><span class="fu">print</span>(results_all<span class="sc">$</span>pooled<span class="sc">$</span>lbStdErrs)</span></code></pre></div>
<pre><code>##       F/M 
## 0.1145878</code></pre>
<div class="sourceCode" id="cb164"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb164-1"><a href="examples.html#cb164-1" tabindex="-1"></a><span class="fu">print</span>(results_all<span class="sc">$</span>pooled<span class="sc">$</span>NLL)</span></code></pre></div>
<pre><code>## [1] 31.61274</code></pre>
<div class="sourceCode" id="cb166"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb166-1"><a href="examples.html#cb166-1" tabindex="-1"></a><span class="fu">print</span>(results_all<span class="sc">$</span>pooled<span class="sc">$</span>optimOut<span class="sc">$</span>convergence) </span></code></pre></div>
<pre><code>## [1] 0</code></pre>
<div class="sourceCode" id="cb168"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb168-1"><a href="examples.html#cb168-1" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(results_all<span class="sc">$</span>grouped<span class="sc">$</span>group_results)) {</span>
<span id="cb168-2"><a href="examples.html#cb168-2" tabindex="-1"></a>  <span class="fu">lapply</span>(results_all<span class="sc">$</span>grouped<span class="sc">$</span>group_results, <span class="cf">function</span>(x) <span class="fu">print</span>(x<span class="sc">$</span>lbPars))</span>
<span id="cb168-3"><a href="examples.html#cb168-3" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>##       F/M       SPR 
## 0.8275995 0.6212810 
##       F/M       SPR 
## 0.7078621 0.6648111 
##       F/M       SPR 
## 0.9810176 0.5699689 
##       F/M       SPR 
## 1.1417950 0.5210937 
##       F/M       SPR 
## 0.9197611 0.5898828</code></pre>
<pre><code>## $Catch_1
##       F/M       SPR 
## 0.8275995 0.6212810 
## 
## $Catch_2
##       F/M       SPR 
## 0.7078621 0.6648111 
## 
## $Catch_3
##       F/M       SPR 
## 0.9810176 0.5699689 
## 
## $Catch_4
##       F/M       SPR 
## 1.1417950 0.5210937 
## 
## $Catch_5
##       F/M       SPR 
## 0.9197611 0.5898828</code></pre>
</div>
<div id="step-10.-visualization" class="section level4 hasAnchor" number="6.2.1.10">
<h4><span class="header-section-number">6.2.1.10</span> Step 10. Visualization<a href="examples.html#step-10.-visualization" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The visualization section provides a diagnostic plot to evaluate model performance. The plots help assess how well the estimated parameters reproduce the observed length composition data and provide insights into the biological realism of the fitted model.</p>
<p>The visualization section automatically adapts to the input data type specified in the <code>lengthComp</code> object. For frequency data (<code>dataType = "Frequency"</code>), observed counts are calculated by summing across catch columns, using the length bins directly from the data structure. For raw length measurements (<code>dataType = "Length"</code>), the individual length observations are converted into frequency distributions using the predefined length bins (<code>LenBins</code>) and midpoints (<code>LenMids</code>).</p>
<div class="sourceCode" id="cb171"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb171-1"><a href="examples.html#cb171-1" tabindex="-1"></a><span class="co"># Determine data type and prepare accordingly</span></span>
<span id="cb171-2"><a href="examples.html#cb171-2" tabindex="-1"></a>data_type <span class="ot">&lt;-</span> lengthComp<span class="sc">@</span>dataType</span>
<span id="cb171-3"><a href="examples.html#cb171-3" tabindex="-1"></a><span class="cf">if</span> (data_type <span class="sc">==</span> <span class="st">&quot;Frequency&quot;</span>) {</span>
<span id="cb171-4"><a href="examples.html#cb171-4" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;Using Frequency data plotting approach</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb171-5"><a href="examples.html#cb171-5" tabindex="-1"></a>  </span>
<span id="cb171-6"><a href="examples.html#cb171-6" tabindex="-1"></a>  <span class="co"># For frequency data - data already has proper structure</span></span>
<span id="cb171-7"><a href="examples.html#cb171-7" tabindex="-1"></a>  observed_data <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(sampleCatch[, <span class="sc">-</span><span class="dv">1</span>])  <span class="co"># Sum across catch columns (excluding Length column)</span></span>
<span id="cb171-8"><a href="examples.html#cb171-8" tabindex="-1"></a>  length_vector <span class="ot">&lt;-</span> sampleCatch<span class="sc">$</span>Length          <span class="co"># Use the length column</span></span>
<span id="cb171-9"><a href="examples.html#cb171-9" tabindex="-1"></a>  </span>
<span id="cb171-10"><a href="examples.html#cb171-10" tabindex="-1"></a>} <span class="cf">else</span> <span class="cf">if</span> (data_type <span class="sc">==</span> <span class="st">&quot;Length&quot;</span>) {</span>
<span id="cb171-11"><a href="examples.html#cb171-11" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;Using Length data plotting approach</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb171-12"><a href="examples.html#cb171-12" tabindex="-1"></a>  </span>
<span id="cb171-13"><a href="examples.html#cb171-13" tabindex="-1"></a>  <span class="co"># For raw length data - convert to frequency bins</span></span>
<span id="cb171-14"><a href="examples.html#cb171-14" tabindex="-1"></a>  observed_data <span class="ot">&lt;-</span> <span class="fu">hist</span>(<span class="fu">unlist</span>(sampleCatch), <span class="at">breaks =</span> LenBins, <span class="at">plot =</span> <span class="cn">FALSE</span>)<span class="sc">$</span>counts</span>
<span id="cb171-15"><a href="examples.html#cb171-15" tabindex="-1"></a>  length_vector <span class="ot">&lt;-</span> LenMids  <span class="co"># Use bin midpoints</span></span>
<span id="cb171-16"><a href="examples.html#cb171-16" tabindex="-1"></a>  </span>
<span id="cb171-17"><a href="examples.html#cb171-17" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb171-18"><a href="examples.html#cb171-18" tabindex="-1"></a>  <span class="fu">stop</span>(<span class="st">&quot;Unknown data type: &quot;</span>, data_type)</span>
<span id="cb171-19"><a href="examples.html#cb171-19" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## Using Frequency data plotting approach</code></pre>
<div class="sourceCode" id="cb173"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb173-1"><a href="examples.html#cb173-1" tabindex="-1"></a><span class="co"># Get predicted data from optimization results</span></span>
<span id="cb173-2"><a href="examples.html#cb173-2" tabindex="-1"></a>predicted_data <span class="ot">&lt;-</span> results_all<span class="sc">$</span>pooled<span class="sc">$</span>PredLen</span>
<span id="cb173-3"><a href="examples.html#cb173-3" tabindex="-1"></a></span>
<span id="cb173-4"><a href="examples.html#cb173-4" tabindex="-1"></a><span class="co"># Create comparison dataframe</span></span>
<span id="cb173-5"><a href="examples.html#cb173-5" tabindex="-1"></a>compare_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb173-6"><a href="examples.html#cb173-6" tabindex="-1"></a>  <span class="at">Length =</span> length_vector,</span>
<span id="cb173-7"><a href="examples.html#cb173-7" tabindex="-1"></a>  <span class="at">Observed =</span> observed_data,</span>
<span id="cb173-8"><a href="examples.html#cb173-8" tabindex="-1"></a>  <span class="at">Predicted =</span> predicted_data</span>
<span id="cb173-9"><a href="examples.html#cb173-9" tabindex="-1"></a>)</span></code></pre></div>
<p>The following plot compares the observed length composition against the model’s predicted values during the parameter estimation process. This plot is helpful to demonstrate how well the optimizer was able to fit the model to the data during the likelihood maximization.</p>
<div class="sourceCode" id="cb174"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb174-1"><a href="examples.html#cb174-1" tabindex="-1"></a><span class="co"># Basic comparison of observed vs predicted during optimization</span></span>
<span id="cb174-2"><a href="examples.html#cb174-2" tabindex="-1"></a>p_basic <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(compare_df, <span class="fu">aes</span>(<span class="at">x =</span> Length)) <span class="sc">+</span></span>
<span id="cb174-3"><a href="examples.html#cb174-3" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">y =</span> Observed), <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;grey&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb174-4"><a href="examples.html#cb174-4" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> Predicted), <span class="at">color =</span> <span class="st">&quot;red&quot;</span>, <span class="at">size =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb174-5"><a href="examples.html#cb174-5" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb174-6"><a href="examples.html#cb174-6" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">paste</span>(<span class="st">&quot;Observed vs Predicted Length Composition (&quot;</span>, data_type, <span class="st">&quot;data)&quot;</span>),</span>
<span id="cb174-7"><a href="examples.html#cb174-7" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;Length (cm)&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Counts&quot;</span>)</span>
<span id="cb174-8"><a href="examples.html#cb174-8" tabindex="-1"></a></span>
<span id="cb174-9"><a href="examples.html#cb174-9" tabindex="-1"></a><span class="fu">print</span>(p_basic)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-10"></span>
<img src="figures/unnamed-chunk-10-1.png" alt="Observed vs Predicted Length Composition" width="2100" />
<p class="caption">
Figure 6.13: Observed vs Predicted Length Composition
</p>
</div>
</div>
<div id="step-11.-model-re-simulation-setup" class="section level4 hasAnchor" number="6.2.1.11">
<h4><span class="header-section-number">6.2.1.11</span> Step 11. Model re-simulation setup<a href="examples.html#step-11.-model-re-simulation-setup" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>After parameter estimation, the code reconstructs a clean <code>FleetPars</code> object containing the estimated fishing mortality <code>(F/M)</code> ratio and selectivity parameters.</p>
<div class="sourceCode" id="cb175"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb175-1"><a href="examples.html#cb175-1" tabindex="-1"></a><span class="co"># Extract pooled optimization results</span></span>
<span id="cb175-2"><a href="examples.html#cb175-2" tabindex="-1"></a>testOpt <span class="ot">&lt;-</span> results_all<span class="sc">$</span>pooled</span>
<span id="cb175-3"><a href="examples.html#cb175-3" tabindex="-1"></a></span>
<span id="cb175-4"><a href="examples.html#cb175-4" tabindex="-1"></a><span class="co"># Create clean FleetPars object with estimated parameters</span></span>
<span id="cb175-5"><a href="examples.html#cb175-5" tabindex="-1"></a>FleetPars <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">FM =</span> testOpt<span class="sc">$</span>lbPars[[<span class="st">&quot;F/M&quot;</span>]], </span>
<span id="cb175-6"><a href="examples.html#cb175-6" tabindex="-1"></a>                        <span class="at">selectivityCurve =</span> testOpt<span class="sc">$</span>fixedFleetPars<span class="sc">$</span>selectivityCurve)</span>
<span id="cb175-7"><a href="examples.html#cb175-7" tabindex="-1"></a></span>
<span id="cb175-8"><a href="examples.html#cb175-8" tabindex="-1"></a><span class="co"># Preserve fleet-specific parameters from original optimization</span></span>
<span id="cb175-9"><a href="examples.html#cb175-9" tabindex="-1"></a><span class="co"># These lines ensure that extra fields used during selectivity modeling (like mesh sizes or whether aggregation is FALSE or TRUE are preserved</span></span>
<span id="cb175-10"><a href="examples.html#cb175-10" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(testOpt<span class="sc">$</span>fixedFleetPars<span class="sc">$</span>SLmesh)) FleetPars<span class="sc">$</span>SLmesh <span class="ot">&lt;-</span> testOpt<span class="sc">$</span>fixedFleetPars<span class="sc">$</span>SLmesh</span>
<span id="cb175-11"><a href="examples.html#cb175-11" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(testOpt<span class="sc">$</span>fixedFleetPars<span class="sc">$</span>SLMin)) FleetPars<span class="sc">$</span>SLMin <span class="ot">&lt;-</span> testOpt<span class="sc">$</span>fixedFleetPars<span class="sc">$</span>SLMin</span>
<span id="cb175-12"><a href="examples.html#cb175-12" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(testOpt<span class="sc">$</span>fixedFleetPars<span class="sc">$</span>use_aggregated)) FleetPars<span class="sc">$</span>use_aggregated <span class="ot">&lt;-</span> testOpt<span class="sc">$</span>fixedFleetPars<span class="sc">$</span>use_aggregated</span>
<span id="cb175-13"><a href="examples.html#cb175-13" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(testOpt<span class="sc">$</span>fixedFleetPars<span class="sc">$</span>fishery_mesh)) FleetPars<span class="sc">$</span>fishery_mesh <span class="ot">&lt;-</span> testOpt<span class="sc">$</span>fixedFleetPars<span class="sc">$</span>fishery_mesh</span>
<span id="cb175-14"><a href="examples.html#cb175-14" tabindex="-1"></a></span>
<span id="cb175-15"><a href="examples.html#cb175-15" tabindex="-1"></a></span>
<span id="cb175-16"><a href="examples.html#cb175-16" tabindex="-1"></a><span class="co"># Insert the appropiate selectivity parameters - handle specific selectivity curve parameters</span></span>
<span id="cb175-17"><a href="examples.html#cb175-17" tabindex="-1"></a><span class="cf">if</span> (testOpt<span class="sc">$</span>fixedFleetPars<span class="sc">$</span>selectivityCurve <span class="sc">==</span> <span class="st">&quot;Logistic&quot;</span>) {                  </span>
<span id="cb175-18"><a href="examples.html#cb175-18" tabindex="-1"></a>  <span class="co"># For Logistic, parameters might be estimated</span></span>
<span id="cb175-19"><a href="examples.html#cb175-19" tabindex="-1"></a>  FleetPars<span class="sc">$</span>SL1 <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="st">&quot;SL50&quot;</span> <span class="sc">%in%</span> <span class="fu">names</span>(testOpt<span class="sc">$</span>lbPars), testOpt<span class="sc">$</span>lbPars[[<span class="st">&quot;SL50&quot;</span>]], testOpt<span class="sc">$</span>fixedFleetPars[[<span class="st">&quot;SL1&quot;</span>]])</span>
<span id="cb175-20"><a href="examples.html#cb175-20" tabindex="-1"></a>  FleetPars<span class="sc">$</span>SL2 <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="st">&quot;SL95&quot;</span> <span class="sc">%in%</span> <span class="fu">names</span>(testOpt<span class="sc">$</span>lbPars), testOpt<span class="sc">$</span>lbPars[[<span class="st">&quot;SL95&quot;</span>]], testOpt<span class="sc">$</span>fixedFleetPars[[<span class="st">&quot;SL2&quot;</span>]])</span>
<span id="cb175-21"><a href="examples.html#cb175-21" tabindex="-1"></a>} <span class="cf">else</span> <span class="cf">if</span> (testOpt<span class="sc">$</span>fixedFleetPars<span class="sc">$</span>selectivityCurve <span class="sc">==</span> <span class="st">&quot;Knife&quot;</span>) {</span>
<span id="cb175-22"><a href="examples.html#cb175-22" tabindex="-1"></a>  FleetPars<span class="sc">$</span>MLLKnife <span class="ot">&lt;-</span> testOpt<span class="sc">$</span>fixedFleetPars<span class="sc">$</span>MLLKnife </span>
<span id="cb175-23"><a href="examples.html#cb175-23" tabindex="-1"></a>} <span class="cf">else</span> <span class="cf">if</span> (testOpt<span class="sc">$</span>fixedFleetPars<span class="sc">$</span>selectivityCurve <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;binorm.sca&quot;</span>, <span class="st">&quot;bilognorm&quot;</span>)) {</span>
<span id="cb175-24"><a href="examples.html#cb175-24" tabindex="-1"></a>  <span class="co"># For new dome-shaped curves with 5 parameters</span></span>
<span id="cb175-25"><a href="examples.html#cb175-25" tabindex="-1"></a>  FleetPars<span class="sc">$</span>SL1 <span class="ot">&lt;-</span> testOpt<span class="sc">$</span>fixedFleetPars<span class="sc">$</span>SL1</span>
<span id="cb175-26"><a href="examples.html#cb175-26" tabindex="-1"></a>  FleetPars<span class="sc">$</span>SL2 <span class="ot">&lt;-</span> testOpt<span class="sc">$</span>fixedFleetPars<span class="sc">$</span>SL2</span>
<span id="cb175-27"><a href="examples.html#cb175-27" tabindex="-1"></a>  FleetPars<span class="sc">$</span>SL3 <span class="ot">&lt;-</span> testOpt<span class="sc">$</span>fixedFleetPars<span class="sc">$</span>SL3</span>
<span id="cb175-28"><a href="examples.html#cb175-28" tabindex="-1"></a>  FleetPars<span class="sc">$</span>SL4 <span class="ot">&lt;-</span> testOpt<span class="sc">$</span>fixedFleetPars<span class="sc">$</span>SL4</span>
<span id="cb175-29"><a href="examples.html#cb175-29" tabindex="-1"></a>  FleetPars<span class="sc">$</span>SL5 <span class="ot">&lt;-</span> testOpt<span class="sc">$</span>fixedFleetPars<span class="sc">$</span>SL5</span>
<span id="cb175-30"><a href="examples.html#cb175-30" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb175-31"><a href="examples.html#cb175-31" tabindex="-1"></a>  <span class="co"># For other curves (Normal.sca, Normal.loc, logNorm)</span></span>
<span id="cb175-32"><a href="examples.html#cb175-32" tabindex="-1"></a>  FleetPars<span class="sc">$</span>SL1 <span class="ot">&lt;-</span> testOpt<span class="sc">$</span>fixedFleetPars<span class="sc">$</span>SL1</span>
<span id="cb175-33"><a href="examples.html#cb175-33" tabindex="-1"></a>  FleetPars<span class="sc">$</span>SL2 <span class="ot">&lt;-</span> testOpt<span class="sc">$</span>fixedFleetPars<span class="sc">$</span>SL2</span>
<span id="cb175-34"><a href="examples.html#cb175-34" tabindex="-1"></a>}</span></code></pre></div>
<p>The next code re-run the GTG simulation using the estimated parameters. This generates a fresh simulation of the expected equilibrium catch-per-recruit distribution, which is then scaled to match the magnitude of the observed data.
The generated plot shows whether the estimated parameters, when used in an independent simulation, can reproduce realistic catch distributions that match the observed data patterns.</p>
<div class="sourceCode" id="cb176"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb176-1"><a href="examples.html#cb176-1" tabindex="-1"></a><span class="co"># This part does the per-recruit simulation using the fitted fishing mortality and selectivity parameters, and then summarizes the expected catch per recruit.                 </span></span>
<span id="cb176-2"><a href="examples.html#cb176-2" tabindex="-1"></a> prSim <span class="ot">&lt;-</span> <span class="fu">GTGDomeLBSPRSim2</span>(LifeHistoryObj, FleetPars, SizeBins)</span>
<span id="cb176-3"><a href="examples.html#cb176-3" tabindex="-1"></a> <span class="fu">sum</span>(prSim<span class="sc">$</span>LCatchFished)</span></code></pre></div>
<pre><code>## [1] 1</code></pre>
<div class="sourceCode" id="cb178"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb178-1"><a href="examples.html#cb178-1" tabindex="-1"></a> <span class="co"># Scale predicted to match observed range</span></span>
<span id="cb178-2"><a href="examples.html#cb178-2" tabindex="-1"></a> scaled_pred <span class="ot">&lt;-</span> <span class="fu">max</span>(observed_data) <span class="sc">*</span> prSim<span class="sc">$</span>LCatchFished <span class="sc">/</span> <span class="fu">max</span>(prSim<span class="sc">$</span>LCatchFished)</span>
<span id="cb178-3"><a href="examples.html#cb178-3" tabindex="-1"></a> </span>
<span id="cb178-4"><a href="examples.html#cb178-4" tabindex="-1"></a> <span class="co"># Create validation comparison plot</span></span>
<span id="cb178-5"><a href="examples.html#cb178-5" tabindex="-1"></a> p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">data.frame</span>(<span class="at">Length =</span> length_vector, <span class="at">Observed =</span> observed_data)) <span class="sc">+</span></span>
<span id="cb178-6"><a href="examples.html#cb178-6" tabindex="-1"></a>   <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">x =</span> Length, <span class="at">y =</span> Observed), <span class="at">fill =</span> <span class="st">&quot;grey50&quot;</span>) <span class="sc">+</span></span>
<span id="cb178-7"><a href="examples.html#cb178-7" tabindex="-1"></a>   <span class="fu">geom_line</span>(<span class="at">data =</span> <span class="fu">data.frame</span>(<span class="at">Length =</span> LenMids, <span class="at">Predicted =</span> scaled_pred),</span>
<span id="cb178-8"><a href="examples.html#cb178-8" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">x =</span> Length, <span class="at">y =</span> Predicted), <span class="at">color =</span> <span class="st">&quot;red&quot;</span>, <span class="at">size =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb178-9"><a href="examples.html#cb178-9" tabindex="-1"></a>   <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb178-10"><a href="examples.html#cb178-10" tabindex="-1"></a>   <span class="fu">labs</span>(</span>
<span id="cb178-11"><a href="examples.html#cb178-11" tabindex="-1"></a>     <span class="at">x =</span> <span class="st">&quot;Length (cm)&quot;</span>,</span>
<span id="cb178-12"><a href="examples.html#cb178-12" tabindex="-1"></a>     <span class="at">y =</span> <span class="st">&quot;Catch in Number&quot;</span>,</span>
<span id="cb178-13"><a href="examples.html#cb178-13" tabindex="-1"></a>     <span class="at">title =</span> <span class="fu">paste</span>(<span class="st">&quot;Observed vs GTG Re-simulation (&quot;</span>, data_type, <span class="st">&quot;data)&quot;</span>)</span>
<span id="cb178-14"><a href="examples.html#cb178-14" tabindex="-1"></a>   )</span>
<span id="cb178-15"><a href="examples.html#cb178-15" tabindex="-1"></a> </span>
<span id="cb178-16"><a href="examples.html#cb178-16" tabindex="-1"></a> <span class="fu">print</span>(p2)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-11"></span>
<img src="figures/unnamed-chunk-11-1.png" alt="Observed vs GTG Re-simulation" width="2100" />
<p class="caption">
Figure 6.14: Observed vs GTG Re-simulation
</p>
</div>
<p>The final plot provides a refined presentation of the optimization fit with improved formatting and clear legend distinction between observed and predicted values.</p>
<div class="sourceCode" id="cb179"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb179-1"><a href="examples.html#cb179-1" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(compare_df, <span class="fu">aes</span>(<span class="at">x =</span> Length)) <span class="sc">+</span></span>
<span id="cb179-2"><a href="examples.html#cb179-2" tabindex="-1"></a>   <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">y =</span> Observed, <span class="at">fill =</span> <span class="st">&quot;Observed&quot;</span>), <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb179-3"><a href="examples.html#cb179-3" tabindex="-1"></a>   <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> Predicted, <span class="at">color =</span> <span class="st">&quot;Predicted&quot;</span>), <span class="at">size =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb179-4"><a href="examples.html#cb179-4" tabindex="-1"></a>   <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;Observed&quot;</span> <span class="ot">=</span> <span class="st">&quot;gray&quot;</span>)) <span class="sc">+</span></span>
<span id="cb179-5"><a href="examples.html#cb179-5" tabindex="-1"></a>   <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;Predicted&quot;</span> <span class="ot">=</span> <span class="st">&quot;red&quot;</span>)) <span class="sc">+</span></span>
<span id="cb179-6"><a href="examples.html#cb179-6" tabindex="-1"></a>   <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">paste</span>(<span class="st">&quot;Model Fit Comparison (&quot;</span>, data_type, <span class="st">&quot;data)&quot;</span>),</span>
<span id="cb179-7"><a href="examples.html#cb179-7" tabindex="-1"></a>        <span class="at">x =</span> <span class="st">&quot;Length (cm)&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Counts&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;&quot;</span>, <span class="at">color =</span> <span class="st">&quot;&quot;</span>) <span class="sc">+</span></span>
<span id="cb179-8"><a href="examples.html#cb179-8" tabindex="-1"></a>   <span class="fu">theme_bw</span>()</span>
<span id="cb179-9"><a href="examples.html#cb179-9" tabindex="-1"></a> </span>
<span id="cb179-10"><a href="examples.html#cb179-10" tabindex="-1"></a> <span class="fu">print</span>(p3)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-12"></span>
<img src="figures/unnamed-chunk-12-1.png" alt="Final model fit" width="2100" />
<p class="caption">
Figure 6.15: Final model fit
</p>
</div>
</div>
<div id="step-12.-sensitivity-analysis-multiple-life-history-parameter-combinations" class="section level4 hasAnchor" number="6.2.1.12">
<h4><span class="header-section-number">6.2.1.12</span> Step 12. Sensitivity analysis: Multiple life history parameter combinations<a href="examples.html#step-12.-sensitivity-analysis-multiple-life-history-parameter-combinations" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>This section demonstrates how to conduct a comprehensive sensitivity analysis by running the dome-shaped LBSPR model across multiple combinations of key life history parameters.
The sensitivity analysis examines the response of the model to variations in two critical life history parameters: M/K ratio and asymptotic length</p>
<div class="sourceCode" id="cb180"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb180-1"><a href="examples.html#cb180-1" tabindex="-1"></a><span class="co"># Conducting the Dome-shaped LB-SPR: apply to multiple M/K and Linf values</span></span>
<span id="cb180-2"><a href="examples.html#cb180-2" tabindex="-1"></a><span class="co"># Define parameter sequences for sensitivity analysis</span></span>
<span id="cb180-3"><a href="examples.html#cb180-3" tabindex="-1"></a>MKseq <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">1.5</span>, <span class="fl">1.8</span>, <span class="fl">2.0</span>)     <span class="co"># M/K ratios to test</span></span>
<span id="cb180-4"><a href="examples.html#cb180-4" tabindex="-1"></a>Linfseq <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">90</span>, <span class="dv">100</span>, <span class="dv">120</span>)    <span class="co"># asymptotic lengths to test (cm)</span></span>
<span id="cb180-5"><a href="examples.html#cb180-5" tabindex="-1"></a></span>
<span id="cb180-6"><a href="examples.html#cb180-6" tabindex="-1"></a><span class="co"># Initialize storage for results</span></span>
<span id="cb180-7"><a href="examples.html#cb180-7" tabindex="-1"></a>results_list <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb180-8"><a href="examples.html#cb180-8" tabindex="-1"></a>row_labels <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb180-9"><a href="examples.html#cb180-9" tabindex="-1"></a>combo_id <span class="ot">&lt;-</span> <span class="dv">1</span>    <span class="co"># counter for parameter combinations</span></span></code></pre></div>
<p>The analysis uses a loop structure to systematically evaluate all possible combinations of the specified parameter values. For each combination, the model creates a temporary copy of the life history object with updated parameters and runs the optimization routine using the <code>DoOptDome.aggregated()</code> function. This sensitivity analysis employs <code>DoOptDome.aggregated()</code>, which is a convenience wrapper function that automatically pools (aggregates) multiple groups before optimization. This approach differs from the <code>run_grouped_and_pooled()</code> function used in the previous step, which can perform both grouped and pooled analyses. The <code>DoOptDome.aggregated()</code> function simplifies the workflow for sensitivity analyses where only pooled results are needed across parameter combinations.</p>
<div class="sourceCode" id="cb181"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb181-1"><a href="examples.html#cb181-1" tabindex="-1"></a><span class="co"># Systematic evaluation of parameter combinations</span></span>
<span id="cb181-2"><a href="examples.html#cb181-2" tabindex="-1"></a><span class="cf">for</span> (iLinf <span class="cf">in</span> <span class="fu">seq_along</span>(Linfseq)) {</span>
<span id="cb181-3"><a href="examples.html#cb181-3" tabindex="-1"></a>  <span class="cf">for</span> (iMK <span class="cf">in</span> <span class="fu">seq_along</span>(MKseq)) {</span>
<span id="cb181-4"><a href="examples.html#cb181-4" tabindex="-1"></a>    </span>
<span id="cb181-5"><a href="examples.html#cb181-5" tabindex="-1"></a>    <span class="co"># Create temporary life history object with updated parameters</span></span>
<span id="cb181-6"><a href="examples.html#cb181-6" tabindex="-1"></a>    LifeHistoryObj_temp <span class="ot">&lt;-</span> LifeHistoryObj</span>
<span id="cb181-7"><a href="examples.html#cb181-7" tabindex="-1"></a>    LifeHistoryObj_temp<span class="sc">@</span>Linf <span class="ot">&lt;-</span> Linfseq[iLinf]</span>
<span id="cb181-8"><a href="examples.html#cb181-8" tabindex="-1"></a>    LifeHistoryObj_temp<span class="sc">@</span>MK <span class="ot">&lt;-</span> MKseq[iMK]</span>
<span id="cb181-9"><a href="examples.html#cb181-9" tabindex="-1"></a>    LifeHistoryObj_temp<span class="sc">@</span>M <span class="ot">&lt;-</span> MKseq[iMK] <span class="sc">*</span> LifeHistoryObj_temp<span class="sc">@</span>K  <span class="co"># Update M accordingly</span></span>
<span id="cb181-10"><a href="examples.html#cb181-10" tabindex="-1"></a><span class="co"># Run optimization for current parameter combination using DoOptDome.aggregated()</span></span>
<span id="cb181-11"><a href="examples.html#cb181-11" tabindex="-1"></a><span class="co"># DoOptDome.aggregated() is a convenience wrapper that pools all groups before optimization</span></span>
<span id="cb181-12"><a href="examples.html#cb181-12" tabindex="-1"></a>    runOpt <span class="ot">&lt;-</span> <span class="fu">DoOptDome.aggregated</span>(LifeHistoryObj_temp, FleetPars,</span>
<span id="cb181-13"><a href="examples.html#cb181-13" tabindex="-1"></a>                                   lengthComp,</span>
<span id="cb181-14"><a href="examples.html#cb181-14" tabindex="-1"></a>                                   <span class="at">SizeBins =</span> SizeBins, <span class="at">Lc =</span> <span class="dv">0</span>, <span class="at">mod =</span> <span class="st">&quot;GTG&quot;</span>)</span>
<span id="cb181-15"><a href="examples.html#cb181-15" tabindex="-1"></a>    </span>
<span id="cb181-16"><a href="examples.html#cb181-16" tabindex="-1"></a>    <span class="co"># Extract key results</span></span>
<span id="cb181-17"><a href="examples.html#cb181-17" tabindex="-1"></a>    fm  <span class="ot">&lt;-</span> runOpt<span class="sc">$</span>lbPars[<span class="st">&quot;F/M&quot;</span>]      <span class="co"># Fishing mortality ratio</span></span>
<span id="cb181-18"><a href="examples.html#cb181-18" tabindex="-1"></a>    spr <span class="ot">&lt;-</span> runOpt<span class="sc">$</span>lbPars[<span class="st">&quot;SPR&quot;</span>]      <span class="co"># Spawning potential ratio</span></span>
<span id="cb181-19"><a href="examples.html#cb181-19" tabindex="-1"></a>    nll <span class="ot">&lt;-</span> runOpt<span class="sc">$</span>NLL                <span class="co"># Negative log-likelihood</span></span>
<span id="cb181-20"><a href="examples.html#cb181-20" tabindex="-1"></a>    </span>
<span id="cb181-21"><a href="examples.html#cb181-21" tabindex="-1"></a>    <span class="co"># Calculate confidence intervals when standard errors are available</span></span>
<span id="cb181-22"><a href="examples.html#cb181-22" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(runOpt<span class="sc">$</span>lbStdErrs) <span class="sc">&amp;&amp;</span> <span class="st">&quot;F/M&quot;</span> <span class="sc">%in%</span> <span class="fu">names</span>(runOpt<span class="sc">$</span>lbStdErrs)) {</span>
<span id="cb181-23"><a href="examples.html#cb181-23" tabindex="-1"></a>      fm_se <span class="ot">&lt;-</span> runOpt<span class="sc">$</span>lbStdErrs[<span class="st">&quot;F/M&quot;</span>]</span>
<span id="cb181-24"><a href="examples.html#cb181-24" tabindex="-1"></a>      fm_lower <span class="ot">&lt;-</span> fm <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> fm_se   <span class="co"># 95% confidence interval</span></span>
<span id="cb181-25"><a href="examples.html#cb181-25" tabindex="-1"></a>      fm_upper <span class="ot">&lt;-</span> fm <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> fm_se</span>
<span id="cb181-26"><a href="examples.html#cb181-26" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb181-27"><a href="examples.html#cb181-27" tabindex="-1"></a>      fm_se <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb181-28"><a href="examples.html#cb181-28" tabindex="-1"></a>      fm_lower <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb181-29"><a href="examples.html#cb181-29" tabindex="-1"></a>      fm_upper <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb181-30"><a href="examples.html#cb181-30" tabindex="-1"></a>      <span class="fu">warning</span>(<span class="fu">paste</span>(<span class="st">&quot;F/M SE not available for Linf =&quot;</span>, Linfseq[iLinf],</span>
<span id="cb181-31"><a href="examples.html#cb181-31" tabindex="-1"></a>                    <span class="st">&quot;and MK =&quot;</span>, MKseq[iMK]))</span>
<span id="cb181-32"><a href="examples.html#cb181-32" tabindex="-1"></a>    }</span>
<span id="cb181-33"><a href="examples.html#cb181-33" tabindex="-1"></a>    </span>
<span id="cb181-34"><a href="examples.html#cb181-34" tabindex="-1"></a>    <span class="co"># Store results for current combination</span></span>
<span id="cb181-35"><a href="examples.html#cb181-35" tabindex="-1"></a>    result_row <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb181-36"><a href="examples.html#cb181-36" tabindex="-1"></a>      <span class="at">MK =</span> MKseq[iMK],</span>
<span id="cb181-37"><a href="examples.html#cb181-37" tabindex="-1"></a>      <span class="at">Linf =</span> Linfseq[iLinf],</span>
<span id="cb181-38"><a href="examples.html#cb181-38" tabindex="-1"></a>      <span class="st">`</span><span class="at">F/M</span><span class="st">`</span> <span class="ot">=</span> fm,</span>
<span id="cb181-39"><a href="examples.html#cb181-39" tabindex="-1"></a>      <span class="st">`</span><span class="at">F/M_SE</span><span class="st">`</span> <span class="ot">=</span> fm_se,</span>
<span id="cb181-40"><a href="examples.html#cb181-40" tabindex="-1"></a>      <span class="at">SPR =</span> spr,</span>
<span id="cb181-41"><a href="examples.html#cb181-41" tabindex="-1"></a>      <span class="at">NLL =</span> nll,</span>
<span id="cb181-42"><a href="examples.html#cb181-42" tabindex="-1"></a>      <span class="at">F_M_Lower =</span> fm_lower,</span>
<span id="cb181-43"><a href="examples.html#cb181-43" tabindex="-1"></a>      <span class="at">F_M_Upper =</span> fm_upper,</span>
<span id="cb181-44"><a href="examples.html#cb181-44" tabindex="-1"></a>      <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span></span>
<span id="cb181-45"><a href="examples.html#cb181-45" tabindex="-1"></a>    )</span>
<span id="cb181-46"><a href="examples.html#cb181-46" tabindex="-1"></a>    </span>
<span id="cb181-47"><a href="examples.html#cb181-47" tabindex="-1"></a>    results_list[[combo_id]] <span class="ot">&lt;-</span> result_row</span>
<span id="cb181-48"><a href="examples.html#cb181-48" tabindex="-1"></a>    row_labels <span class="ot">&lt;-</span> <span class="fu">c</span>(row_labels, <span class="fu">paste0</span>(<span class="st">&quot;combination_&quot;</span>, combo_id))</span>
<span id="cb181-49"><a href="examples.html#cb181-49" tabindex="-1"></a>    combo_id <span class="ot">&lt;-</span> combo_id <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb181-50"><a href="examples.html#cb181-50" tabindex="-1"></a>    </span>
<span id="cb181-51"><a href="examples.html#cb181-51" tabindex="-1"></a>    <span class="co"># Progress reporting</span></span>
<span id="cb181-52"><a href="examples.html#cb181-52" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="fu">paste</span>(<span class="st">&quot;Completed: Linf =&quot;</span>, Linfseq[iLinf], <span class="st">&quot;, MK =&quot;</span>, MKseq[iMK], </span>
<span id="cb181-53"><a href="examples.html#cb181-53" tabindex="-1"></a>              <span class="st">&quot;, F/M =&quot;</span>, <span class="fu">round</span>(fm, <span class="dv">4</span>), <span class="st">&quot;, SPR =&quot;</span>, <span class="fu">round</span>(spr, <span class="dv">4</span>), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>))</span>
<span id="cb181-54"><a href="examples.html#cb181-54" tabindex="-1"></a>  }</span>
<span id="cb181-55"><a href="examples.html#cb181-55" tabindex="-1"></a>}    </span></code></pre></div>
<pre><code>## Completed: Linf = 90 , MK = 1.5 , F/M = 0.0637 , SPR = 0.9363 
## Completed: Linf = 90 , MK = 1.8 , F/M = 0 , SPR = 1 
## Completed: Linf = 90 , MK = 2 , F/M = 0 , SPR = 1 
## Completed: Linf = 100 , MK = 1.5 , F/M = 0.3678 , SPR = 0.7393 
## Completed: Linf = 100 , MK = 1.8 , F/M = 0.0936 , SPR = 0.9152 
## Completed: Linf = 100 , MK = 2 , F/M = 0 , SPR = 1 
## Completed: Linf = 120 , MK = 1.5 , F/M = 0.9146 , SPR = 0.5916 
## Completed: Linf = 120 , MK = 1.8 , F/M = 0.5487 , SPR = 0.6917 
## Completed: Linf = 120 , MK = 2 , F/M = 0.3662 , SPR = 0.7642</code></pre>
<p>After completing all parameter combinations, the results are compiled into a data frame and formatted for a table.</p>
<div class="sourceCode" id="cb183"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb183-1"><a href="examples.html#cb183-1" tabindex="-1"></a><span class="co"># Final data frame</span></span>
<span id="cb183-2"><a href="examples.html#cb183-2" tabindex="-1"></a>results_df <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, results_list)</span>
<span id="cb183-3"><a href="examples.html#cb183-3" tabindex="-1"></a><span class="fu">rownames</span>(results_df) <span class="ot">&lt;-</span> row_labels</span>
<span id="cb183-4"><a href="examples.html#cb183-4" tabindex="-1"></a></span>
<span id="cb183-5"><a href="examples.html#cb183-5" tabindex="-1"></a><span class="co"># View it</span></span>
<span id="cb183-6"><a href="examples.html#cb183-6" tabindex="-1"></a><span class="fu">print</span>(results_df)</span></code></pre></div>
<pre><code>##                MK Linf          F.M     F.M_SE       SPR      NLL
## combination_1 1.5   90 6.370840e-02 0.20012166 0.9363187 36.78668
## combination_2 1.8   90 2.061160e-09 0.08766016 1.0000000 47.01246
## combination_3 2.0   90 2.061161e-09 0.08119598 1.0000000 64.87243
## combination_4 1.5  100 3.678265e-01 0.11459528 0.7393483 31.36789
## combination_5 1.8  100 9.357802e-02 0.19208825 0.9152235 32.09920
## combination_6 2.0  100 2.061172e-09 0.13159961 1.0000000 33.19826
## combination_7 1.5  120 9.145970e-01 0.11458780 0.5915958 31.61274
## combination_8 1.8  120 5.487217e-01 0.12419010 0.6916688 31.20558
## combination_9 2.0  120 3.661990e-01 0.13747066 0.7642024 31.05859
##                 F_M_Lower F_M_Upper
## combination_1 -0.32853005 0.4559469
## combination_2 -0.17181392 0.1718139
## combination_3 -0.15914412 0.1591441
## combination_4  0.14321979 0.5924333
## combination_5 -0.28291494 0.4700710
## combination_6 -0.25793524 0.2579352
## combination_7  0.69000493 1.1391891
## combination_8  0.30530913 0.7921343
## combination_9  0.09675652 0.6356415</code></pre>
<div class="sourceCode" id="cb185"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb185-1"><a href="examples.html#cb185-1" tabindex="-1"></a><span class="co"># Create a table for visualization purposes</span></span>
<span id="cb185-2"><a href="examples.html#cb185-2" tabindex="-1"></a><span class="co"># Clean up column names and remove duplicates</span></span>
<span id="cb185-3"><a href="examples.html#cb185-3" tabindex="-1"></a><span class="co"># Create a clean table with proper column order and names</span></span>
<span id="cb185-4"><a href="examples.html#cb185-4" tabindex="-1"></a>visual_table <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb185-5"><a href="examples.html#cb185-5" tabindex="-1"></a>  <span class="at">MK =</span> results_df<span class="sc">$</span>MK,</span>
<span id="cb185-6"><a href="examples.html#cb185-6" tabindex="-1"></a>  <span class="at">Linf =</span> results_df<span class="sc">$</span>Linf,</span>
<span id="cb185-7"><a href="examples.html#cb185-7" tabindex="-1"></a>  <span class="st">`</span><span class="at">F/M</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">round</span>(<span class="fu">as.numeric</span>(results_df<span class="sc">$</span>F.M), <span class="dv">3</span>),</span>
<span id="cb185-8"><a href="examples.html#cb185-8" tabindex="-1"></a>  <span class="st">`</span><span class="at">F/M_SE</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">round</span>(<span class="fu">as.numeric</span>(results_df<span class="sc">$</span>F.M_SE), <span class="dv">3</span>),</span>
<span id="cb185-9"><a href="examples.html#cb185-9" tabindex="-1"></a>  <span class="st">`</span><span class="at">F/M_Lower</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">round</span>(results_df<span class="sc">$</span>F_M_Lower, <span class="dv">3</span>),</span>
<span id="cb185-10"><a href="examples.html#cb185-10" tabindex="-1"></a>  <span class="st">`</span><span class="at">F/M_Upper</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">round</span>(results_df<span class="sc">$</span>F_M_Upper, <span class="dv">3</span>),</span>
<span id="cb185-11"><a href="examples.html#cb185-11" tabindex="-1"></a>  <span class="at">SPR =</span> <span class="fu">round</span>(results_df<span class="sc">$</span>SPR, <span class="dv">3</span>),</span>
<span id="cb185-12"><a href="examples.html#cb185-12" tabindex="-1"></a>  <span class="at">NLL =</span> <span class="fu">round</span>(results_df<span class="sc">$</span>NLL, <span class="dv">2</span>),</span>
<span id="cb185-13"><a href="examples.html#cb185-13" tabindex="-1"></a>  <span class="at">check.names =</span> <span class="cn">FALSE</span>  <span class="co"># This preserves the &quot;/&quot; in column names</span></span>
<span id="cb185-14"><a href="examples.html#cb185-14" tabindex="-1"></a>)</span>
<span id="cb185-15"><a href="examples.html#cb185-15" tabindex="-1"></a></span>
<span id="cb185-16"><a href="examples.html#cb185-16" tabindex="-1"></a><span class="co"># Print table</span></span>
<span id="cb185-17"><a href="examples.html#cb185-17" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(visual_table, <span class="at">caption =</span> <span class="st">&quot;GTG dome shaped LBSPR results across MK and Linf&quot;</span>, <span class="at">digits =</span> <span class="dv">2</span>)</span></code></pre></div>
<table>
<caption><span id="tab:sensitivity-summary">Table 6.4: </span>GTG dome shaped LBSPR results across MK and Linf</caption>
<thead>
<tr class="header">
<th align="right">MK</th>
<th align="right">Linf</th>
<th align="right">F/M</th>
<th align="right">F/M_SE</th>
<th align="right">F/M_Lower</th>
<th align="right">F/M_Upper</th>
<th align="right">SPR</th>
<th align="right">NLL</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1.5</td>
<td align="right">90</td>
<td align="right">0.06</td>
<td align="right">0.20</td>
<td align="right">-0.33</td>
<td align="right">0.46</td>
<td align="right">0.94</td>
<td align="right">36.79</td>
</tr>
<tr class="even">
<td align="right">1.8</td>
<td align="right">90</td>
<td align="right">0.00</td>
<td align="right">0.09</td>
<td align="right">-0.17</td>
<td align="right">0.17</td>
<td align="right">1.00</td>
<td align="right">47.01</td>
</tr>
<tr class="odd">
<td align="right">2.0</td>
<td align="right">90</td>
<td align="right">0.00</td>
<td align="right">0.08</td>
<td align="right">-0.16</td>
<td align="right">0.16</td>
<td align="right">1.00</td>
<td align="right">64.87</td>
</tr>
<tr class="even">
<td align="right">1.5</td>
<td align="right">100</td>
<td align="right">0.37</td>
<td align="right">0.12</td>
<td align="right">0.14</td>
<td align="right">0.59</td>
<td align="right">0.74</td>
<td align="right">31.37</td>
</tr>
<tr class="odd">
<td align="right">1.8</td>
<td align="right">100</td>
<td align="right">0.09</td>
<td align="right">0.19</td>
<td align="right">-0.28</td>
<td align="right">0.47</td>
<td align="right">0.92</td>
<td align="right">32.10</td>
</tr>
<tr class="even">
<td align="right">2.0</td>
<td align="right">100</td>
<td align="right">0.00</td>
<td align="right">0.13</td>
<td align="right">-0.26</td>
<td align="right">0.26</td>
<td align="right">1.00</td>
<td align="right">33.20</td>
</tr>
<tr class="odd">
<td align="right">1.5</td>
<td align="right">120</td>
<td align="right">0.92</td>
<td align="right">0.12</td>
<td align="right">0.69</td>
<td align="right">1.14</td>
<td align="right">0.59</td>
<td align="right">31.61</td>
</tr>
<tr class="even">
<td align="right">1.8</td>
<td align="right">120</td>
<td align="right">0.55</td>
<td align="right">0.12</td>
<td align="right">0.30</td>
<td align="right">0.79</td>
<td align="right">0.69</td>
<td align="right">31.21</td>
</tr>
<tr class="odd">
<td align="right">2.0</td>
<td align="right">120</td>
<td align="right">0.37</td>
<td align="right">0.14</td>
<td align="right">0.10</td>
<td align="right">0.64</td>
<td align="right">0.76</td>
<td align="right">31.06</td>
</tr>
</tbody>
</table>
</div>
<div id="step-13.-optional-logistic-selectivity" class="section level4 hasAnchor" number="6.2.1.13">
<h4><span class="header-section-number">6.2.1.13</span> Step 13. Optional: logistic selectivity<a href="examples.html#step-13.-optional-logistic-selectivity" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>If the user wants to test logistic selectivity and estimate its parameters (e.g., <code>SL1 = SL50</code> and <code>SL2 = SL95</code>), they should follow a simplified workflow.</p>
<p>The user can run the initial part of the script up to the definition of <code>FleetPars</code> for the logistic model. The selectivity fitting step using <code>fit_gillnet_dome()</code> can be skipped, as logistic parameters will be estimated directly from the catch-at-length data using the optimization routine.</p>
<div class="sourceCode" id="cb186"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb186-1"><a href="examples.html#cb186-1" tabindex="-1"></a><span class="co"># Configure LengthComp object for length data</span></span>
<span id="cb186-2"><a href="examples.html#cb186-2" tabindex="-1"></a>lengthComp <span class="ot">&lt;-</span> <span class="fu">new</span>(<span class="st">&quot;LengthComp&quot;</span>)</span>
<span id="cb186-3"><a href="examples.html#cb186-3" tabindex="-1"></a>lengthComp<span class="sc">@</span>dataType <span class="ot">&lt;-</span> <span class="st">&quot;Frequency&quot;</span>  <span class="co"># or &quot;Length&quot; or &quot;Frequency&quot; </span></span>
<span id="cb186-4"><a href="examples.html#cb186-4" tabindex="-1"></a>lengthComp<span class="sc">@</span>L_source <span class="ot">&lt;-</span> <span class="st">&quot;FD&quot;</span></span>
<span id="cb186-5"><a href="examples.html#cb186-5" tabindex="-1"></a>lengthComp<span class="sc">@</span>dt <span class="ot">&lt;-</span> sampleCatch</span>
<span id="cb186-6"><a href="examples.html#cb186-6" tabindex="-1"></a>lengthComp<span class="sc">@</span>L_units <span class="ot">&lt;-</span> <span class="st">&quot;cm&quot;</span></span>
<span id="cb186-7"><a href="examples.html#cb186-7" tabindex="-1"></a>lengthComp<span class="sc">@</span>L_type <span class="ot">&lt;-</span> <span class="st">&quot;TL&quot;</span></span>
<span id="cb186-8"><a href="examples.html#cb186-8" tabindex="-1"></a>lengthComp<span class="sc">@</span>header <span class="ot">&lt;-</span><span class="cn">TRUE</span></span>
<span id="cb186-9"><a href="examples.html#cb186-9" tabindex="-1"></a>lengthComp<span class="sc">@</span>observationGroup <span class="ot">&lt;-</span> <span class="st">&quot;Catch&quot;</span></span>
<span id="cb186-10"><a href="examples.html#cb186-10" tabindex="-1"></a>dataType <span class="ot">&lt;-</span> <span class="st">&quot;Frequency&quot;</span></span>
<span id="cb186-11"><a href="examples.html#cb186-11" tabindex="-1"></a></span>
<span id="cb186-12"><a href="examples.html#cb186-12" tabindex="-1"></a><span class="co"># Create LifeHistory S4 object using direct slot assignment</span></span>
<span id="cb186-13"><a href="examples.html#cb186-13" tabindex="-1"></a>LifeHistoryObj <span class="ot">&lt;-</span> <span class="fu">new</span>(<span class="st">&quot;LifeHistory&quot;</span>)</span>
<span id="cb186-14"><a href="examples.html#cb186-14" tabindex="-1"></a>LifeHistoryObj<span class="sc">@</span>title <span class="ot">&lt;-</span> <span class="st">&quot;Fish Stock&quot;</span></span>
<span id="cb186-15"><a href="examples.html#cb186-15" tabindex="-1"></a>LifeHistoryObj<span class="sc">@</span>speciesName <span class="ot">&lt;-</span> <span class="st">&quot;Generic Fish&quot;</span></span>
<span id="cb186-16"><a href="examples.html#cb186-16" tabindex="-1"></a>LifeHistoryObj<span class="sc">@</span>shortDescription <span class="ot">&lt;-</span> <span class="st">&quot;Stock for LBSPR Analysis&quot;</span></span>
<span id="cb186-17"><a href="examples.html#cb186-17" tabindex="-1"></a>LifeHistoryObj<span class="sc">@</span>L_type <span class="ot">&lt;-</span> <span class="st">&quot;TL&quot;</span></span>
<span id="cb186-18"><a href="examples.html#cb186-18" tabindex="-1"></a>LifeHistoryObj<span class="sc">@</span>L_units <span class="ot">&lt;-</span> <span class="st">&quot;cm&quot;</span></span>
<span id="cb186-19"><a href="examples.html#cb186-19" tabindex="-1"></a>LifeHistoryObj<span class="sc">@</span>Walpha_units <span class="ot">&lt;-</span> <span class="st">&quot;g&quot;</span></span>
<span id="cb186-20"><a href="examples.html#cb186-20" tabindex="-1"></a><span class="co">#Life history</span></span>
<span id="cb186-21"><a href="examples.html#cb186-21" tabindex="-1"></a>LifeHistoryObj<span class="sc">@</span>Linf <span class="ot">&lt;-</span> <span class="dv">120</span></span>
<span id="cb186-22"><a href="examples.html#cb186-22" tabindex="-1"></a>LifeHistoryObj<span class="sc">@</span>K <span class="ot">&lt;-</span> <span class="fl">0.2</span>  <span class="co"># Calculated from your MK ratio (M/K = 1.5, so K = M/1.5)</span></span>
<span id="cb186-23"><a href="examples.html#cb186-23" tabindex="-1"></a>LifeHistoryObj<span class="sc">@</span>t0 <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb186-24"><a href="examples.html#cb186-24" tabindex="-1"></a>LifeHistoryObj<span class="sc">@</span>L50 <span class="ot">&lt;-</span> <span class="dv">60</span></span>
<span id="cb186-25"><a href="examples.html#cb186-25" tabindex="-1"></a>LifeHistoryObj<span class="sc">@</span>L95delta <span class="ot">&lt;-</span> <span class="dv">2</span>  <span class="co"># L95 - L50 = 62 - 60</span></span>
<span id="cb186-26"><a href="examples.html#cb186-26" tabindex="-1"></a>LifeHistoryObj<span class="sc">@</span>M <span class="ot">&lt;-</span> <span class="fl">0.3</span>  <span class="co"># Calculated from MK * K = 1.5 * 0.2</span></span>
<span id="cb186-27"><a href="examples.html#cb186-27" tabindex="-1"></a>LifeHistoryObj<span class="sc">@</span>MK <span class="ot">&lt;-</span> <span class="fl">1.5</span>  </span>
<span id="cb186-28"><a href="examples.html#cb186-28" tabindex="-1"></a>LifeHistoryObj<span class="sc">@</span>LW_A <span class="ot">&lt;-</span> <span class="fl">0.01</span></span>
<span id="cb186-29"><a href="examples.html#cb186-29" tabindex="-1"></a>LifeHistoryObj<span class="sc">@</span>LW_B <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb186-30"><a href="examples.html#cb186-30" tabindex="-1"></a>LifeHistoryObj<span class="sc">@</span>Steep <span class="ot">&lt;-</span> <span class="fl">0.7</span></span>
<span id="cb186-31"><a href="examples.html#cb186-31" tabindex="-1"></a>LifeHistoryObj<span class="sc">@</span>R0 <span class="ot">&lt;-</span> <span class="fl">1E6</span></span>
<span id="cb186-32"><a href="examples.html#cb186-32" tabindex="-1"></a>LifeHistoryObj<span class="sc">@</span>Tmax <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fu">log</span>(<span class="fl">0.01</span>) <span class="sc">/</span> LifeHistoryObj<span class="sc">@</span>M</span>
<span id="cb186-33"><a href="examples.html#cb186-33" tabindex="-1"></a></span>
<span id="cb186-34"><a href="examples.html#cb186-34" tabindex="-1"></a><span class="co"># Additional parameters for spawning (set defaults)</span></span>
<span id="cb186-35"><a href="examples.html#cb186-35" tabindex="-1"></a>LifeHistoryObj<span class="sc">@</span>recSD <span class="ot">&lt;-</span> <span class="fl">0.6</span></span>
<span id="cb186-36"><a href="examples.html#cb186-36" tabindex="-1"></a>LifeHistoryObj<span class="sc">@</span>recRho <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb186-37"><a href="examples.html#cb186-37" tabindex="-1"></a>LifeHistoryObj<span class="sc">@</span>isHermaph <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb186-38"><a href="examples.html#cb186-38" tabindex="-1"></a>LifeHistoryObj<span class="sc">@</span>H50 <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb186-39"><a href="examples.html#cb186-39" tabindex="-1"></a>LifeHistoryObj<span class="sc">@</span>H95delta <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb186-40"><a href="examples.html#cb186-40" tabindex="-1"></a></span>
<span id="cb186-41"><a href="examples.html#cb186-41" tabindex="-1"></a><span class="co"># GTG-specific parameters as attributes</span></span>
<span id="cb186-42"><a href="examples.html#cb186-42" tabindex="-1"></a><span class="fu">attr</span>(LifeHistoryObj, <span class="st">&quot;CVLinf&quot;</span>) <span class="ot">&lt;-</span> <span class="fl">0.1</span></span>
<span id="cb186-43"><a href="examples.html#cb186-43" tabindex="-1"></a><span class="fu">attr</span>(LifeHistoryObj, <span class="st">&quot;MaxSD&quot;</span>) <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb186-44"><a href="examples.html#cb186-44" tabindex="-1"></a><span class="fu">attr</span>(LifeHistoryObj, <span class="st">&quot;NGTG&quot;</span>) <span class="ot">&lt;-</span> <span class="dv">13</span></span>
<span id="cb186-45"><a href="examples.html#cb186-45" tabindex="-1"></a><span class="fu">attr</span>(LifeHistoryObj, <span class="st">&quot;Mpow&quot;</span>) <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb186-46"><a href="examples.html#cb186-46" tabindex="-1"></a><span class="fu">attr</span>(LifeHistoryObj, <span class="st">&quot;FecB&quot;</span>) <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb186-47"><a href="examples.html#cb186-47" tabindex="-1"></a></span>
<span id="cb186-48"><a href="examples.html#cb186-48" tabindex="-1"></a><span class="co"># Discretization of length data</span></span>
<span id="cb186-49"><a href="examples.html#cb186-49" tabindex="-1"></a>lengthBinWidth <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb186-50"><a href="examples.html#cb186-50" tabindex="-1"></a>SizeBins <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb186-51"><a href="examples.html#cb186-51" tabindex="-1"></a>SizeBins<span class="sc">$</span>Linc <span class="ot">&lt;-</span> lengthBinWidth</span>
<span id="cb186-52"><a href="examples.html#cb186-52" tabindex="-1"></a>SDLinf <span class="ot">&lt;-</span> <span class="fu">attr</span>(LifeHistoryObj, <span class="st">&quot;CVLinf&quot;</span>) <span class="sc">*</span> LifeHistoryObj<span class="sc">@</span>Linf</span>
<span id="cb186-53"><a href="examples.html#cb186-53" tabindex="-1"></a>SizeBins<span class="sc">$</span>ToSize <span class="ot">&lt;-</span> LifeHistoryObj<span class="sc">@</span>Linf <span class="sc">+</span> SDLinf <span class="sc">*</span> <span class="fu">attr</span>(LifeHistoryObj, <span class="st">&quot;MaxSD&quot;</span>)</span>
<span id="cb186-54"><a href="examples.html#cb186-54" tabindex="-1"></a>LenBins <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> SizeBins<span class="sc">$</span>ToSize, <span class="at">by =</span> SizeBins<span class="sc">$</span>Linc)</span>
<span id="cb186-55"><a href="examples.html#cb186-55" tabindex="-1"></a>LenMids <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from=</span><span class="fl">0.5</span><span class="sc">*</span>SizeBins<span class="sc">$</span>Linc, <span class="at">by=</span>SizeBins<span class="sc">$</span>Linc, <span class="at">length.out=</span>(<span class="fu">length</span>(LenBins)<span class="sc">-</span><span class="dv">1</span>))</span>
<span id="cb186-56"><a href="examples.html#cb186-56" tabindex="-1"></a>lengthFish <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from=</span><span class="fl">0.5</span><span class="sc">*</span>SizeBins<span class="sc">$</span>Linc, <span class="at">by=</span>SizeBins<span class="sc">$</span>Linc, <span class="at">length.out=</span><span class="fu">length</span>(LenBins) <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="cb186-57"><a href="examples.html#cb186-57" tabindex="-1"></a></span>
<span id="cb186-58"><a href="examples.html#cb186-58" tabindex="-1"></a><span class="co"># Check the data structure</span></span>
<span id="cb186-59"><a href="examples.html#cb186-59" tabindex="-1"></a><span class="fu">print</span>(<span class="st">&quot;Data structure:&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;Data structure:&quot;</code></pre>
<div class="sourceCode" id="cb188"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb188-1"><a href="examples.html#cb188-1" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">head</span>(sampleCatch))</span></code></pre></div>
<pre><code>##   Length Catch_1 Catch_2 Catch_3 Catch_4 Catch_5
## 1    0.5       0       0       0       0       0
## 2    1.5       0       0       0       0       0
## 3    2.5       0       0       0       0       0
## 4    3.5       0       0       0       0       0
## 5    4.5       0       0       0       0       0
## 6    5.5       0       0       0       0       0</code></pre>
<div class="sourceCode" id="cb190"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb190-1"><a href="examples.html#cb190-1" tabindex="-1"></a><span class="fu">print</span>(<span class="st">&quot;Column names:&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;Column names:&quot;</code></pre>
<div class="sourceCode" id="cb192"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb192-1"><a href="examples.html#cb192-1" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">colnames</span>(sampleCatch))</span></code></pre></div>
<pre><code>## [1] &quot;Length&quot;  &quot;Catch_1&quot; &quot;Catch_2&quot; &quot;Catch_3&quot; &quot;Catch_4&quot; &quot;Catch_5&quot;</code></pre>
<div class="sourceCode" id="cb194"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb194-1"><a href="examples.html#cb194-1" tabindex="-1"></a><span class="co"># Define fleet parameters for logistic selectivity</span></span>
<span id="cb194-2"><a href="examples.html#cb194-2" tabindex="-1"></a><span class="co"># Note: SL50 and SL95 parameters will be estimated</span></span>
<span id="cb194-3"><a href="examples.html#cb194-3" tabindex="-1"></a>FleetParsLogistic <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">selectivityCurve =</span> <span class="st">&quot;Logistic&quot;</span>)</span></code></pre></div>
<p>The optimization process estimates three key parameters simultaneously:
- F/M: Fishing mortality to natural mortality ratio
- SL50: Length at 50% selectivity
- SL95: Length at 95% selectivity</p>
<div class="sourceCode" id="cb195"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb195-1"><a href="examples.html#cb195-1" tabindex="-1"></a><span class="co"># Run both grouped and pooled optimization</span></span>
<span id="cb195-2"><a href="examples.html#cb195-2" tabindex="-1"></a><span class="co"># using try to catch erros and prevent the code form crashing</span></span>
<span id="cb195-3"><a href="examples.html#cb195-3" tabindex="-1"></a>results_logistic <span class="ot">&lt;-</span> <span class="fu">try</span>(</span>
<span id="cb195-4"><a href="examples.html#cb195-4" tabindex="-1"></a>  <span class="fu">run_grouped_and_pooled</span>(</span>
<span id="cb195-5"><a href="examples.html#cb195-5" tabindex="-1"></a>    <span class="at">lifeHistoryObj =</span> LifeHistoryObj,</span>
<span id="cb195-6"><a href="examples.html#cb195-6" tabindex="-1"></a>    <span class="at">fixedFleetPars =</span> FleetParsLogistic, </span>
<span id="cb195-7"><a href="examples.html#cb195-7" tabindex="-1"></a>    <span class="at">LengthCompObj =</span> lengthComp, </span>
<span id="cb195-8"><a href="examples.html#cb195-8" tabindex="-1"></a>    <span class="at">SizeBins =</span> SizeBins, </span>
<span id="cb195-9"><a href="examples.html#cb195-9" tabindex="-1"></a>    <span class="at">Lc =</span> <span class="dv">0</span>, </span>
<span id="cb195-10"><a href="examples.html#cb195-10" tabindex="-1"></a>    <span class="at">mod =</span> <span class="st">&quot;GTG&quot;</span></span>
<span id="cb195-11"><a href="examples.html#cb195-11" tabindex="-1"></a>  ), </span>
<span id="cb195-12"><a href="examples.html#cb195-12" tabindex="-1"></a>  <span class="at">silent =</span> <span class="cn">FALSE</span>  <span class="co">#No error message printed to console</span></span>
<span id="cb195-13"><a href="examples.html#cb195-13" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## Running optimization by group...</code></pre>
<pre><code>## Processing group: Catch_1</code></pre>
<pre><code>## Processing group: Catch_2</code></pre>
<pre><code>## Processing group: Catch_3</code></pre>
<pre><code>## Processing group: Catch_4</code></pre>
<pre><code>## Processing group: Catch_5</code></pre>
<pre><code>## Running pooled optimization...</code></pre>
<div class="sourceCode" id="cb203"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb203-1"><a href="examples.html#cb203-1" tabindex="-1"></a><span class="co"># For backward compatibility, extract the pooled result</span></span>
<span id="cb203-2"><a href="examples.html#cb203-2" tabindex="-1"></a><span class="co"># inherits(results_logistic, &quot;try-error&quot;):</span></span>
<span id="cb203-3"><a href="examples.html#cb203-3" tabindex="-1"></a><span class="co"># Returns TRUE if results_logistic is an error object</span></span>
<span id="cb203-4"><a href="examples.html#cb203-4" tabindex="-1"></a><span class="co"># Returns FALSE if results_logistic is a normal result</span></span>
<span id="cb203-5"><a href="examples.html#cb203-5" tabindex="-1"></a></span>
<span id="cb203-6"><a href="examples.html#cb203-6" tabindex="-1"></a>lbsprFullLogisticEstimate <span class="ot">&lt;-</span> <span class="cf">if</span> (<span class="sc">!</span><span class="fu">inherits</span>(results_logistic, <span class="st">&quot;try-error&quot;</span>)) {</span>
<span id="cb203-7"><a href="examples.html#cb203-7" tabindex="-1"></a>  results_logistic<span class="sc">$</span>pooled <span class="co"># If optimization succeeded, extract pooled results</span></span>
<span id="cb203-8"><a href="examples.html#cb203-8" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb203-9"><a href="examples.html#cb203-9" tabindex="-1"></a>  results_logistic        <span class="co"># If optimization failed, keep the error object</span></span>
<span id="cb203-10"><a href="examples.html#cb203-10" tabindex="-1"></a>}</span>
<span id="cb203-11"><a href="examples.html#cb203-11" tabindex="-1"></a></span>
<span id="cb203-12"><a href="examples.html#cb203-12" tabindex="-1"></a><span class="co"># Handle results and potential errors</span></span>
<span id="cb203-13"><a href="examples.html#cb203-13" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">inherits</span>(results_logistic, <span class="st">&quot;try-error&quot;</span>)) {</span>
<span id="cb203-14"><a href="examples.html#cb203-14" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;Error occurred:</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb203-15"><a href="examples.html#cb203-15" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">attr</span>(results_logistic, <span class="st">&quot;condition&quot;</span>))</span>
<span id="cb203-16"><a href="examples.html#cb203-16" tabindex="-1"></a>  <span class="fu">warning</span>(<span class="st">&quot;Logistic selectivity estimation failed.&quot;</span>)</span>
<span id="cb203-17"><a href="examples.html#cb203-17" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb203-18"><a href="examples.html#cb203-18" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;Optimization successful!</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb203-19"><a href="examples.html#cb203-19" tabindex="-1"></a>  </span>
<span id="cb203-20"><a href="examples.html#cb203-20" tabindex="-1"></a>  <span class="co"># Print POOLED results</span></span>
<span id="cb203-21"><a href="examples.html#cb203-21" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;</span><span class="sc">\n</span><span class="st">=== POOLED (AGGREGATED) RESULTS ===</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb203-22"><a href="examples.html#cb203-22" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">&quot;Estimated parameters:&quot;</span>)</span>
<span id="cb203-23"><a href="examples.html#cb203-23" tabindex="-1"></a>  <span class="fu">print</span>(results_logistic<span class="sc">$</span>pooled<span class="sc">$</span>lbPars)</span>
<span id="cb203-24"><a href="examples.html#cb203-24" tabindex="-1"></a>  </span>
<span id="cb203-25"><a href="examples.html#cb203-25" tabindex="-1"></a>  <span class="co"># Print GROUPED results (if available)</span></span>
<span id="cb203-26"><a href="examples.html#cb203-26" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(results_logistic<span class="sc">$</span>grouped<span class="sc">$</span>group_results)) {</span>
<span id="cb203-27"><a href="examples.html#cb203-27" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">&quot;</span><span class="sc">\n</span><span class="st">=== GROUPED RESULTS (by vector) ===</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb203-28"><a href="examples.html#cb203-28" tabindex="-1"></a>    <span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">seq_along</span>(results_logistic<span class="sc">$</span>grouped<span class="sc">$</span>group_results)) {</span>
<span id="cb203-29"><a href="examples.html#cb203-29" tabindex="-1"></a>      group_name <span class="ot">&lt;-</span> <span class="fu">names</span>(results_logistic<span class="sc">$</span>grouped<span class="sc">$</span>group_results)[i]</span>
<span id="cb203-30"><a href="examples.html#cb203-30" tabindex="-1"></a>      <span class="cf">if</span>(<span class="fu">is.null</span>(group_name)) group_name <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">&quot;Group&quot;</span>, i)</span>
<span id="cb203-31"><a href="examples.html#cb203-31" tabindex="-1"></a>      </span>
<span id="cb203-32"><a href="examples.html#cb203-32" tabindex="-1"></a>      <span class="fu">cat</span>(<span class="fu">paste</span>(<span class="st">&quot;</span><span class="sc">\n</span><span class="st">--- Group:&quot;</span>, group_name, <span class="st">&quot;---</span><span class="sc">\n</span><span class="st">&quot;</span>))</span>
<span id="cb203-33"><a href="examples.html#cb203-33" tabindex="-1"></a>      <span class="fu">print</span>(results_logistic<span class="sc">$</span>grouped<span class="sc">$</span>group_results[[i]]<span class="sc">$</span>lbPars)</span>
<span id="cb203-34"><a href="examples.html#cb203-34" tabindex="-1"></a>    }</span>
<span id="cb203-35"><a href="examples.html#cb203-35" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb203-36"><a href="examples.html#cb203-36" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">&quot;</span><span class="sc">\n</span><span class="st">=== No grouped results (single vector or all data pooled) ===</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb203-37"><a href="examples.html#cb203-37" tabindex="-1"></a>  }</span>
<span id="cb203-38"><a href="examples.html#cb203-38" tabindex="-1"></a>  </span>
<span id="cb203-39"><a href="examples.html#cb203-39" tabindex="-1"></a>  <span class="co"># Use pooled results for plotting (as before)</span></span>
<span id="cb203-40"><a href="examples.html#cb203-40" tabindex="-1"></a>  lbsprFullLogisticEstimate <span class="ot">&lt;-</span> results_logistic<span class="sc">$</span>pooled</span>
<span id="cb203-41"><a href="examples.html#cb203-41" tabindex="-1"></a>  </span>
<span id="cb203-42"><a href="examples.html#cb203-42" tabindex="-1"></a>  <span class="co"># Extract estimated parameters</span></span>
<span id="cb203-43"><a href="examples.html#cb203-43" tabindex="-1"></a>  est_FM <span class="ot">&lt;-</span> lbsprFullLogisticEstimate<span class="sc">$</span>lbPars[<span class="st">&quot;F/M&quot;</span>]</span>
<span id="cb203-44"><a href="examples.html#cb203-44" tabindex="-1"></a>  est_SL50 <span class="ot">&lt;-</span> lbsprFullLogisticEstimate<span class="sc">$</span>lbPars[<span class="st">&quot;SL50&quot;</span>]</span>
<span id="cb203-45"><a href="examples.html#cb203-45" tabindex="-1"></a>  est_SL95 <span class="ot">&lt;-</span> lbsprFullLogisticEstimate<span class="sc">$</span>lbPars[<span class="st">&quot;SL95&quot;</span>]</span>
<span id="cb203-46"><a href="examples.html#cb203-46" tabindex="-1"></a>  est_SPR <span class="ot">&lt;-</span> lbsprFullLogisticEstimate<span class="sc">$</span>lbPars[<span class="st">&quot;SPR&quot;</span>]</span>
<span id="cb203-47"><a href="examples.html#cb203-47" tabindex="-1"></a>  </span>
<span id="cb203-48"><a href="examples.html#cb203-48" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="fu">paste</span>(<span class="st">&quot;F/M =&quot;</span>, <span class="fu">round</span>(est_FM, <span class="dv">3</span>), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>))</span>
<span id="cb203-49"><a href="examples.html#cb203-49" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="fu">paste</span>(<span class="st">&quot;SL50 =&quot;</span>, <span class="fu">round</span>(est_SL50, <span class="dv">1</span>), <span class="st">&quot;cm</span><span class="sc">\n</span><span class="st">&quot;</span>))</span>
<span id="cb203-50"><a href="examples.html#cb203-50" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="fu">paste</span>(<span class="st">&quot;SL95 =&quot;</span>, <span class="fu">round</span>(est_SL95, <span class="dv">1</span>), <span class="st">&quot;cm</span><span class="sc">\n</span><span class="st">&quot;</span>))</span>
<span id="cb203-51"><a href="examples.html#cb203-51" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="fu">paste</span>(<span class="st">&quot;SPR =&quot;</span>, <span class="fu">round</span>(est_SPR, <span class="dv">3</span>), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>))</span>
<span id="cb203-52"><a href="examples.html#cb203-52" tabindex="-1"></a>  </span>
<span id="cb203-53"><a href="examples.html#cb203-53" tabindex="-1"></a>  <span class="co"># Calculate selectivity curves</span></span>
<span id="cb203-54"><a href="examples.html#cb203-54" tabindex="-1"></a>  estSelLen <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> <span class="fu">exp</span>(<span class="sc">-</span><span class="fu">log</span>(<span class="dv">19</span>) <span class="sc">*</span> (lengthFish <span class="sc">-</span> est_SL50) <span class="sc">/</span> (est_SL95 <span class="sc">-</span> est_SL50)))</span>
<span id="cb203-55"><a href="examples.html#cb203-55" tabindex="-1"></a>  </span>
<span id="cb203-56"><a href="examples.html#cb203-56" tabindex="-1"></a>  <span class="co"># For comparison, let&#39;s also simulate with the estimated parameters</span></span>
<span id="cb203-57"><a href="examples.html#cb203-57" tabindex="-1"></a>  FleetParsEstimated <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb203-58"><a href="examples.html#cb203-58" tabindex="-1"></a>    <span class="at">selectivityCurve =</span> <span class="st">&quot;Logistic&quot;</span>,</span>
<span id="cb203-59"><a href="examples.html#cb203-59" tabindex="-1"></a>    <span class="at">FM =</span> est_FM,</span>
<span id="cb203-60"><a href="examples.html#cb203-60" tabindex="-1"></a>    <span class="at">SL1 =</span> est_SL50,</span>
<span id="cb203-61"><a href="examples.html#cb203-61" tabindex="-1"></a>    <span class="at">SL2 =</span> est_SL95</span>
<span id="cb203-62"><a href="examples.html#cb203-62" tabindex="-1"></a>  )</span>
<span id="cb203-63"><a href="examples.html#cb203-63" tabindex="-1"></a>  </span>
<span id="cb203-64"><a href="examples.html#cb203-64" tabindex="-1"></a>  <span class="co"># Run simulation with estimated parameters using S4 LifeHistory object</span></span>
<span id="cb203-65"><a href="examples.html#cb203-65" tabindex="-1"></a>  sim_result <span class="ot">&lt;-</span> <span class="fu">GTGDomeLBSPRSim2</span>(LifeHistoryObj, FleetParsEstimated, SizeBins) </span>
<span id="cb203-66"><a href="examples.html#cb203-66" tabindex="-1"></a>  simSelLen <span class="ot">&lt;-</span> sim_result<span class="sc">$</span>SelLen[<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(lengthFish)]  <span class="co"># Trim to match length</span></span>
<span id="cb203-67"><a href="examples.html#cb203-67" tabindex="-1"></a>  </span>
<span id="cb203-68"><a href="examples.html#cb203-68" tabindex="-1"></a>  <span class="co"># Create comparison dataframe with different curves</span></span>
<span id="cb203-69"><a href="examples.html#cb203-69" tabindex="-1"></a>  compare_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb203-70"><a href="examples.html#cb203-70" tabindex="-1"></a>    <span class="at">Length =</span> lengthFish,</span>
<span id="cb203-71"><a href="examples.html#cb203-71" tabindex="-1"></a>    <span class="at">Calculated =</span> estSelLen,          <span class="co"># Calculated from logistic formula</span></span>
<span id="cb203-72"><a href="examples.html#cb203-72" tabindex="-1"></a>    <span class="at">Simulated =</span> simSelLen            <span class="co"># From GTG simulation</span></span>
<span id="cb203-73"><a href="examples.html#cb203-73" tabindex="-1"></a>  )</span>
<span id="cb203-74"><a href="examples.html#cb203-74" tabindex="-1"></a>  </span>
<span id="cb203-75"><a href="examples.html#cb203-75" tabindex="-1"></a>  <span class="co"># Plot comparison</span></span>
<span id="cb203-76"><a href="examples.html#cb203-76" tabindex="-1"></a>  p_logistic <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(compare_df, <span class="fu">aes</span>(<span class="at">x =</span> Length)) <span class="sc">+</span></span>
<span id="cb203-77"><a href="examples.html#cb203-77" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> Calculated, <span class="at">color =</span> <span class="st">&quot;Calculated Logistic&quot;</span>), <span class="at">size =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb203-78"><a href="examples.html#cb203-78" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> Simulated, <span class="at">color =</span> <span class="st">&quot;GTG Simulated&quot;</span>), <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>, <span class="at">size =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb203-79"><a href="examples.html#cb203-79" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> est_SL50, <span class="at">color =</span> <span class="st">&quot;red&quot;</span>, <span class="at">linetype =</span> <span class="st">&quot;dotted&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb203-80"><a href="examples.html#cb203-80" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> est_SL95, <span class="at">color =</span> <span class="st">&quot;orange&quot;</span>, <span class="at">linetype =</span> <span class="st">&quot;dotted&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb203-81"><a href="examples.html#cb203-81" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> LifeHistoryObj<span class="sc">@</span>L50, <span class="at">color =</span> <span class="st">&quot;grey&quot;</span>, <span class="at">linetype =</span> <span class="st">&quot;dotted&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span>  <span class="co"># Changed from StockPars$L50</span></span>
<span id="cb203-82"><a href="examples.html#cb203-82" tabindex="-1"></a>    <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;Calculated Logistic&quot;</span> <span class="ot">=</span> <span class="st">&quot;blue&quot;</span>, </span>
<span id="cb203-83"><a href="examples.html#cb203-83" tabindex="-1"></a>                                  <span class="st">&quot;GTG Simulated&quot;</span> <span class="ot">=</span> <span class="st">&quot;red&quot;</span>)) <span class="sc">+</span></span>
<span id="cb203-84"><a href="examples.html#cb203-84" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Estimated Logistic Selectivity Curve&quot;</span>,</span>
<span id="cb203-85"><a href="examples.html#cb203-85" tabindex="-1"></a>         <span class="at">subtitle =</span> <span class="fu">paste</span>(<span class="st">&quot;SL50 =&quot;</span>, <span class="fu">round</span>(est_SL50, <span class="dv">1</span>), <span class="st">&quot;cm, SL95 =&quot;</span>, <span class="fu">round</span>(est_SL95, <span class="dv">1</span>), <span class="st">&quot;cm&quot;</span>),</span>
<span id="cb203-86"><a href="examples.html#cb203-86" tabindex="-1"></a>         <span class="at">x =</span> <span class="st">&quot;Length (cm)&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Selectivity&quot;</span>, <span class="at">color =</span> <span class="st">&quot;Source&quot;</span>) <span class="sc">+</span></span>
<span id="cb203-87"><a href="examples.html#cb203-87" tabindex="-1"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb203-88"><a href="examples.html#cb203-88" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span>
<span id="cb203-89"><a href="examples.html#cb203-89" tabindex="-1"></a>  </span>
<span id="cb203-90"><a href="examples.html#cb203-90" tabindex="-1"></a>  <span class="fu">print</span>(p_logistic)</span>
<span id="cb203-91"><a href="examples.html#cb203-91" tabindex="-1"></a>  </span>
<span id="cb203-92"><a href="examples.html#cb203-92" tabindex="-1"></a>  <span class="co"># Also plot fit to data (change from Freq to length)</span></span>
<span id="cb203-93"><a href="examples.html#cb203-93" tabindex="-1"></a>  observed <span class="ot">&lt;-</span> <span class="cf">if</span>(dataType <span class="sc">==</span> <span class="st">&quot;Frequency&quot;</span>) <span class="fu">rowSums</span>(sampleCatch[,<span class="sc">-</span><span class="dv">1</span>]) <span class="cf">else</span> <span class="fu">hist</span>(<span class="fu">unlist</span>(sampleCatch), <span class="at">breaks =</span> LenBins, <span class="at">plot =</span> <span class="cn">FALSE</span>)<span class="sc">$</span>counts</span>
<span id="cb203-94"><a href="examples.html#cb203-94" tabindex="-1"></a>  predicted <span class="ot">&lt;-</span> lbsprFullLogisticEstimate<span class="sc">$</span>PredLen</span>
<span id="cb203-95"><a href="examples.html#cb203-95" tabindex="-1"></a>  </span>
<span id="cb203-96"><a href="examples.html#cb203-96" tabindex="-1"></a>  fit_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb203-97"><a href="examples.html#cb203-97" tabindex="-1"></a>    <span class="at">Length =</span> <span class="cf">if</span>(dataType <span class="sc">==</span> <span class="st">&quot;Frequency&quot;</span>) sampleCatch<span class="sc">$</span>Length <span class="cf">else</span> LenMids,</span>
<span id="cb203-98"><a href="examples.html#cb203-98" tabindex="-1"></a>    <span class="at">Observed =</span> observed,</span>
<span id="cb203-99"><a href="examples.html#cb203-99" tabindex="-1"></a>    <span class="at">Predicted =</span> predicted</span>
<span id="cb203-100"><a href="examples.html#cb203-100" tabindex="-1"></a>  )</span>
<span id="cb203-101"><a href="examples.html#cb203-101" tabindex="-1"></a>  </span>
<span id="cb203-102"><a href="examples.html#cb203-102" tabindex="-1"></a>  p_fit <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(fit_df, <span class="fu">aes</span>(<span class="at">x =</span> Length)) <span class="sc">+</span></span>
<span id="cb203-103"><a href="examples.html#cb203-103" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">y =</span> Observed), <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;grey70&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb203-104"><a href="examples.html#cb203-104" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> Predicted), <span class="at">color =</span> <span class="st">&quot;red&quot;</span>, <span class="at">size =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb203-105"><a href="examples.html#cb203-105" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Model Fit: Observed vs Predicted Length Composition&quot;</span>,</span>
<span id="cb203-106"><a href="examples.html#cb203-106" tabindex="-1"></a>         <span class="at">x =</span> <span class="st">&quot;Length (cm)&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Count&quot;</span>) <span class="sc">+</span></span>
<span id="cb203-107"><a href="examples.html#cb203-107" tabindex="-1"></a>    <span class="fu">theme_bw</span>()</span>
<span id="cb203-108"><a href="examples.html#cb203-108" tabindex="-1"></a>  </span>
<span id="cb203-109"><a href="examples.html#cb203-109" tabindex="-1"></a>  <span class="fu">print</span>(p_fit)</span>
<span id="cb203-110"><a href="examples.html#cb203-110" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## Optimization successful!
## 
## === POOLED (AGGREGATED) RESULTS ===
## [1] &quot;Estimated parameters:&quot;
##         F/M        SL50        SL95         SPR 
##  3.78636845 57.23855219 66.56190396  0.07708359 
## 
## === GROUPED RESULTS (by vector) ===
## 
## --- Group: Catch_1 ---
##         F/M        SL50        SL95         SPR 
##  3.50681053 56.48644883 64.47376859  0.08064739 
## 
## --- Group: Catch_2 ---
##         F/M        SL50        SL95         SPR 
##  3.58527206 57.42913080 67.54093088  0.08349887 
## 
## --- Group: Catch_3 ---
##         F/M        SL50        SL95         SPR 
##  4.16087045 57.97326703 67.87565639  0.07244101 
## 
## --- Group: Catch_4 ---
##         F/M        SL50        SL95         SPR 
##  3.90930605 56.95272354 65.93410816  0.07241548 
## 
## --- Group: Catch_5 ---
##         F/M        SL50        SL95         SPR 
##  3.84555801 57.45438435 67.06150396  0.07678149 
## F/M = 3.786 
## SL50 = 57.2 cm
## SL95 = 66.6 cm
## SPR = 0.077</code></pre>
<p><img src="figures/optional-logistic-optim-1.png" width="2100" /><img src="figures/optional-logistic-optim-2.png" width="2100" /></p>

</div>
</div>
</div>
</div>
<h3>References<a href="references.html#references" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-hommik2020" class="csl-entry">
Hommik, Kristjan, Ciaran Fitzgerald, Finbarr Kelly, and Samuel Shephard. 2020. <span>“Dome-Shaped Selectivity in LB-SPR: Length-Based Assessment of Data-Limited Inland Fish Stocks Sampled with Gillnets.”</span> <em>Fisheries Research</em> 229: 105574.
</div>
<div id="ref-millar1997" class="csl-entry">
Millar, Russell B, and Rolf Holst. 1997. <span>“Estimation of Gillnet and Hook Selectivity Using Log-Linear Models.”</span> <em>ICES Journal of Marine Science</em> 54 (3): 471–77. <a href="https://doi.org/10.1006/jmsc.1996.0194">https://doi.org/10.1006/jmsc.1996.0194</a>.
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="utility-functions.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="references.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/USERNAME/REPO/edit/BRANCH/05-examples.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf", "_main.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
